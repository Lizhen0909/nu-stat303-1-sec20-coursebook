<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>12&nbsp; Data Cleaning and Preparation – Data Science I with python</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Data aggregation.html" rel="next">
<link href="./Advanced_Data_Visualization.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-8da5b4427184b79ecddefad3d342027e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Data cleaning and preparation.html">From messy to insight</a></li><li class="breadcrumb-item"><a href="./Data cleaning and preparation.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Data Cleaning and Preparation</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="https://statistics.northwestern.edu/" class="sidebar-logo-link">
      <img src="./NU_Stat_logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Science I with python</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Getting started</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./vscode_setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Setting up your environment with VS Code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./python_venv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Python Environments and Package Management</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow_enhance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Enhancing Workflow in Jupyter Notebooks</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Python refresher</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./python_basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Python Basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_structures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data Structures</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Core library foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Reading data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Reading Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./NumPy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">NumPy</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Pandas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Pandas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_types_in_pandas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">More on Pandas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Data visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Introduction to Data Visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Advanced_Data_Visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Advanced Data Visualization</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">From messy to insight</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Data cleaning and preparation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Data Cleaning and Preparation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Data aggregation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Data Grouping and Aggregation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Data wrangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Data Reshaping and Enrichment</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Assignment A.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Assignment A</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Datasets &amp; Templates</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#handling-missing-data" id="toc-handling-missing-data" class="nav-link active" data-scroll-target="#handling-missing-data"><span class="header-section-number">12.1</span> Handling missing data</a>
  <ul>
  <li><a href="#identifying-missing-values-in-a-dataframe" id="toc-identifying-missing-values-in-a-dataframe" class="nav-link" data-scroll-target="#identifying-missing-values-in-a-dataframe"><span class="header-section-number">12.1.1</span> Identifying missing values in a dataframe</a>
  <ul class="collapse">
  <li><a href="#describe-method" id="toc-describe-method" class="nav-link" data-scroll-target="#describe-method"><span class="header-section-number">12.1.1.1</span> <code>describe()</code> Method</a></li>
  <li><a href="#info-method" id="toc-info-method" class="nav-link" data-scroll-target="#info-method"><span class="header-section-number">12.1.1.2</span> <code>info()</code> Method</a></li>
  <li><a href="#isnull-method" id="toc-isnull-method" class="nav-link" data-scroll-target="#isnull-method"><span class="header-section-number">12.1.1.3</span> <code>isnull()</code> Method</a></li>
  </ul></li>
  <li><a href="#types-of-missing-values" id="toc-types-of-missing-values" class="nav-link" data-scroll-target="#types-of-missing-values"><span class="header-section-number">12.1.2</span> Types of Missing Values</a>
  <ul class="collapse">
  <li><a href="#missing-completely-at-random-mcar" id="toc-missing-completely-at-random-mcar" class="nav-link" data-scroll-target="#missing-completely-at-random-mcar"><span class="header-section-number">12.1.2.1</span> Missing Completely at Random (MCAR)</a></li>
  <li><a href="#missing-at-random-mar" id="toc-missing-at-random-mar" class="nav-link" data-scroll-target="#missing-at-random-mar"><span class="header-section-number">12.1.2.2</span> Missing at Random (MAR)</a></li>
  <li><a href="#missing-not-at-random-mnar" id="toc-missing-not-at-random-mnar" class="nav-link" data-scroll-target="#missing-not-at-random-mnar"><span class="header-section-number">12.1.2.3</span> Missing Not at Random (MNAR)</a></li>
  <li><a href="#questions" id="toc-questions" class="nav-link" data-scroll-target="#questions"><span class="header-section-number">12.1.2.4</span> Questions</a></li>
  </ul></li>
  <li><a href="#methods-for-handling-missing-values" id="toc-methods-for-handling-missing-values" class="nav-link" data-scroll-target="#methods-for-handling-missing-values"><span class="header-section-number">12.1.3</span> Methods for Handling missing values</a>
  <ul class="collapse">
  <li><a href="#removing-missing-values" id="toc-removing-missing-values" class="nav-link" data-scroll-target="#removing-missing-values"><span class="header-section-number">12.1.3.1</span> Removing Missing values</a></li>
  <li><a href="#imputing-missing-values" id="toc-imputing-missing-values" class="nav-link" data-scroll-target="#imputing-missing-values"><span class="header-section-number">12.1.3.2</span> Imputing Missing values</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#outlier-detection-and-handling" id="toc-outlier-detection-and-handling" class="nav-link" data-scroll-target="#outlier-detection-and-handling"><span class="header-section-number">12.2</span> Outlier detection and handling</a>
  <ul>
  <li><a href="#outlier-detection" id="toc-outlier-detection" class="nav-link" data-scroll-target="#outlier-detection"><span class="header-section-number">12.2.1</span> Outlier detection</a>
  <ul class="collapse">
  <li><a href="#visualization-methods" id="toc-visualization-methods" class="nav-link" data-scroll-target="#visualization-methods"><span class="header-section-number">12.2.1.1</span> Visualization Methods</a></li>
  <li><a href="#statistical-methods" id="toc-statistical-methods" class="nav-link" data-scroll-target="#statistical-methods"><span class="header-section-number">12.2.1.2</span> Statistical Methods</a></li>
  </ul></li>
  <li><a href="#common-methods-for-handling-outliers" id="toc-common-methods-for-handling-outliers" class="nav-link" data-scroll-target="#common-methods-for-handling-outliers"><span class="header-section-number">12.2.2</span> Common Methods for Handling outliers</a></li>
  </ul></li>
  <li><a href="#data-binning" id="toc-data-binning" class="nav-link" data-scroll-target="#data-binning"><span class="header-section-number">12.3</span> Data binning</a>
  <ul>
  <li><a href="#key-reasons-for-binning" id="toc-key-reasons-for-binning" class="nav-link" data-scroll-target="#key-reasons-for-binning"><span class="header-section-number">12.3.1</span> Key reasons for binning:</a></li>
  <li><a href="#common-binning-methods" id="toc-common-binning-methods" class="nav-link" data-scroll-target="#common-binning-methods"><span class="header-section-number">12.3.2</span> Common binning methods:</a>
  <ul class="collapse">
  <li><a href="#binning-with-equal-width-bins" id="toc-binning-with-equal-width-bins" class="nav-link" data-scroll-target="#binning-with-equal-width-bins"><span class="header-section-number">12.3.2.1</span> Binning with equal width bins</a></li>
  <li><a href="#binning-with-equal-sized-bins" id="toc-binning-with-equal-sized-bins" class="nav-link" data-scroll-target="#binning-with-equal-sized-bins"><span class="header-section-number">12.3.2.2</span> Binning with equal sized bins</a></li>
  <li><a href="#binning-with-custom-bins" id="toc-binning-with-custom-bins" class="nav-link" data-scroll-target="#binning-with-custom-bins"><span class="header-section-number">12.3.2.3</span> Binning with custom bins</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#dummy-indicator-variables" id="toc-dummy-indicator-variables" class="nav-link" data-scroll-target="#dummy-indicator-variables"><span class="header-section-number">12.4</span> Dummy / Indicator variables</a>
  <ul>
  <li><a href="#purpose" id="toc-purpose" class="nav-link" data-scroll-target="#purpose"><span class="header-section-number">12.4.1</span> Purpose:</a></li>
  <li><a href="#when-to-use-dummy-variables" id="toc-when-to-use-dummy-variables" class="nav-link" data-scroll-target="#when-to-use-dummy-variables"><span class="header-section-number">12.4.2</span> When to use dummy variables</a></li>
  <li><a href="#how-to-create-dummy-variables" id="toc-how-to-create-dummy-variables" class="nav-link" data-scroll-target="#how-to-create-dummy-variables"><span class="header-section-number">12.4.3</span> How to Create Dummy variables</a></li>
  <li><a href="#using-drop_first-to-avoid-multicollinearity" id="toc-using-drop_first-to-avoid-multicollinearity" class="nav-link" data-scroll-target="#using-drop_first-to-avoid-multicollinearity"><span class="header-section-number">12.4.4</span> Using <code>drop_first</code> to Avoid Multicollinearity</a></li>
  </ul></li>
  <li><a href="#independent-study" id="toc-independent-study" class="nav-link" data-scroll-target="#independent-study"><span class="header-section-number">12.5</span> Independent Study</a>
  <ul>
  <li><a href="#practice-exercise-1" id="toc-practice-exercise-1" class="nav-link" data-scroll-target="#practice-exercise-1"><span class="header-section-number">12.5.1</span> Practice exercise 1</a></li>
  <li><a href="#practice-exercise-2" id="toc-practice-exercise-2" class="nav-link" data-scroll-target="#practice-exercise-2"><span class="header-section-number">12.5.2</span> Practice exercise 2</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Data cleaning and preparation.html">From messy to insight</a></li><li class="breadcrumb-item"><a href="./Data cleaning and preparation.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Data Cleaning and Preparation</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Data Cleaning and Preparation</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="handling-missing-data" class="level2" data-number="12.1">
<h2 data-number="12.1" class="anchored" data-anchor-id="handling-missing-data"><span class="header-section-number">12.1</span> Handling missing data</h2>
<p>Missing values in a dataset can occur due to several reasons such as breakdown of measuring equipment, accidental removal of observations, lack of response by respondents, error on the part of the researcher, etc.</p>
<p>Let us read the dataset <em>GDP_missing_data.csv</em>, in which we have randomly removed some values, or put missing values in some of the columns.</p>
<p>We’ll also read <em>GDP_complete_data.csv</em>, in which we have not removed any values. We’ll use this data later to assess the accuracy of our guess or estimate of missing values in <em>GDP_missing_data.csv</em>.</p>
<div id="7d59f445" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sklearn <span class="im">as</span> sk</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(font_scale<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="278dabeb" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>gdp_missing_values_data <span class="op">=</span> pd.read_csv(<span class="st">'./Datasets/GDP_missing_data.csv'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>gdp_complete_data <span class="op">=</span> pd.read_csv(<span class="st">'./Datasets/GDP_complete_data.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="bfb5b2fb" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>gdp_missing_values_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">economicActivityFemale</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">lifeMale</th>
<th data-quarto-table-cell-role="th">infantMortality</th>
<th data-quarto-table-cell-role="th">gdpPerCapita</th>
<th data-quarto-table-cell-role="th">economicActivityMale</th>
<th data-quarto-table-cell-role="th">illiteracyMale</th>
<th data-quarto-table-cell-role="th">illiteracyFemale</th>
<th data-quarto-table-cell-role="th">lifeFemale</th>
<th data-quarto-table-cell-role="th">geographic_location</th>
<th data-quarto-table-cell-role="th">contraception</th>
<th data-quarto-table-cell-role="th">continent</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>7.2</td>
<td>Afghanistan</td>
<td>45.0</td>
<td>154.0</td>
<td>2474.0</td>
<td>87.5</td>
<td>NaN</td>
<td>85.0</td>
<td>46.0</td>
<td>Southern Asia</td>
<td>NaN</td>
<td>Asia</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>7.8</td>
<td>Algeria</td>
<td>67.5</td>
<td>44.0</td>
<td>11433.0</td>
<td>76.4</td>
<td>26.1</td>
<td>51.0</td>
<td>70.3</td>
<td>Northern Africa</td>
<td>NaN</td>
<td>Africa</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>41.3</td>
<td>Argentina</td>
<td>69.6</td>
<td>22.0</td>
<td>NaN</td>
<td>76.2</td>
<td>3.8</td>
<td>3.8</td>
<td>76.8</td>
<td>South America</td>
<td>NaN</td>
<td>South America</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>52.0</td>
<td>Armenia</td>
<td>67.2</td>
<td>25.0</td>
<td>13638.0</td>
<td>65.0</td>
<td>NaN</td>
<td>0.5</td>
<td>74.0</td>
<td>Western Asia</td>
<td>NaN</td>
<td>Asia</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>53.8</td>
<td>Australia</td>
<td>NaN</td>
<td>6.0</td>
<td>54891.0</td>
<td>NaN</td>
<td>1.0</td>
<td>1.0</td>
<td>81.2</td>
<td>Oceania</td>
<td>NaN</td>
<td>Oceania</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Observe that the <code>gdp_missing_values_data</code> dataset consists of some missing values shown as NaN (Not a Number).</p>
<section id="identifying-missing-values-in-a-dataframe" class="level3" data-number="12.1.1">
<h3 data-number="12.1.1" class="anchored" data-anchor-id="identifying-missing-values-in-a-dataframe"><span class="header-section-number">12.1.1</span> Identifying missing values in a dataframe</h3>
<p>There are multiple ways to identify missing values in a dataframe</p>
<section id="describe-method" class="level4" data-number="12.1.1.1">
<h4 data-number="12.1.1.1" class="anchored" data-anchor-id="describe-method"><span class="header-section-number">12.1.1.1</span> <code>describe()</code> Method</h4>
<p>Note that the descriptive statistics methods associated with Pandas objects ignore missing values by default. Consider the summary statistics of <code>gdp_missing_values_data</code>:</p>
<div id="7941d12d" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>gdp_missing_values_data.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">economicActivityFemale</th>
<th data-quarto-table-cell-role="th">lifeMale</th>
<th data-quarto-table-cell-role="th">infantMortality</th>
<th data-quarto-table-cell-role="th">gdpPerCapita</th>
<th data-quarto-table-cell-role="th">economicActivityMale</th>
<th data-quarto-table-cell-role="th">illiteracyMale</th>
<th data-quarto-table-cell-role="th">illiteracyFemale</th>
<th data-quarto-table-cell-role="th">lifeFemale</th>
<th data-quarto-table-cell-role="th">contraception</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>145.000000</td>
<td>145.000000</td>
<td>145.000000</td>
<td>145.000000</td>
<td>145.000000</td>
<td>145.000000</td>
<td>145.000000</td>
<td>145.000000</td>
<td>84.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>45.935172</td>
<td>65.491724</td>
<td>37.158621</td>
<td>24193.482759</td>
<td>76.563448</td>
<td>13.570028</td>
<td>21.448897</td>
<td>70.615862</td>
<td>51.773810</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>16.875922</td>
<td>9.099256</td>
<td>34.465699</td>
<td>22748.764444</td>
<td>7.854730</td>
<td>16.497954</td>
<td>25.497045</td>
<td>9.923791</td>
<td>31.930026</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>1.900000</td>
<td>36.000000</td>
<td>3.000000</td>
<td>772.000000</td>
<td>51.200000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>39.100000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>35.500000</td>
<td>62.900000</td>
<td>10.000000</td>
<td>6837.000000</td>
<td>72.000000</td>
<td>1.000000</td>
<td>2.300000</td>
<td>67.500000</td>
<td>17.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>47.600000</td>
<td>67.800000</td>
<td>24.000000</td>
<td>15184.000000</td>
<td>77.300000</td>
<td>6.600000</td>
<td>9.720000</td>
<td>73.900000</td>
<td>65.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>55.900000</td>
<td>72.400000</td>
<td>54.000000</td>
<td>35957.000000</td>
<td>81.600000</td>
<td>19.500000</td>
<td>30.200000</td>
<td>78.100000</td>
<td>77.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>90.600000</td>
<td>77.400000</td>
<td>169.000000</td>
<td>122740.000000</td>
<td>93.000000</td>
<td>70.500000</td>
<td>90.800000</td>
<td>82.900000</td>
<td>79.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Observe that the <code>count</code> statistics report the number of non-missing values of each column in the data, as the number of rows in the data (see code below) is more than the number of non-missing values of all the variables in the above table. Similarly, for the rest of the statistics, such as <code>mean</code>, <code>std</code>, etc., the missing values are ignored.</p>
<div id="fd044ff1" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#The dataset gdp_missing_values_data has 155 rows</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>gdp_missing_values_data.shape[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>155</code></pre>
</div>
</div>
</section>
<section id="info-method" class="level4" data-number="12.1.1.2">
<h4 data-number="12.1.1.2" class="anchored" data-anchor-id="info-method"><span class="header-section-number">12.1.1.2</span> <code>info()</code> Method</h4>
<p>Shows the count of non-null entries in each column, helping you quickly identify columns with missing values.</p>
<div id="08152b40" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>gdp_missing_values_data.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 155 entries, 0 to 154
Data columns (total 12 columns):
 #   Column                  Non-Null Count  Dtype  
---  ------                  --------------  -----  
 0   economicActivityFemale  145 non-null    float64
 1   country                 155 non-null    object 
 2   lifeMale                145 non-null    float64
 3   infantMortality         145 non-null    float64
 4   gdpPerCapita            145 non-null    float64
 5   economicActivityMale    145 non-null    float64
 6   illiteracyMale          145 non-null    float64
 7   illiteracyFemale        145 non-null    float64
 8   lifeFemale              145 non-null    float64
 9   geographic_location     155 non-null    object 
 10  contraception           84 non-null     float64
 11  continent               155 non-null    object 
dtypes: float64(9), object(3)
memory usage: 14.7+ KB</code></pre>
</div>
</div>
</section>
<section id="isnull-method" class="level4" data-number="12.1.1.3">
<h4 data-number="12.1.1.3" class="anchored" data-anchor-id="isnull-method"><span class="header-section-number">12.1.1.3</span> <code>isnull()</code> Method</h4>
<p>This is one of the most direct methods. Using <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.isnull.html"><code>df.isnull()</code></a> returns a DataFrame of Boolean values where <code>True</code> indicates a missing value. To get a summary, you can use <code>df.isnull().sum()</code> to see the count of missing values in each column.</p>
<p>For finding the number of missing values in each column of <code>gdp_missing_values_data</code>, we will sum up the missing values in each column of the dataset:</p>
<div id="1d6a22d2" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>gdp_missing_values_data.isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>economicActivityFemale    10
country                    0
lifeMale                  10
infantMortality           10
gdpPerCapita              10
economicActivityMale      10
illiteracyMale            10
illiteracyFemale          10
lifeFemale                10
geographic_location        0
contraception             71
continent                  0
dtype: int64</code></pre>
</div>
</div>
</section>
</section>
<section id="types-of-missing-values" class="level3" data-number="12.1.2">
<h3 data-number="12.1.2" class="anchored" data-anchor-id="types-of-missing-values"><span class="header-section-number">12.1.2</span> Types of Missing Values</h3>
<p>In data science, missing values typically fall into three main types, each requiring different handling strategies:</p>
<section id="missing-completely-at-random-mcar" class="level4" data-number="12.1.2.1">
<h4 data-number="12.1.2.1" class="anchored" data-anchor-id="missing-completely-at-random-mcar"><span class="header-section-number">12.1.2.1</span> Missing Completely at Random (MCAR)</h4>
<ul>
<li><strong>Definition</strong>: Missing values are entirely independent of any variables in the dataset.</li>
<li><strong>Example</strong>: A respondent accidentally skips a question on a survey.</li>
<li><strong>Impact</strong>: MCAR data can usually be ignored or imputed without biasing the analysis.</li>
<li><strong>Handling</strong>: Simple imputation methods, like filling with mean or median values, are often appropriate.</li>
</ul>
</section>
<section id="missing-at-random-mar" class="level4" data-number="12.1.2.2">
<h4 data-number="12.1.2.2" class="anchored" data-anchor-id="missing-at-random-mar"><span class="header-section-number">12.1.2.2</span> Missing at Random (MAR)</h4>
<ul>
<li><strong>Definition</strong>: The likelihood of a value being missing is related to other observed variables but not to the missing data itself.</li>
<li><strong>Example</strong>: People with higher incomes may be less likely to report their spending, but income data itself is not missing.</li>
<li><strong>Impact</strong>: Ignoring MAR values may bias results, so careful imputation based on related variables is recommended.</li>
<li><strong>Handling</strong>: More complex imputation methods, like conditional mean imputation or predictive modeling, are suitable.</li>
</ul>
</section>
<section id="missing-not-at-random-mnar" class="level4" data-number="12.1.2.3">
<h4 data-number="12.1.2.3" class="anchored" data-anchor-id="missing-not-at-random-mnar"><span class="header-section-number">12.1.2.3</span> Missing Not at Random (MNAR)</h4>
<ul>
<li><strong>Definition</strong>: The probability of missingness is related to the missing data itself, meaning the value is systematically missing.</li>
<li><strong>Example</strong>: Patients with severe health conditions might be less likely to report their health status, or students with low scores may be less likely to submit their grades.</li>
<li><strong>Impact</strong>: MNAR is the most challenging type, as missing values may introduce significant bias.</li>
<li><strong>Handling</strong>: Solutions often include sensitivity analysis, data augmentation, or modeling techniques that account for the missing mechanism, though sometimes domain-specific approaches are necessary.</li>
</ul>
<p>Understanding the type of missing data helps in selecting the right imputation method and mitigating potential biases in the analysis.</p>
</section>
<section id="questions" class="level4" data-number="12.1.2.4">
<h4 data-number="12.1.2.4" class="anchored" data-anchor-id="questions"><span class="header-section-number">12.1.2.4</span> Questions</h4>
<section id="section" class="level5" data-number="12.1.2.4.1">
<h5 data-number="12.1.2.4.1" class="anchored" data-anchor-id="section"><span class="header-section-number">12.1.2.4.1</span> </h5>
<p>Why can we ignore observations with missing values without risking skewing the analysis or trends in the case of <strong>Missing Completely at Random (MCAR)</strong>?</p>
</section>
<section id="section-1" class="level5" data-number="12.1.2.4.2">
<h5 data-number="12.1.2.4.2" class="anchored" data-anchor-id="section-1"><span class="header-section-number">12.1.2.4.2</span> </h5>
<p>Why could ignoring missing values lead to biased results for <strong>Missing at Random (MAR)</strong> and <strong>Missing Not at Random (MNAR)</strong> data?</p>
</section>
<section id="section-2" class="level5" data-number="12.1.2.4.3">
<h5 data-number="12.1.2.4.3" class="anchored" data-anchor-id="section-2"><span class="header-section-number">12.1.2.4.3</span> </h5>
<p>For the datset consisting of GDP per capita, think of hypothetical scenarios in which the missing values of GDP per capita can correspond to <strong>MCAR / MAR / MNAR</strong>.</p>
</section>
</section>
</section>
<section id="methods-for-handling-missing-values" class="level3" data-number="12.1.3">
<h3 data-number="12.1.3" class="anchored" data-anchor-id="methods-for-handling-missing-values"><span class="header-section-number">12.1.3</span> Methods for Handling missing values</h3>
<section id="removing-missing-values" class="level4" data-number="12.1.3.1">
<h4 data-number="12.1.3.1" class="anchored" data-anchor-id="removing-missing-values"><span class="header-section-number">12.1.3.1</span> Removing Missing values</h4>
<ul>
<li><strong>Row/Column Removal</strong>: Use [<code>df.dropna()</code>] (https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.dropna.html)
<ul>
<li>When to Use: if the missing values are few or the rows/columns are not critical.</li>
<li>Risks: Can reduce the dataset’s size, potentially losing valuable information.</li>
</ul></li>
</ul>
<p>Let us drop the rows containing even a single value from <code>gdp_missing_values_data</code>.</p>
<div id="13daeba7" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>gdp_no_missing_data <span class="op">=</span> gdp_missing_values_data.dropna()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>By default, <code>df.dropna()</code> will drop any row that contains at least one missing value, leaving only the rows that are completely free of missing values.</p>
<div id="a530dce3" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Shape of gdp_no_missing_data</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>gdp_no_missing_data.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>(42, 12)</code></pre>
</div>
</div>
<p>Using <code>df.dropna()</code> to remove rows with missing values can sometimes lead to a significant reduction in data, which can be problematic if much of the data is valuable and non-missing. For example:</p>
<ul>
<li><p><strong>Impact of Default Behavior</strong>: Dropping rows with even a single missing value reduced the number of rows from 155 to 42! This drastic reduction happens because, by default, dropna() removes any row with at least one missing value, keeping only rows that are completely complete.</p></li>
<li><p><strong>Loss of Non-Missing Data</strong>: Even though some columns may have very few missing values (e.g., at most 10), using dropna() without modification results in losing all non-missing data in affected rows. This is typically a poor choice, especially when valuable, non-missing data is removed unnecessarily.</p></li>
</ul>
<p>To avoid losing too much data, you can adjust the behavior of <code>dropna()</code> using these parameters:</p>
<ul>
<li><code>how</code> Parameter
<ul>
<li>Controls the criteria for dropping rows or columns.</li>
<li><code>how='any'</code> (default): Drops rows or columns if any values are missing.</li>
<li>`how=‘all’: Drops rows or columns only if all values are missing</li>
</ul></li>
<li><code>thresh</code> Parameter
<ul>
<li>Sets a minimum number of non-missing values required to retain the row or column.</li>
<li>Useful when you want to keep rows or columns with substantial, but not complete, data.</li>
</ul></li>
</ul>
<p>If a few values of a column are missing, we can possibly estimate them using the rest of the data, so that we can (hopefully) maximize the information that can be extracted from the data. However, if most of the values of a column are missing, it may be harder to estimate its values.</p>
<p>In this dataset, we see that around 50% values of the <code>contraception</code> column is missing. Thus, we’ll drop the column as it may be hard to impute its values based on a relatively small number of non-missing values.</p>
<div id="7a13e717" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Deleting column with missing values in almost half of the observations</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>gdp_missing_values_data.drop([<span class="st">'contraception'</span>],axis<span class="op">=</span><span class="dv">1</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>gdp_missing_values_data.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>(155, 11)</code></pre>
</div>
</div>
</section>
<section id="imputing-missing-values" class="level4" data-number="12.1.3.2">
<h4 data-number="12.1.3.2" class="anchored" data-anchor-id="imputing-missing-values"><span class="header-section-number">12.1.3.2</span> Imputing Missing values</h4>
<p>There are an unlimited number of ways to impute missing values. Some imputation methods are provided in the <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/missing_data.html">Pandas documentation</a>.</p>
<p>The best way to impute them will depend on the problem:</p>
<ul>
<li><strong>For MCAR</strong>: Simple imputation is generally acceptable.</li>
<li><strong>For MAR</strong>: Imputation should consider relationships with other variables, such as using conditional mean imputation.</li>
<li><strong>For MNAR</strong>: Imputation requires careful analysis, and domain knowledge is essential to avoid bias.</li>
</ul>
<p>Below are some of the most common methods. Recall that we randomly introduced missing values in <code>gdp_missing_values_data</code>, while the actual values are preserved in <code>gdp_complete_data</code>.</p>
<p>We will apply these methods to <code>gdp_missing_values_data</code>. To evaluate each method’s effectiveness in imputing missing values, we’ll compare the imputed gdpPerCapita values with the actual values and calculate the <code>Root Mean Square Error</code> (RMSE).</p>
<p>To visualize the imputed vs actual values, let’s define a helper function</p>
<div id="9d772302" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Index of rows with missing values for GDP per capita</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>null_ind_gdpPC <span class="op">=</span> gdp_missing_values_data.index[gdp_missing_values_data.gdpPerCapita.isnull()]</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Defining a function to plot the imputed values vs actual values </span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_actual_vs_predicted(y):</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    plt.rc(<span class="st">'xtick'</span>, labelsize<span class="op">=</span><span class="dv">15</span>) </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    plt.rc(<span class="st">'ytick'</span>, labelsize<span class="op">=</span><span class="dv">15</span>) </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> gdp_complete_data.loc[null_ind_gdpPC,<span class="st">'gdpPerCapita'</span>]</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># y = y.loc[null_ind_gdpPC,'gdpPerCapita']</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    plt.scatter(x,y.loc[null_ind_gdpPC,<span class="st">'gdpPerCapita'</span>])</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    z<span class="op">=</span>np.polyfit(x,y.loc[null_ind_gdpPC,<span class="st">'gdpPerCapita'</span>],<span class="dv">1</span>)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    p<span class="op">=</span>np.poly1d(z)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    plt.plot(x,x,color<span class="op">=</span><span class="st">'orange'</span>)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Actual GDP per capita'</span>,fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Imputed GDP per capita'</span>,fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    ax.xaxis.set_major_formatter(<span class="st">'$</span><span class="sc">{x:,.0f}</span><span class="st">'</span>)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    ax.yaxis.set_major_formatter(<span class="st">'$</span><span class="sc">{x:,.0f}</span><span class="st">'</span>)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    plt.rc(<span class="st">'axes'</span>, labelsize<span class="op">=</span><span class="dv">10</span>)  <span class="co"># Set all axis labels to fontsize 10</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plt.title('Actual vs Imputed values for GDP per capita',fontsize=20)</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    rmse <span class="op">=</span> np.sqrt(np.mean((y.loc[null_ind_gdpPC,<span class="st">'gdpPerCapita'</span>]<span class="op">-</span>x)<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    plt.text(<span class="dv">10000</span>, <span class="dv">50000</span>, <span class="st">'RMSE = </span><span class="sc">%.2f</span><span class="st">'</span><span class="op">%</span>rmse, fontsize<span class="op">=</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="meanmedianmode-imputation" class="level5" data-number="12.1.3.2.1">
<h5 data-number="12.1.3.2.1" class="anchored" data-anchor-id="meanmedianmode-imputation"><span class="header-section-number">12.1.3.2.1</span> Mean/Median/Mode Imputation</h5>
<p>This approach replaces missing values with the mean or median of the column.</p>
<p>Let’s impute missing values in the column by substituting them with the average of the non-missing values. Imputing with the mean tends to minimize the sum of squared differences between actual values and imputed values, especially in cases where data is Missing Completely at Random (MCAR). However, this might not hold true for other types of missing data, such as Missing at Random (MAR) or Missing Not at Random (MNAR).</p>
<p>Let us impute missing values in the column as the average of the non-missing values of the column. The sum of squared differences between actual values and the imputed values is likely to be smaller if we impute using the mean. However, this may not be true in cases other than MCAR (Missing completely at random).</p>
<div id="70bf73a8" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extracting the columns with missing values</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>columns_with_missing <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> gdp_missing_values_data.columns <span class="cf">if</span> gdp_missing_values_data[col].isnull().<span class="bu">any</span>()]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>columns_with_missing</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>['economicActivityFemale',
 'lifeMale',
 'infantMortality',
 'gdpPerCapita',
 'economicActivityMale',
 'illiteracyMale',
 'illiteracyFemale',
 'lifeFemale']</code></pre>
</div>
</div>
<div id="bead7963" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Imputing missing values using the mean</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>gdp_imputed_data_mean <span class="op">=</span> gdp_missing_values_data[columns_with_missing].fillna(gdp_missing_values_data[columns_with_missing].mean())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="254e959c" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>plot_actual_vs_predicted(gdp_imputed_data_mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Data cleaning and preparation_files/figure-html/cell-15-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Here, since all columns with missing values are numerical, we could use the mean to impute these values. Using the mean is generally suitable only for numerical data, as it represents a central tendency specific to numbers. For categorical data, however, mean imputation would be inappropriate. Instead, the mode, which identifies the most frequently occurring value, is a more suitable choice for imputing missing values in categorical columns.</p>
</section>
<section id="conditional-imputation-use-other-related-variables-to-predict-missing-values" class="level5" data-number="12.1.3.2.2">
<h5 data-number="12.1.3.2.2" class="anchored" data-anchor-id="conditional-imputation-use-other-related-variables-to-predict-missing-values"><span class="header-section-number">12.1.3.2.2</span> Conditional Imputation: Use other related variables to predict missing values</h5>
<p>There are three approaches within this category; please see the details below.</p>
<ul>
<li><strong>Imputing missing values based on correlated variables in the data</strong></li>
</ul>
<p>If a variable is highly correlated with another variable in the dataset, we can approximate its missing values using the trendline with the highly correlated variable.</p>
<p>Let us visualize the distribution of GDP per capita for different continents.</p>
<div id="a1bbbec5" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">"figure.figsize"</span>] <span class="op">=</span> (<span class="dv">12</span>,<span class="dv">6</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>sns.boxplot(x <span class="op">=</span> <span class="st">'continent'</span>,y<span class="op">=</span><span class="st">'gdpPerCapita'</span>,data <span class="op">=</span> gdp_missing_values_data)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Data cleaning and preparation_files/figure-html/cell-16-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We observe that there is a distinct difference between the GDPs per capita of some of the contents. Let us impute the missing GDP per capita of a country as the mean GDP per capita of the corresponding continent. This imputation should be better than imputing the missing GDP per capita as the mean of all the non-missing values, as the GDP per capita of a country is likely to be closer to the mean GDP per capita of the continent, rather the mean GDP per capita of the whole world.</p>
<div id="cb7e3da5" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Finding the mean GDP per capita of the continent - please defer the understanding of this code to chapter 9.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>avg_gdpPerCapita <span class="op">=</span> gdp_missing_values_data[<span class="st">'gdpPerCapita'</span>].groupby(gdp_missing_values_data[<span class="st">'continent'</span>]).mean()</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>avg_gdpPerCapita</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>continent
Africa            7638.178571
Asia             25922.750000
Europe           45455.303030
North America    19625.210526
Oceania          15385.857143
South America    15360.909091
Name: gdpPerCapita, dtype: float64</code></pre>
</div>
</div>
<div id="42887061" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating a copy of missing data to impute missing values</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>gdp_imputed_data_group_mean <span class="op">=</span> gdp_missing_values_data.copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="0b46a496" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Replacing missing GDP per capita with the mean GDP per capita for the corresponding continent</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>gdp_imputed_data_group_mean.gdpPerCapita <span class="op">=</span> <span class="op">\</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>gdp_imputed_data_group_mean[<span class="st">'gdpPerCapita'</span>].fillna(gdp_imputed_data_group_mean[<span class="st">'continent'</span>].<span class="bu">map</span>(avg_gdpPerCapita))</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>plot_actual_vs_predicted(gdp_imputed_data_group_mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Data cleaning and preparation_files/figure-html/cell-19-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Note that the imputed values are closer to the actual values, and the RMSE has further reduced as expected.</p>
<p>Suppose we wish to impute the missing values of each numeric column with the average of the non-missing values of the respective column corresponding to the continent of the observation. The above logic can be extended to each column as shown in the code below.</p>
<div id="064c8d36" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>all_columns_imputed_data <span class="op">=</span> gdp_missing_values_data.iloc[:,[<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>]].<span class="bu">apply</span>(<span class="kw">lambda</span> x:<span class="op">\</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>x.fillna(gdp_imputed_data_group_mean[<span class="st">'continent'</span>].<span class="bu">map</span>(x.groupby(gdp_missing_values_data[<span class="st">'continent'</span>]).mean())))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Using Regression</strong></p>
<div id="a425e4d8" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Let us identify the variable highly correlated with GDP per capita.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>gdp_missing_values_data.select_dtypes(include<span class="op">=</span><span class="st">'number'</span>).corrwith(gdp_missing_values_data.gdpPerCapita)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>economicActivityFemale    0.078332
lifeMale                  0.579850
infantMortality          -0.572201
gdpPerCapita              1.000000
economicActivityMale     -0.134108
illiteracyMale           -0.479143
illiteracyFemale         -0.448273
lifeFemale                0.615954
dtype: float64</code></pre>
</div>
</div>
<div id="af455ccf" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#The variable *lifeFemale* has the strongest correlation with GDP per capita. Let us use it to impute missing values of GDP per capita.</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  Extract the variables lifeFemale and GDP per capita</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> gdp_missing_values_data.lifeFemale</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> gdp_missing_values_data.gdpPerCapita</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co">#  Identify non-missing indices</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>idx_non_missing <span class="op">=</span> np.isfinite(x) <span class="op">&amp;</span> np.isfinite(y)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a linear regression model (degree=1) to predict GDP per capita given lifeFemale</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>slope_intercept_trendline <span class="op">=</span> np.polyfit(x[idx_non_missing],y[idx_non_missing],<span class="dv">1</span>)   <span class="co">#Finding the slope and intercept for the trendline</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>compute_y_given_x <span class="op">=</span> np.poly1d(slope_intercept_trendline)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating a copy of missing data to impute missing values</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>gdp_imputed_data_lr <span class="op">=</span> gdp_missing_values_data.copy()</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Imputing missing values of GDP per capita using the linear regression model</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>gdp_imputed_data_lr.loc[null_ind_gdpPC,<span class="st">'gdpPerCapita'</span>]<span class="op">=</span>compute_y_given_x(gdp_missing_values_data.loc[null_ind_gdpPC,<span class="st">'lifeFemale'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="573d9de8" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>plot_actual_vs_predicted(gdp_imputed_data_lr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Data cleaning and preparation_files/figure-html/cell-23-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>KNN: K-nearest neighbor</strong></p>
<p>In this method, we’ll impute the missing value of the variable as the mean value of the <span class="math inline">\(K\)</span>-nearest neighbors having non-missing values for that variable. The neighbors to a data-point are identified based on their Euclidean distance to the point in terms of the standardized values of rest of the variables in the data.</p>
<p>Let’s consider a toy example to understand missing value imputation by KNN. Suppose we have to impute missing values in a toy dataset, named as <code>toy_data</code> having 4 observations and 3 variables.</p>
<div id="c2b668fb" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Toy example - A 4x3 array with missing values</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>nan <span class="op">=</span> np.nan</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>toy_data <span class="op">=</span> np.array([[<span class="dv">1</span>, <span class="dv">2</span>, nan], [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">3</span>], [nan, <span class="dv">6</span>, <span class="dv">5</span>], [<span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">7</span>]])</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>toy_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>array([[ 1.,  2., nan],
       [ 3.,  4.,  3.],
       [nan,  6.,  5.],
       [ 8.,  8.,  7.]])</code></pre>
</div>
</div>
<p>We’ll use some functions from the <em>sklearn</em> library to perform the KNN imputation. It is much easier to directly use the algorithm from <em>sklearn</em>, instead of coding it from scratch.</p>
<div id="00acdd70" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Library to compute pair-wise Euclidean distance between all observations in the data</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> metrics</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Library to impute missing values with the KNN algorithm</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> impute</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ll use the <em>sklearn</em> function <a href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.pairwise.nan_euclidean_distances.html">nan_euclidean_distances()</a> to compute the Euclidean distance between all pairs of observations in the data.</p>
<div id="e19fa62a" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">#This is the distance matrix containing the distance of the ith observation from the jth observation at the (i,j) position in the matrix</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>metrics.pairwise.nan_euclidean_distances(toy_data,toy_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>array([[ 0.        ,  3.46410162,  6.92820323, 11.29158979],
       [ 3.46410162,  0.        ,  3.46410162,  7.54983444],
       [ 6.92820323,  3.46410162,  0.        ,  3.46410162],
       [11.29158979,  7.54983444,  3.46410162,  0.        ]])</code></pre>
</div>
</div>
<p>Note that the size of the above matrix is 4x4. This is because the <span class="math inline">\((i,j)^{th}\)</span> element of the matrix is the distance of the <span class="math inline">\(i^{th}\)</span> observation from the <span class="math inline">\(j^{th}\)</span> observation. The matrix is symmetric because the distance of <span class="math inline">\(i^{th}\)</span> observation to the <span class="math inline">\(j^{th}\)</span> observation is the same as the distance of the <span class="math inline">\(j^{th}\)</span> observation to the <span class="math inline">\(i^{th}\)</span> observation.</p>
<p>We’ll use the <em>sklearn</em> function <a href="https://scikit-learn.org/stable/modules/generated/sklearn.impute.KNNImputer.html">KNNImputer()</a> to impute the missing value of a column in <code>toy_data</code> as the mean of the values of the <span class="math inline">\(K\)</span> nearest neighbors to the observation that have non-missing values for that column.</p>
<p>Let us impute the missing values in <code>toy_data</code> using the values of <span class="math inline">\(K=2\)</span> nearest neighbors from the corresponding observation.</p>
<div id="008a7015" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#imputing missing values with 2 nearest neighbors, where the neighbors have equal weights</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Define an object of type KNNImputer</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>imputer <span class="op">=</span> impute.KNNImputer(n_neighbors<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Use the object method 'fit_transform' to impute missing values</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>imputer.fit_transform(toy_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>array([[1. , 2. , 4. ],
       [3. , 4. , 3. ],
       [5.5, 6. , 5. ],
       [8. , 8. , 7. ]])</code></pre>
</div>
</div>
<p>The third observation was the closest to the <span class="math inline">\(2nd\)</span> and <span class="math inline">\(4th\)</span> observations based on the Euclidean distance matrix. Thus, the missing value in the <span class="math inline">\(3rd\)</span> row of the <code>toy_data</code> has been imputed as the mean of the values in the <span class="math inline">\(2nd\)</span> and <span class="math inline">\(4th\)</span> observations for the corresponding column. Similarly, the <span class="math inline">\(1st\)</span> observation is the closest to the <span class="math inline">\(2nd\)</span> and <span class="math inline">\(3rd\)</span> observations. Thus the missing value in the <span class="math inline">\(1st\)</span> row of <code>toy_data</code> has been imputed as the mean of the values in the <span class="math inline">\(1st\)</span> and <span class="math inline">\(2nd\)</span> observations for the corresponding column.</p>
<p>Let us use KNN to impute the missing values of <code>gdpPerCapita</code> in <code>gdp_missing_values_data</code>. We’ll use only the numeric columns of the data in imputing the missing values. Also, we’ll ignore <code>contraception</code> as it has a lot of missing values, and thus may not be useful.</p>
<div id="3f48d8c2" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Considering numeric columns in the data to use KNN</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>num_cols <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">1</span>))<span class="op">+</span><span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">2</span>,<span class="dv">9</span>))</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>num_cols</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>[0, 2, 3, 4, 5, 6, 7, 8]</code></pre>
</div>
</div>
<p>Before computing the pair-wise Euclidean distance of observations, we must standardize the data so that all columns are at the same scale. This will avoid columns with a higher magnitude of values having a higher weight in determining the Euclidean distance. Unless there is a reason to give a higher weight to a column, we assume all columns to have the same weight in the Euclidean distance computation.</p>
<p>We can use the code below to scale the data. However, after imputing the missing values, the data is to be scaled back to the original scale, so that each variable is in the same units as in the original dataset. However, if the code below is used, we’ll lose the orginal scale of each of the columns.</p>
<div id="991638d1" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Scaling data to compute equally weighted distances from the 'k' nearest neighbors</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>scaled_data <span class="op">=</span> gdp_missing_values_data.iloc[:,num_cols].<span class="bu">apply</span>(<span class="kw">lambda</span> x:(x<span class="op">-</span>x.<span class="bu">min</span>())<span class="op">/</span>(x.<span class="bu">max</span>()<span class="op">-</span>x.<span class="bu">min</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To alleviate the problem of losing the orignial scale of the data, we’ll use the <a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.MinMaxScaler.html">MinMaxScaler</a> object of the <em>sklearn</em> library. The object will store the original scale of the data, which will help transform the data back to the original scale once the missing values have been imputed in the standardized data.</p>
<div id="62ab447a" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scaling data - using sklearn</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Create an object of type MinMaxScaler</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> sk.preprocessing.MinMaxScaler()</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Use the object method 'fit_transform' to scale the values to a standard uniform distribution</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>scaled_data <span class="op">=</span> pd.DataFrame(scaler.fit_transform(gdp_missing_values_data.iloc[:,num_cols]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="75557f8c" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Imputing missing values with KNNImputer</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Define an object of type KNNImputer</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>imputer <span class="op">=</span> impute.KNNImputer(n_neighbors<span class="op">=</span><span class="dv">3</span>, weights<span class="op">=</span><span class="st">"uniform"</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Use the object method 'fit_transform' to impute missing values</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>imputed_arr <span class="op">=</span> imputer.fit_transform(scaled_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="1d54122b" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Scaling back the scaled array to obtain the data at the original scale</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Use the object method 'inverse_transform' to scale back the values to the original scale of the data</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>unscaled_data <span class="op">=</span> scaler.inverse_transform(imputed_arr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="7d39ceb0" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Note the method imputes the missing value of all the columns</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co">#However, we are interested in imputing the missing values of only the 'gdpPerCapita' column</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>gdp_imputed_data_knn <span class="op">=</span> gdp_missing_values_data.copy()</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>gdp_imputed_data_knn.loc[:,<span class="st">'gdpPerCapita'</span>] <span class="op">=</span> unscaled_data[:,<span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="da69794b" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Visualizing the accuracy of missing value imputation with KNN</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>plot_actual_vs_predicted(gdp_imputed_data_knn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Data cleaning and preparation_files/figure-html/cell-34-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Note that the RMSE is the lowest in this method. It is because this method imputes missing values as the average of the values of “similar” observations, which is smarter and more robust than the previous methods.</p>
<p>We chose <span class="math inline">\(K=3\)</span> in the missing value imputation for GDP per capita. However, the value of <span class="math inline">\(K\)</span> is typically chosen using a method known as cross validation. We’ll learn about cross-validation in the next course of the sequence.</p>
</section>
<section id="forward-fillbackward-fill" class="level5" data-number="12.1.3.2.3">
<h5 data-number="12.1.3.2.3" class="anchored" data-anchor-id="forward-fillbackward-fill"><span class="header-section-number">12.1.3.2.3</span> Forward Fill/Backward Fill</h5>
<p>To fill missing values in a column by copying the value of the previous or next non-missing observation, we can use forward fill (propagating the last valid observation forward) or backward fill (propagating the next valid observation backward).</p>
<p>Below, we demonstrate forward fill. To perform backward fill instead, simply replace <code>ffill</code> with <code>bfill</code></p>
<div id="343ac5e4" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Filling missing values: Method 1- Naive way</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>gdp_imputed_data_ffill <span class="op">=</span> gdp_missing_values_data.ffill()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let us next check how good is this method in imputing missing values.</p>
<div id="0938ab13" class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>plot_actual_vs_predicted(gdp_imputed_data_ffill)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Data cleaning and preparation_files/figure-html/cell-36-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We observe that the accuracy of imputation is poor as GDP per capita can vary a lot across countries, and the data is not sorted by GDP per capita. There is no reason why the GDP per capita of a country should be close to the GDP per capita of the country in the observation above it.</p>
<div id="f066658b" class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Checking if any missing values are remaining</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>gdp_imputed_data_ffill.isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>economicActivityFemale    0
country                   0
lifeMale                  0
infantMortality           0
gdpPerCapita              0
economicActivityMale      0
illiteracyMale            1
illiteracyFemale          0
lifeFemale                0
geographic_location       0
continent                 0
dtype: int64</code></pre>
</div>
</div>
<p>After imputing missing values, note there is still one missing value for <em>illiteracyMale</em>. Can you guess why one missing value remained?</p>
</section>
</section>
</section>
</section>
<section id="outlier-detection-and-handling" class="level2" data-number="12.2">
<h2 data-number="12.2" class="anchored" data-anchor-id="outlier-detection-and-handling"><span class="header-section-number">12.2</span> Outlier detection and handling</h2>
<p>An outlier is an observation that is significantly different from the rest of the data. Outlier detection and handling are important in data science because outliers can significantly impact the quality, accuracy, and interpretability of data analysis and model performance. Here are the main reasons why it’s crucial to address outliers:</p>
<ul>
<li><strong>Preventing Skewed Results:</strong> Outliers can distort statistical measures, such as the mean and standard deviation, leading to misleading interpretations of the data. For example, a few extreme values can inflate the mean, making the data seem larger than it is in reality.</li>
<li><strong>Improving Model Accuracy:</strong> Many machine learning algorithms are sensitive to outliers and can perform poorly if outliers are present. For instance, in linear regression, outliers can disproportionately affect the model by pulling the line of best fit toward them, reducing predictive accuracy.</li>
<li><strong>Enhancing Robustness of Models:</strong> Identifying and handling outliers can make models more robust and stable. By minimizing the influence of extreme values, models become less sensitive to noise, which improves generalization and reduces overfitting.</li>
</ul>
<section id="outlier-detection" class="level3" data-number="12.2.1">
<h3 data-number="12.2.1" class="anchored" data-anchor-id="outlier-detection"><span class="header-section-number">12.2.1</span> Outlier detection</h3>
<p>Outlier detection is crucial for identifying unusual values in your data that may need to be investigated, removed, or transformed. Here are several popular methods for detecting outliers:</p>
<p>We will use <em>College.csv</em> that contains information about US universities as our dataset in this section. The description of variables of the dataset can be found on page 65 of this <a href="https://www.statlearning.com/resources-python">book</a>.</p>
<div id="58826992" class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the College dataset</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>college <span class="op">=</span> pd.read_csv(<span class="st">'./Datasets/College.csv'</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>college.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Unnamed: 0</th>
<th data-quarto-table-cell-role="th">Private</th>
<th data-quarto-table-cell-role="th">Apps</th>
<th data-quarto-table-cell-role="th">Accept</th>
<th data-quarto-table-cell-role="th">Enroll</th>
<th data-quarto-table-cell-role="th">Top10perc</th>
<th data-quarto-table-cell-role="th">Top25perc</th>
<th data-quarto-table-cell-role="th">F.Undergrad</th>
<th data-quarto-table-cell-role="th">P.Undergrad</th>
<th data-quarto-table-cell-role="th">Outstate</th>
<th data-quarto-table-cell-role="th">Room.Board</th>
<th data-quarto-table-cell-role="th">Books</th>
<th data-quarto-table-cell-role="th">Personal</th>
<th data-quarto-table-cell-role="th">PhD</th>
<th data-quarto-table-cell-role="th">Terminal</th>
<th data-quarto-table-cell-role="th">S.F.Ratio</th>
<th data-quarto-table-cell-role="th">perc.alumni</th>
<th data-quarto-table-cell-role="th">Expend</th>
<th data-quarto-table-cell-role="th">Grad.Rate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Abilene Christian University</td>
<td>Yes</td>
<td>1660</td>
<td>1232</td>
<td>721</td>
<td>23</td>
<td>52</td>
<td>2885</td>
<td>537</td>
<td>7440</td>
<td>3300</td>
<td>450</td>
<td>2200</td>
<td>70</td>
<td>78</td>
<td>18.1</td>
<td>12</td>
<td>7041</td>
<td>60</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Adelphi University</td>
<td>Yes</td>
<td>2186</td>
<td>1924</td>
<td>512</td>
<td>16</td>
<td>29</td>
<td>2683</td>
<td>1227</td>
<td>12280</td>
<td>6450</td>
<td>750</td>
<td>1500</td>
<td>29</td>
<td>30</td>
<td>12.2</td>
<td>16</td>
<td>10527</td>
<td>56</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Adrian College</td>
<td>Yes</td>
<td>1428</td>
<td>1097</td>
<td>336</td>
<td>22</td>
<td>50</td>
<td>1036</td>
<td>99</td>
<td>11250</td>
<td>3750</td>
<td>400</td>
<td>1165</td>
<td>53</td>
<td>66</td>
<td>12.9</td>
<td>30</td>
<td>8735</td>
<td>54</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Agnes Scott College</td>
<td>Yes</td>
<td>417</td>
<td>349</td>
<td>137</td>
<td>60</td>
<td>89</td>
<td>510</td>
<td>63</td>
<td>12960</td>
<td>5450</td>
<td>450</td>
<td>875</td>
<td>92</td>
<td>97</td>
<td>7.7</td>
<td>37</td>
<td>19016</td>
<td>59</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Alaska Pacific University</td>
<td>Yes</td>
<td>193</td>
<td>146</td>
<td>55</td>
<td>16</td>
<td>44</td>
<td>249</td>
<td>869</td>
<td>7560</td>
<td>4120</td>
<td>800</td>
<td>1500</td>
<td>76</td>
<td>72</td>
<td>11.9</td>
<td>2</td>
<td>10922</td>
<td>15</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="visualization-methods" class="level4" data-number="12.2.1.1">
<h4 data-number="12.2.1.1" class="anchored" data-anchor-id="visualization-methods"><span class="header-section-number">12.2.1.1</span> Visualization Methods</h4>
<ul>
<li><strong>Box Plot</strong>: A box plot is a quick and visual way to detect outliers, where points outside the “whiskers” are considered outliers.</li>
</ul>
<p>Let us visualize outliers in average instructional expenditure per student given by the variable <code>Expend</code>.</p>
<div id="09a9ef8b" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>college.boxplot(column <span class="op">=</span> <span class="st">'Expend'</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>ax.yaxis.set_major_formatter(<span class="st">'$</span><span class="sc">{x:,.0f}</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Data cleaning and preparation_files/figure-html/cell-39-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>There are several outliers (shown as circles in the above boxplot), which correspond to high values of average instructional expenditure per student.</p>
<ul>
<li><strong>Histogram</strong>: Histograms can reveal unusual values as isolated bars, helping to identify outliers in a single feature.</li>
</ul>
<div id="3167391c" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a histogram of expend</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>college[<span class="st">'Expend'</span>].plot(kind<span class="op">=</span><span class="st">'hist'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, bins<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Expenditure'</span>)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Frequency'</span>)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Histogram of Expenditure'</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Data cleaning and preparation_files/figure-html/cell-40-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><strong>Scatter Plot</strong>: A scatter plot can reveal outliers, especially in two-dimensional data. Outliers will often appear as points separated from the main cluster.</li>
</ul>
<p>Let’s make a scatterplot of ‘Grad.Rate’ vs ‘Expend’ with a trendline, to visualize potential outliers</p>
<div id="f998c6c7" class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(font_scale<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>sns.regplot(data <span class="op">=</span> college, x <span class="op">=</span> <span class="st">"Expend"</span>, y <span class="op">=</span> <span class="st">"Grad.Rate"</span>,scatter_kws<span class="op">=</span>{<span class="st">"color"</span>: <span class="st">"orange"</span>}, line_kws<span class="op">=</span>{<span class="st">"color"</span>: <span class="st">"blue"</span>})</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_major_formatter(<span class="st">'$</span><span class="sc">{x:,.0f}</span><span class="st">'</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Expenditure per student'</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Graduation rate'</span>)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Data cleaning and preparation_files/figure-html/cell-41-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The trendline indicates a positive correlation between <code>Expend</code> and <code>Grad.Rate</code>. However, there seems to be a lot of noise and presence of outliers in the data.</p>
</section>
<section id="statistical-methods" class="level4" data-number="12.2.1.2">
<h4 data-number="12.2.1.2" class="anchored" data-anchor-id="statistical-methods"><span class="header-section-number">12.2.1.2</span> Statistical Methods</h4>
<p>Visualization helps us identify potential outliers. To address them effectively, we need to extract these outlier instances using a defined threshold. Two commonly used statistical methods for this purpose are the Z-Score method and the Interquartile Range (IQR) (Tukey’s fences).</p>
<section id="z-score-standard-score" class="level5" data-number="12.2.1.2.1">
<h5 data-number="12.2.1.2.1" class="anchored" data-anchor-id="z-score-standard-score"><span class="header-section-number">12.2.1.2.1</span> Z-Score (Standard Score)</h5>
<p>Calculates how many standard deviations a data point is from the mean. Commonly, data points with a Z-score greater than 3 (or less than -3) are considered outliers.</p>
<div id="b95cac81" class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Z-scores and identify outliers</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>college[<span class="st">'z_score'</span>] <span class="op">=</span> stats.zscore(college[<span class="st">'Expend'</span>])</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>college[<span class="st">'is_z_score_outlier'</span>] <span class="op">=</span> college[<span class="st">'z_score'</span>].<span class="bu">abs</span>() <span class="op">&gt;</span> <span class="dv">3</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to show only the outliers</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>z_score_outliers <span class="op">=</span> college[college[<span class="st">'is_z_score_outlier'</span>]]</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(z_score_outliers.shape)</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>z_score_outliers.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(16, 21)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="60">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Unnamed: 0</th>
<th data-quarto-table-cell-role="th">Private</th>
<th data-quarto-table-cell-role="th">Apps</th>
<th data-quarto-table-cell-role="th">Accept</th>
<th data-quarto-table-cell-role="th">Enroll</th>
<th data-quarto-table-cell-role="th">Top10perc</th>
<th data-quarto-table-cell-role="th">Top25perc</th>
<th data-quarto-table-cell-role="th">F.Undergrad</th>
<th data-quarto-table-cell-role="th">P.Undergrad</th>
<th data-quarto-table-cell-role="th">Outstate</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Books</th>
<th data-quarto-table-cell-role="th">Personal</th>
<th data-quarto-table-cell-role="th">PhD</th>
<th data-quarto-table-cell-role="th">Terminal</th>
<th data-quarto-table-cell-role="th">S.F.Ratio</th>
<th data-quarto-table-cell-role="th">perc.alumni</th>
<th data-quarto-table-cell-role="th">Expend</th>
<th data-quarto-table-cell-role="th">Grad.Rate</th>
<th data-quarto-table-cell-role="th">z_score</th>
<th data-quarto-table-cell-role="th">is_z_score_outlier</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>Antioch University</td>
<td>Yes</td>
<td>713</td>
<td>661</td>
<td>252</td>
<td>25</td>
<td>44</td>
<td>712</td>
<td>23</td>
<td>15476</td>
<td>...</td>
<td>400</td>
<td>1100</td>
<td>69</td>
<td>82</td>
<td>11.3</td>
<td>35</td>
<td>42926</td>
<td>48</td>
<td>6.374709</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">144</td>
<td>Columbia University</td>
<td>Yes</td>
<td>6756</td>
<td>1930</td>
<td>871</td>
<td>78</td>
<td>96</td>
<td>3376</td>
<td>55</td>
<td>18624</td>
<td>...</td>
<td>550</td>
<td>300</td>
<td>97</td>
<td>98</td>
<td>5.9</td>
<td>21</td>
<td>30639</td>
<td>99</td>
<td>4.020159</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">158</td>
<td>Dartmouth College</td>
<td>Yes</td>
<td>8587</td>
<td>2273</td>
<td>1087</td>
<td>87</td>
<td>99</td>
<td>3918</td>
<td>32</td>
<td>19545</td>
<td>...</td>
<td>550</td>
<td>1100</td>
<td>95</td>
<td>99</td>
<td>4.7</td>
<td>49</td>
<td>29619</td>
<td>98</td>
<td>3.824698</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">174</td>
<td>Duke University</td>
<td>Yes</td>
<td>13789</td>
<td>3893</td>
<td>1583</td>
<td>90</td>
<td>98</td>
<td>6188</td>
<td>53</td>
<td>18590</td>
<td>...</td>
<td>625</td>
<td>1162</td>
<td>95</td>
<td>96</td>
<td>5.0</td>
<td>44</td>
<td>27206</td>
<td>97</td>
<td>3.362296</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">191</td>
<td>Emory University</td>
<td>Yes</td>
<td>8506</td>
<td>4168</td>
<td>1236</td>
<td>76</td>
<td>97</td>
<td>5544</td>
<td>192</td>
<td>17600</td>
<td>...</td>
<td>600</td>
<td>870</td>
<td>97</td>
<td>98</td>
<td>5.0</td>
<td>28</td>
<td>28457</td>
<td>96</td>
<td>3.602024</td>
<td>True</td>
</tr>
</tbody>
</table>

<p>5 rows × 21 columns</p>
</div>
</div>
</div>
<p>Boxplot identifies outliers based on the <a href="https://en.wikipedia.org/wiki/Outlier">Tukey’s fences</a> criterion:</p>
</section>
<section id="iqr-method-tukeys-fences" class="level5" data-number="12.2.1.2.2">
<h5 data-number="12.2.1.2.2" class="anchored" data-anchor-id="iqr-method-tukeys-fences"><span class="header-section-number">12.2.1.2.2</span> IQR method (Tukey’s fences)</h5>
<p>John Tukey proposed that observations outside the range <span class="math inline">\([Q1 - 1.5(Q3-Q1), Q3+1.5(Q3-Q1)]\)</span> are outliers, where <span class="math inline">\(Q1\)</span> and <span class="math inline">\(Q3\)</span> are the lower <span class="math inline">\((25\%)\)</span> and upper <span class="math inline">\((75\%)\)</span> quartiles respectively. Let us detect outliers based on this threshold.</p>
<div id="61052abc" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the first and third quartiles, and the IQR</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>Q1 <span class="op">=</span> np.percentile(college[<span class="st">'Expend'</span>], <span class="dv">25</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>Q3 <span class="op">=</span> np.percentile(college[<span class="st">'Expend'</span>], <span class="dv">75</span>)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>IQR <span class="op">=</span> Q3 <span class="op">-</span> Q1</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the lower and upper bounds for outliers</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>lower_bound <span class="op">=</span> Q1 <span class="op">-</span> <span class="fl">1.5</span> <span class="op">*</span> IQR</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>upper_bound <span class="op">=</span> Q3 <span class="op">+</span> <span class="fl">1.5</span> <span class="op">*</span> IQR</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a new column to indicate IQR outliers</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>college[<span class="st">'is_IQR_outlier'</span>] <span class="op">=</span> (college[<span class="st">'Expend'</span>] <span class="op">&lt;</span> lower_bound) <span class="op">|</span> (college[<span class="st">'Expend'</span>] <span class="op">&gt;</span> upper_bound)</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to show only the IQR outliers</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>iqr_outliers <span class="op">=</span> college[college[<span class="st">'is_IQR_outlier'</span>]]</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(iqr_outliers.shape)</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>iqr_outliers.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(48, 22)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="61">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Unnamed: 0</th>
<th data-quarto-table-cell-role="th">Private</th>
<th data-quarto-table-cell-role="th">Apps</th>
<th data-quarto-table-cell-role="th">Accept</th>
<th data-quarto-table-cell-role="th">Enroll</th>
<th data-quarto-table-cell-role="th">Top10perc</th>
<th data-quarto-table-cell-role="th">Top25perc</th>
<th data-quarto-table-cell-role="th">F.Undergrad</th>
<th data-quarto-table-cell-role="th">P.Undergrad</th>
<th data-quarto-table-cell-role="th">Outstate</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Personal</th>
<th data-quarto-table-cell-role="th">PhD</th>
<th data-quarto-table-cell-role="th">Terminal</th>
<th data-quarto-table-cell-role="th">S.F.Ratio</th>
<th data-quarto-table-cell-role="th">perc.alumni</th>
<th data-quarto-table-cell-role="th">Expend</th>
<th data-quarto-table-cell-role="th">Grad.Rate</th>
<th data-quarto-table-cell-role="th">z_score</th>
<th data-quarto-table-cell-role="th">is_z_score_outlier</th>
<th data-quarto-table-cell-role="th">is_IQR_outlier</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>Agnes Scott College</td>
<td>Yes</td>
<td>417</td>
<td>349</td>
<td>137</td>
<td>60</td>
<td>89</td>
<td>510</td>
<td>63</td>
<td>12960</td>
<td>...</td>
<td>875</td>
<td>92</td>
<td>97</td>
<td>7.7</td>
<td>37</td>
<td>19016</td>
<td>59</td>
<td>1.792851</td>
<td>False</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">16</td>
<td>Amherst College</td>
<td>Yes</td>
<td>4302</td>
<td>992</td>
<td>418</td>
<td>83</td>
<td>96</td>
<td>1593</td>
<td>5</td>
<td>19760</td>
<td>...</td>
<td>1598</td>
<td>93</td>
<td>98</td>
<td>8.4</td>
<td>63</td>
<td>21424</td>
<td>100</td>
<td>2.254295</td>
<td>False</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>Antioch University</td>
<td>Yes</td>
<td>713</td>
<td>661</td>
<td>252</td>
<td>25</td>
<td>44</td>
<td>712</td>
<td>23</td>
<td>15476</td>
<td>...</td>
<td>1100</td>
<td>69</td>
<td>82</td>
<td>11.3</td>
<td>35</td>
<td>42926</td>
<td>48</td>
<td>6.374709</td>
<td>True</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">60</td>
<td>Bowdoin College</td>
<td>Yes</td>
<td>3356</td>
<td>1019</td>
<td>418</td>
<td>76</td>
<td>100</td>
<td>1490</td>
<td>8</td>
<td>19030</td>
<td>...</td>
<td>875</td>
<td>93</td>
<td>96</td>
<td>11.2</td>
<td>52</td>
<td>20447</td>
<td>96</td>
<td>2.067073</td>
<td>False</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">64</td>
<td>Brandeis University</td>
<td>Yes</td>
<td>4186</td>
<td>2743</td>
<td>740</td>
<td>48</td>
<td>77</td>
<td>2819</td>
<td>62</td>
<td>19380</td>
<td>...</td>
<td>1000</td>
<td>90</td>
<td>97</td>
<td>9.8</td>
<td>24</td>
<td>17150</td>
<td>84</td>
<td>1.435271</td>
<td>False</td>
<td>True</td>
</tr>
</tbody>
</table>

<p>5 rows × 22 columns</p>
</div>
</div>
</div>
<p>Using the IQR method, more instances in the college dataset are marked as outliers.</p>
</section>
<section id="when-to-use-each" class="level5" data-number="12.2.1.2.3">
<h5 data-number="12.2.1.2.3" class="anchored" data-anchor-id="when-to-use-each"><span class="header-section-number">12.2.1.2.3</span> When to use each:</h5>
<ul>
<li><p>Use IQR when:</p>
<ul>
<li>Data is skewed</li>
<li>You don’t want to assume any distribution</li>
<li>You want a more sensitive detector</li>
</ul></li>
<li><p>Use Z-score when:</p>
<ul>
<li>Data is approximately normal</li>
<li>You want a more conservative approach</li>
<li>You need a method that’s easily interpretable</li>
</ul></li>
</ul>
<p>The actual number of outliers marked by each method will depend on your specific dataset’s distribution and characteristics.</p>
</section>
</section>
</section>
<section id="common-methods-for-handling-outliers" class="level3" data-number="12.2.2">
<h3 data-number="12.2.2" class="anchored" data-anchor-id="common-methods-for-handling-outliers"><span class="header-section-number">12.2.2</span> Common Methods for Handling outliers</h3>
<p>Once we identify outlier instances using statistical methods, the next step is to handle them. Below are some commonly used approaches:</p>
<ul>
<li><strong>Removing Outliers</strong>: Discarding extreme values if they are likely due to errors or are irrelevant for the analysis.</li>
<li><strong>Winsorizing</strong>: Capping/flooring outliers to a specific percentile to reduce their influence without removing them completely.</li>
<li><strong>Replacing with the median</strong>: Replacing outlier values with the median of the remaining data. The median is less affected by extreme values than the mean, making it an ideal choice for imputation when dealing with outliers</li>
<li><strong>Transforming Data</strong>: Applying transformations (e.g., log, square root) to reduce the impact of outliers.</li>
</ul>
<div id="1ebffc68" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> method_removal():</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Method 1: Remove outliers"""</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    data_cleaned <span class="op">=</span> college[<span class="op">~</span>college[<span class="st">'is_outlier'</span>]][<span class="st">'Expend'</span>]</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data_cleaned</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="52b162ae" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> method_capping():</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Method 2: Capping (Winsorization)"""</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    data_capped <span class="op">=</span> college[<span class="st">'Expend'</span>].copy()</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    data_capped[data_capped <span class="op">&lt;</span> lower_bound] <span class="op">=</span> lower_bound</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    data_capped[data_capped <span class="op">&gt;</span> upper_bound] <span class="op">=</span> upper_bound</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data_capped</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="854de89e" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> method_mean_replacement():</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Method 3: Replace with median"""</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    data_median <span class="op">=</span> college[<span class="st">'Expend'</span>].copy()</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    median_value <span class="op">=</span> college[<span class="op">~</span>college[<span class="st">'is_outlier'</span>]][<span class="st">'Expend'</span>].median()</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    data_median[college[<span class="st">'is_outlier'</span>]] <span class="op">=</span> median_value</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data_median</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="9ede03db" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> method_log_transformation():</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Method 4: Log transformation"""</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    data_log <span class="op">=</span> np.log1p(college[<span class="st">'Expend'</span>])</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data_log</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Your Practice:</strong> Try each method and compare their results to see how they differ in handling outliers.</p>
<p>In real-world applications, handling outliers should be approached on a case-by-case basis. However, here are some general recommendations:</p>
<p><strong>Recommendations for Different Scenarios:</strong></p>
<ul>
<li><p>Data Removal:</p>
<ul>
<li>Use when: You have a large dataset and can afford to lose data</li>
<li>Pros: Simple, removes all outlier influence</li>
<li>Cons: Loss of data, potential loss of important information</li>
</ul></li>
<li><p>Capping (Winsorization):</p>
<ul>
<li>Use when: You want to preserve data count while limiting extreme values</li>
<li>Pros: Preserves data size, reduces impact of outliers</li>
<li>Cons: Artificial boundary creation, potential loss of genuine extreme events</li>
</ul></li>
<li><p>Median Replacement:</p>
<ul>
<li>Use when: The data is normally distributed, and outliers are verified as errors or anomalies not representing true values</li>
<li>Pros: Maintains data size, simple to implement</li>
<li>Cons: Reduces variance, may not represent the true distribution</li>
</ul></li>
<li><p>Log Transformation:</p>
<ul>
<li>Use when: Data has a right-skewed distribution, and you want to reduce the impact of large outliers.</li>
<li>Pros: Reduces skewness, minimizes the effect of extreme values, can make data more normal-like.</li>
<li>Cons: Only applicable to positive values, may not be effective for extremely high outliers.</li>
</ul></li>
</ul>
</section>
</section>
<section id="data-binning" class="level2" data-number="12.3">
<h2 data-number="12.3" class="anchored" data-anchor-id="data-binning"><span class="header-section-number">12.3</span> Data binning</h2>
<p>Data binning is a powerful technique in data analysis where continuous numerical data is grouped into discrete intervals or “bins.” Imagine it as sorting items into distinct categories or “buckets” based on their values, making it easier to observe trends, patterns, and groupings within large datasets. We encounter binning in everyday life without even realizing it.</p>
<p>For example, consider age groups: instead of listing every individual age, we often refer to broader categories like “under 20,” “20-30,” “30-40,” or “40 and over.” This binning approach helps simplify data interpretation and comparison across different age groups. Another common example is tax brackets. Tax rates are often applied to ranges of income, like “up to $11,000,” “$11,001 to $44,725,” and so forth. Here, income values are grouped into bins to determine applicable tax rates, making complex tax data easier to manage and understand.</p>
<div id="fa83d227" class="cell" data-execution_count="101">
<div class="cell-output cell-output-display">

<div style="display: flex; gap: 50px;">
    <img src="./Datasets/taxable-income-2024.png" width="300">
    <img src="./Datasets/bin_example1b.png" width="300" ,="" height="200">
</div>
</div>
</div>
<section id="key-reasons-for-binning" class="level3" data-number="12.3.1">
<h3 data-number="12.3.1" class="anchored" data-anchor-id="key-reasons-for-binning"><span class="header-section-number">12.3.1</span> Key reasons for binning:</h3>
<ol type="i">
<li>Better intepretation of data<br>
</li>
<li>Making better recommendations<br>
</li>
<li>Smooth data, reduce noise</li>
</ol>
<p>Examples:</p>
<p><strong>Binning to better interpret data</strong></p>
<ol type="1">
<li>The number of flu cases everyday may be binned to seasons such as fall, spring, winter and summer, to understand the effect of season on flu.</li>
</ol>
<p><strong>Binning to make recommendations:</strong></p>
<ol start="2" type="1">
<li><p>A doctor may like to group patient age into bins. Grouping patient ages into categories such as Age &lt;=12, 12&lt;Age&lt;=18, 18&lt;Age&lt;=65, Age&gt;65 may help recommend the kind/doses of covid vaccine a patient needs.</p></li>
<li><p>A credit card company may want to bin customers based on their spend, as “High spenders”, “Medium spenders” and “Low spenders”. Binning will help them design customized marketing campaigns for each bin, thereby increasing customer response (or revenue). On the other hand, they use the same campaign for customers withing the same bin, thus minimizng marketing costs.</p></li>
</ol>
<p><strong>Binning to smooth data, and reduce noise</strong></p>
<ol start="4" type="1">
<li>A sales company may want to bin their total sales to a weekly / monthly / yearly level to reduce the noise in day-to-day sales.</li>
</ol>
<p>Using our college dataset, let’s apply binning to better interpret the relationship between instructional expenditure per student (<code>Expend</code>) and graduation rate (<code>Grad.Rate</code>) for U.S. universities, and make relevant recommendations</p>
<p>Here is the previous scatterplot of ‘Grad.Rate’ vs ‘Expend’ with a trendline.</p>
<div id="460318fe" class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># scatter plot of Expend vs Grad.Rate</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>sns.regplot(data <span class="op">=</span> college, x <span class="op">=</span> <span class="st">"Expend"</span>, y <span class="op">=</span> <span class="st">"Grad.Rate"</span>,scatter_kws<span class="op">=</span>{<span class="st">"color"</span>: <span class="st">"orange"</span>}, line_kws<span class="op">=</span>{<span class="st">"color"</span>: <span class="st">"blue"</span>})</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_major_formatter(<span class="st">'$</span><span class="sc">{x:,.0f}</span><span class="st">'</span>)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Expenditure per student'</span>)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Graduation rate'</span>)</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Data cleaning and preparation_files/figure-html/cell-49-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The trendline indicates a positive correlation between <code>Expend</code> and <code>Grad.Rate</code>. However, there seems to be a lot of noise and presence of outliers in the data, which makes it hard to interpret the overall trend.</p>
</section>
<section id="common-binning-methods" class="level3" data-number="12.3.2">
<h3 data-number="12.3.2" class="anchored" data-anchor-id="common-binning-methods"><span class="header-section-number">12.3.2</span> Common binning methods:</h3>
<ul>
<li><strong>Equal-width:</strong> Divides range into equal-sized intervals</li>
<li><strong>Equal-size:</strong> Places equal number of observations in each bin</li>
<li><strong>Custom:</strong> Based on domain knowledge (like age groups above)</li>
</ul>
<p>We’ll bin <code>Expend</code> to see if we can better analyze its association with <code>Grad.Rate</code>. However, let us first visualize the distribution of <code>Expend</code>.</p>
<div id="d213f73e" class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Visualizing the distribution of expend</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>sns.histplot(data <span class="op">=</span> college, x<span class="op">=</span> <span class="st">'Expend'</span>)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_major_formatter(<span class="st">'$</span><span class="sc">{x:,.0f}</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Data cleaning and preparation_files/figure-html/cell-50-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The distribution of <code>Extend</code> is right skewed with potentially some extremely high outlying values.</p>
<section id="binning-with-equal-width-bins" class="level4" data-number="12.3.2.1">
<h4 data-number="12.3.2.1" class="anchored" data-anchor-id="binning-with-equal-width-bins"><span class="header-section-number">12.3.2.1</span> Binning with equal width bins</h4>
<p>We’ll use the Pandas function <a href="https://pandas.pydata.org/docs/reference/api/pandas.cut.html">cut()</a> to bin <code>Expend</code>. This function creates bins such that all bins have the same width.</p>
<div id="12622969" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Using the cut() function in Pandas to bin "Expend"</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>Binned_expend <span class="op">=</span> pd.cut(college[<span class="st">'Expend'</span>],<span class="dv">3</span>,retbins <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>Binned_expend</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="69">
<pre><code>(0      (3132.953, 20868.333]
 1      (3132.953, 20868.333]
 2      (3132.953, 20868.333]
 3      (3132.953, 20868.333]
 4      (3132.953, 20868.333]
                ...          
 772    (3132.953, 20868.333]
 773    (3132.953, 20868.333]
 774    (3132.953, 20868.333]
 775     (38550.667, 56233.0]
 776    (3132.953, 20868.333]
 Name: Expend, Length: 777, dtype: category
 Categories (3, interval[float64, right]): [(3132.953, 20868.333] &lt; (20868.333, 38550.667] &lt; (38550.667, 56233.0]],
 array([ 3132.953     , 20868.33333333, 38550.66666667, 56233.        ]))</code></pre>
</div>
</div>
<p>The <a href="https://pandas.pydata.org/docs/reference/api/pandas.cut.html">cut()</a> function returns a tuple of length 2. The first element of the tuple are the bins, while the second element is an array containing the cut-off values for the bins.</p>
<div id="2ae548ce" class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(Binned_expend)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="70">
<pre><code>tuple</code></pre>
</div>
</div>
<div id="65b6c4ec" class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(Binned_expend)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="71">
<pre><code>2</code></pre>
</div>
</div>
<p>Once the bins are obtained, we’ll add a column in the dataset that indicates the bin for <code>Expend</code>.</p>
<div id="f6df228a" class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating a categorical variable to store the level of expenditure on a student</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>college[<span class="st">'Expend_bin'</span>] <span class="op">=</span> Binned_expend[<span class="dv">0</span>]</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>college.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="72">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Unnamed: 0</th>
<th data-quarto-table-cell-role="th">Private</th>
<th data-quarto-table-cell-role="th">Apps</th>
<th data-quarto-table-cell-role="th">Accept</th>
<th data-quarto-table-cell-role="th">Enroll</th>
<th data-quarto-table-cell-role="th">Top10perc</th>
<th data-quarto-table-cell-role="th">Top25perc</th>
<th data-quarto-table-cell-role="th">F.Undergrad</th>
<th data-quarto-table-cell-role="th">P.Undergrad</th>
<th data-quarto-table-cell-role="th">Outstate</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">PhD</th>
<th data-quarto-table-cell-role="th">Terminal</th>
<th data-quarto-table-cell-role="th">S.F.Ratio</th>
<th data-quarto-table-cell-role="th">perc.alumni</th>
<th data-quarto-table-cell-role="th">Expend</th>
<th data-quarto-table-cell-role="th">Grad.Rate</th>
<th data-quarto-table-cell-role="th">z_score</th>
<th data-quarto-table-cell-role="th">is_z_score_outlier</th>
<th data-quarto-table-cell-role="th">is_IQR_outlier</th>
<th data-quarto-table-cell-role="th">Expend_bin</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Abilene Christian University</td>
<td>Yes</td>
<td>1660</td>
<td>1232</td>
<td>721</td>
<td>23</td>
<td>52</td>
<td>2885</td>
<td>537</td>
<td>7440</td>
<td>...</td>
<td>70</td>
<td>78</td>
<td>18.1</td>
<td>12</td>
<td>7041</td>
<td>60</td>
<td>-0.501910</td>
<td>False</td>
<td>False</td>
<td>(3132.953, 20868.333]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Adelphi University</td>
<td>Yes</td>
<td>2186</td>
<td>1924</td>
<td>512</td>
<td>16</td>
<td>29</td>
<td>2683</td>
<td>1227</td>
<td>12280</td>
<td>...</td>
<td>29</td>
<td>30</td>
<td>12.2</td>
<td>16</td>
<td>10527</td>
<td>56</td>
<td>0.166110</td>
<td>False</td>
<td>False</td>
<td>(3132.953, 20868.333]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Adrian College</td>
<td>Yes</td>
<td>1428</td>
<td>1097</td>
<td>336</td>
<td>22</td>
<td>50</td>
<td>1036</td>
<td>99</td>
<td>11250</td>
<td>...</td>
<td>53</td>
<td>66</td>
<td>12.9</td>
<td>30</td>
<td>8735</td>
<td>54</td>
<td>-0.177290</td>
<td>False</td>
<td>False</td>
<td>(3132.953, 20868.333]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Agnes Scott College</td>
<td>Yes</td>
<td>417</td>
<td>349</td>
<td>137</td>
<td>60</td>
<td>89</td>
<td>510</td>
<td>63</td>
<td>12960</td>
<td>...</td>
<td>92</td>
<td>97</td>
<td>7.7</td>
<td>37</td>
<td>19016</td>
<td>59</td>
<td>1.792851</td>
<td>False</td>
<td>True</td>
<td>(3132.953, 20868.333]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Alaska Pacific University</td>
<td>Yes</td>
<td>193</td>
<td>146</td>
<td>55</td>
<td>16</td>
<td>44</td>
<td>249</td>
<td>869</td>
<td>7560</td>
<td>...</td>
<td>76</td>
<td>72</td>
<td>11.9</td>
<td>2</td>
<td>10922</td>
<td>15</td>
<td>0.241803</td>
<td>False</td>
<td>False</td>
<td>(3132.953, 20868.333]</td>
</tr>
</tbody>
</table>

<p>5 rows × 23 columns</p>
</div>
</div>
</div>
<p>See the variable <code>Expend_bin</code> in the above dataset.</p>
<p>Let us visualize the <code>Expend</code> bins over the distribution of the <code>Expend</code> variable.</p>
<div id="5277f959" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Visualizing the bins for instructional expediture on a student</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(font_scale<span class="op">=</span><span class="fl">1.25</span>)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">"figure.figsize"</span>] <span class="op">=</span> (<span class="dv">9</span>,<span class="dv">6</span>)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>sns.histplot(data <span class="op">=</span> college, x<span class="op">=</span> <span class="st">'Expend'</span>)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>plt.vlines(Binned_expend[<span class="dv">1</span>], <span class="dv">0</span>,<span class="dv">100</span>,color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Expenditure per student'</span>)<span class="op">;</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Graduation rate'</span>)<span class="op">;</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_major_formatter(<span class="st">'$</span><span class="sc">{x:,.0f}</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Data cleaning and preparation_files/figure-html/cell-55-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>By default, the bins created have equal width. They are created by dividing the range between the maximum and minimum value of <code>Expend</code> into the desired number of equal-width intervals. We can label the bins as well as follows.</p>
<div id="d3d52fdc" class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>college[<span class="st">'Expend_bin'</span>] <span class="op">=</span> pd.cut(college[<span class="st">'Expend'</span>],<span class="dv">3</span>,labels <span class="op">=</span> [<span class="st">'Low expend'</span>,<span class="st">'Med expend'</span>,<span class="st">'High expend'</span>])</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>college[<span class="st">'Expend_bin'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="74">
<pre><code>0       Low expend
1       Low expend
2       Low expend
3       Low expend
4       Low expend
          ...     
772     Low expend
773     Low expend
774     Low expend
775    High expend
776     Low expend
Name: Expend_bin, Length: 777, dtype: category
Categories (3, object): ['Low expend' &lt; 'Med expend' &lt; 'High expend']</code></pre>
</div>
</div>
<p>Now that we have binned the variable <code>Expend</code>, let us see if we can better visualize the association of graduation rate with expenditure per student using <code>Expened_bin</code>.</p>
<div id="19f35cd9" class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Visualizing average graduation rate vs categories of instructional expenditure per student</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>sns.barplot(x <span class="op">=</span> <span class="st">'Expend_bin'</span>, y <span class="op">=</span> <span class="st">'Grad.Rate'</span>, data <span class="op">=</span> college)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Data cleaning and preparation_files/figure-html/cell-57-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>It seems that the graduation rate is the highest for universities with medium level of expenditure per student. This is different from the trend we saw earlier in the scatter plot. Let us investigate.</p>
<p>Let us find the number of universities in each bin.</p>
<div id="d310677f" class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>college[<span class="st">'Expend_bin'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="76">
<pre><code>Expend_bin
Low expend     751
Med expend      21
High expend      5
Name: count, dtype: int64</code></pre>
</div>
</div>
<p>The bin <code>High expend</code> consists of only 5 universities, or 0.6% of all the universities in the dataset. These universities may be outliers that are skewing the trend (as also evident in the histogram above).</p>
<p>Let us see if we get the correct trend with the outliers removed from the data.</p>
<div id="99621438" class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Data without outliers</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>college_data_without_outliers <span class="op">=</span> college[((college.Expend<span class="op">&gt;=</span>lower_bound) <span class="op">&amp;</span> (college.Expend<span class="op">&lt;=</span>upper_bound))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="bbccf68e" class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>Binned_data <span class="op">=</span> pd.cut(college_data_without_outliers[<span class="st">'Expend'</span>],<span class="dv">3</span>,labels <span class="op">=</span> [<span class="st">'Low expend'</span>,<span class="st">'Med expend'</span>,<span class="st">'High expend'</span>],retbins <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>college_data_without_outliers.loc[:,<span class="st">'Expend_bin'</span>] <span class="op">=</span> Binned_data[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="07a49487" class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>sns.barplot(x <span class="op">=</span> <span class="st">'Expend_bin'</span>, y <span class="op">=</span> <span class="st">'Grad.Rate'</span>, data <span class="op">=</span> college_data_without_outliers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Data cleaning and preparation_files/figure-html/cell-61-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>With the outliers removed, we obtain the correct overall trend, even in the case of equal-width bins. Note that these bins have unequal number of observations as shown below.</p>
<div id="75638698" class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>sns.histplot(data <span class="op">=</span> college_data_without_outliers, x<span class="op">=</span> <span class="st">'Expend'</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>    plt.axvline(Binned_data[<span class="dv">1</span>][i], <span class="dv">0</span>,<span class="dv">100</span>,color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Expenditure per student'</span>)<span class="op">;</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Graduation rate'</span>)<span class="op">;</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_major_formatter(<span class="st">'$</span><span class="sc">{x:,.0f}</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Data cleaning and preparation_files/figure-html/cell-62-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Note that the right tail of the histogram has disappered since we removed outliers.</p>
<div id="3ab90f74" class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>college_data_without_outliers[<span class="st">'Expend_bin'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="81">
<pre><code>Expend_bin
Med expend     327
Low expend     314
High expend     88
Name: count, dtype: int64</code></pre>
</div>
</div>
<p>Instead of removing outliers, we can address the issue by binning observations into equal-sized bins, ensuring each bin has the same number of observations. Let’s explore this approach next.</p>
</section>
<section id="binning-with-equal-sized-bins" class="level4" data-number="12.3.2.2">
<h4 data-number="12.3.2.2" class="anchored" data-anchor-id="binning-with-equal-sized-bins"><span class="header-section-number">12.3.2.2</span> Binning with equal sized bins</h4>
<p>Let us bin the variable <code>Expend</code> such that each bin consists of the same number of observations.</p>
<p>We’ll use the Pandas function <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.qcut.html">qcut()</a> to make equal-sized bins (in contrast to equal-width bins in the previous section).</p>
<div id="746ffd31" class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Using the Pandas function qcut() to create bins with the same number of observations</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>Binned_expend <span class="op">=</span> pd.qcut(college[<span class="st">'Expend'</span>],<span class="dv">3</span>,retbins <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>college[<span class="st">'Expend_bin'</span>] <span class="op">=</span> Binned_expend[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Each bin has the same number of observations with <code>qcut()</code>:</p>
<div id="6360ed6c" class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>college[<span class="st">'Expend_bin'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="83">
<pre><code>Expend_bin
(3185.999, 7334.333]    259
(7334.333, 9682.333]    259
(9682.333, 56233.0]     259
Name: count, dtype: int64</code></pre>
</div>
</div>
<p>Let us visualize the <code>Expend</code> bins over the distribution of the <code>Expend</code> variable.</p>
<div id="ece240f6" class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Visualizing the bins for instructional expediture on a student</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(font_scale<span class="op">=</span><span class="fl">1.25</span>)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">"figure.figsize"</span>] <span class="op">=</span> (<span class="dv">9</span>,<span class="dv">6</span>)</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>sns.histplot(data <span class="op">=</span> college, x<span class="op">=</span> <span class="st">'Expend'</span>)</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>plt.vlines(Binned_expend[<span class="dv">1</span>], <span class="dv">0</span>,<span class="dv">100</span>,color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Expenditure per student'</span>)<span class="op">;</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Graduation rate'</span>)<span class="op">;</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_major_formatter(<span class="st">'$</span><span class="sc">{x:,.0f}</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Data cleaning and preparation_files/figure-html/cell-66-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Note that the bin-widths have been adjusted to have the same number of observations in each bin. The bins are narrower in domains of high density, and wider in domains of sparse density.</p>
<p>Let us again make the barplot visualizing the average graduate rate with level of instructional expenditure per student.</p>
<div id="4be0c171" class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>college[<span class="st">'Expend_bin'</span>] <span class="op">=</span> pd.qcut(college[<span class="st">'Expend'</span>],<span class="dv">3</span>,labels <span class="op">=</span> [<span class="st">'Low expend'</span>,<span class="st">'Med expend'</span>,<span class="st">'High expend'</span>])</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>a<span class="op">=</span>sns.barplot(x <span class="op">=</span> <span class="st">'Expend_bin'</span>, y <span class="op">=</span> <span class="st">'Grad.Rate'</span>, data <span class="op">=</span> college)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Data cleaning and preparation_files/figure-html/cell-67-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Now we see the same trend that we saw in the scatterplot, but without the noise. We have smoothed the data. Note that making equal-sized bins helps reduce the effect of outliers in the overall trend.</p>
<p>Suppose this analysis was done to provide recommendations to universities for increasing their graduation rate. With binning, we can can provide one recommendation to <em>‘Low expend’</em> universities, and another one to <em>‘Med expend’</em> universities. For example, the recommendations can be:</p>
<ol type="1">
<li><em>‘Low expend’</em> universities can expect an increase of 9 percentage points in <code>Grad.Rate</code>, if they migrate to the <em>‘Med expend’</em> category.</li>
<li><em>‘Med expend’</em> universities can expect an increase of 7 percentage points in <code>Grad.Rate</code>, if they migrate to the <em>‘High expend’</em> category.</li>
</ol>
<p>The numbers in the above recommendations are based on the table below.</p>
<div id="f9d9831d" class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>college.groupby(college.Expend_bin, observed<span class="op">=</span><span class="va">False</span>)[<span class="st">'Grad.Rate'</span>].mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="86">
<pre><code>Expend_bin
Low expend     57.343629
Med expend     66.057915
High expend    72.988417
Name: Grad.Rate, dtype: float64</code></pre>
</div>
</div>
<p>We can also provide recommendations based on the confidence intervals of the mean graduation rate (<code>Grad.Rate</code>). The confidence intervals, calculated below, are derived using a method known as bootstrapping. For a detailed explanation of bootstrapping, please refer to <a href="https://en.wikipedia.org/wiki/Bootstrapping_(statistics)">this article on Wikipedia</a>.</p>
<div id="464dd7fb" class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bootstrapping to find 95% confidence intervals of Graduation Rate of US universities based on average expenditure per student</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>confidence_intervals <span class="op">=</span> {}</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through each expenditure bin</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> expend_bin, data_sub <span class="kw">in</span> college.groupby(<span class="st">'Expend_bin'</span>, observed<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate bootstrap samples for the graduation rate</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>    samples <span class="op">=</span> np.random.choice(data_sub[<span class="st">'Grad.Rate'</span>], size<span class="op">=</span>(<span class="dv">10000</span>, <span class="bu">len</span>(data_sub)), replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the mean of each sample</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>    sample_means <span class="op">=</span> samples.mean(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the 95% confidence interval</span></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>    lower_bound <span class="op">=</span> np.percentile(sample_means, <span class="fl">2.5</span>)</span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>    upper_bound <span class="op">=</span> np.percentile(sample_means, <span class="fl">97.5</span>)</span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store the result in the dictionary</span></span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>    confidence_intervals[expend_bin] <span class="op">=</span> (<span class="bu">round</span>(lower_bound, <span class="dv">2</span>), <span class="bu">round</span>(upper_bound, <span class="dv">2</span>))</span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the results</span></span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> expend_bin, ci <span class="kw">in</span> confidence_intervals.items():</span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"95% Confidence interval of Grad.Rate for </span><span class="sc">{</span>expend_bin<span class="sc">}</span><span class="ss"> universities = [</span><span class="sc">{</span>ci[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>ci[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>95% Confidence interval of Grad.Rate for Low expend universities = [55.36, 59.36]
95% Confidence interval of Grad.Rate for Med expend universities = [64.15, 67.95]
95% Confidence interval of Grad.Rate for High expend universities = [71.03, 74.92]</code></pre>
</div>
</div>
<p>Apart from equal-width and equal-sized bins, custom bins can be created using the <em>bins</em> argument. Suppose, bins are to be created for <code>Expend</code> with cutoffs <span class="math inline">\(\$10,000, \$20,000, \$30,000... \$60,000\)</span>. Then, we can use the <em>bins</em> argument as in the code below:</p>
</section>
<section id="binning-with-custom-bins" class="level4" data-number="12.3.2.3">
<h4 data-number="12.3.2.3" class="anchored" data-anchor-id="binning-with-custom-bins"><span class="header-section-number">12.3.2.3</span> Binning with custom bins</h4>
<div id="8db5bf15" class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>Binned_expend <span class="op">=</span> pd.cut(college.Expend,bins <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">70000</span>,<span class="dv">10000</span>)),retbins<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="d5bd2e5f" class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Visualizing the bins for instructional expediture on a student</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>sns.histplot(data <span class="op">=</span> college, x<span class="op">=</span> <span class="st">'Expend'</span>)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>plt.vlines(Binned_expend[<span class="dv">1</span>], <span class="dv">0</span>,<span class="dv">100</span>,color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Expenditure per student'</span>)<span class="op">;</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Graduation rate'</span>)<span class="op">;</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_major_formatter(<span class="st">'$</span><span class="sc">{x:,.0f}</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Data cleaning and preparation_files/figure-html/cell-71-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Next, let’s create a custom bin with unequal sizes and widths.</p>
<div id="5171d242" class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create bins and labels</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>bins <span class="op">=</span> [college[<span class="st">'Expend'</span>].<span class="bu">min</span>(), <span class="dv">10000</span>, <span class="dv">40000</span>, college[<span class="st">'Expend'</span>].<span class="bu">max</span>()]</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> [<span class="st">'Low Expenditure'</span>, <span class="st">'Medium Expenditure'</span>, <span class="st">'High Expenditure'</span>]</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Binning the 'Expend' column</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>college[<span class="st">'Expend_Binned'</span>] <span class="op">=</span> pd.cut(college[<span class="st">'Expend'</span>], bins<span class="op">=</span>bins, labels<span class="op">=</span>labels)</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualizing the bins using a histogram</span></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.histplot(data<span class="op">=</span>college, x<span class="op">=</span><span class="st">'Expend'</span>, kde<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Add vertical lines for the bin edges (the bin edges are the values in 'bins')</span></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> bin_edge <span class="kw">in</span> bins[<span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>]:  <span class="co"># skip the first and last bins since they are the edges</span></span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>    plt.vlines(bin_edge, <span class="dv">0</span>, ax.get_ylim()[<span class="dv">1</span>], color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Add labels and formatting</span></span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Expenditure per student'</span>)</span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Frequency'</span>)</span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_major_formatter(<span class="st">'$</span><span class="sc">{x:,.0f}</span><span class="st">'</span>)</span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the plot</span></span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Data cleaning and preparation_files/figure-html/cell-72-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>As custom bin-cutoffs can be specified with the <code>cut()</code> function, custom bin quantiles can be specified with the <code>qcut()</code> function.</p>
</section>
</section>
</section>
<section id="dummy-indicator-variables" class="level2" data-number="12.4">
<h2 data-number="12.4" class="anchored" data-anchor-id="dummy-indicator-variables"><span class="header-section-number">12.4</span> Dummy / Indicator variables</h2>
<p>Dummy or indicator variables are binary variables created to represent categorical data in numerical form, typically used in regression and machine learning models. Each category is represented by a separate dummy variable with values of 0 or 1.</p>
<section id="purpose" class="level3" data-number="12.4.1">
<h3 data-number="12.4.1" class="anchored" data-anchor-id="purpose"><span class="header-section-number">12.4.1</span> Purpose:</h3>
<ul>
<li><strong>Enables categorical data</strong> to be used in quantitative analysis: Models like linear regression and many machine learning algorithms require numerical input, making dummy variables essential for handling categorical data.</li>
<li><strong>Preserves information</strong>: Converts categorical information into a format that models can interpret without losing meaning.</li>
</ul>
</section>
<section id="when-to-use-dummy-variables" class="level3" data-number="12.4.2">
<h3 data-number="12.4.2" class="anchored" data-anchor-id="when-to-use-dummy-variables"><span class="header-section-number">12.4.2</span> When to use dummy variables</h3>
<p>Dummy variables are especially useful in:</p>
<ul>
<li><strong>Regression models:</strong> For categorical predictors, such as region, gender, or type of product.</li>
<li><strong>Machine learning algorithms:</strong> Many models, including tree-based methods, can benefit from dummy variables for categorical features.</li>
</ul>
</section>
<section id="how-to-create-dummy-variables" class="level3" data-number="12.4.3">
<h3 data-number="12.4.3" class="anchored" data-anchor-id="how-to-create-dummy-variables"><span class="header-section-number">12.4.3</span> How to Create Dummy variables</h3>
<p>The pandas library in Python has a built-in function, <a href="https://pandas.pydata.org/docs/reference/api/pandas.get_dummies.html"><code>pd.get_dummies()</code></a>, to generate dummy variables. If a column in a DataFrame has <span class="math inline">\(k\)</span> distinct values, we will get a DataFrame with <span class="math inline">\(k\)</span> columns containing 0s and 1s</p>
<p>Let us make dummy variables with the equal-sized bins we created for the average instruction expenditure per student.</p>
<div id="603c56cf" class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Using the Pandas function qcut() to create bins with the same number of observations</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>Binned_expend <span class="op">=</span> pd.qcut(college[<span class="st">'Expend'</span>],<span class="dv">3</span>,retbins <span class="op">=</span> <span class="va">True</span>,labels <span class="op">=</span> [<span class="st">'Low_expend'</span>,<span class="st">'Med_expend'</span>,<span class="st">'High_expend'</span>])</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>college[<span class="st">'Expend_bin'</span>] <span class="op">=</span> Binned_expend[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="b258d11e" class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Making dummy variables based on the levels (categories) of the 'Expend_bin' variable</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>dummy_Expend <span class="op">=</span> pd.get_dummies(college[<span class="st">'Expend_bin'</span>], dtype<span class="op">=</span><span class="bu">int</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The dummy data <code>dummy_Expend</code> has a value of <span class="math inline">\(1\)</span> if the observation corresponds to the category referenced by the column name.</p>
<div id="f5679e2b" class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>dummy_Expend.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="84">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Low_expend</th>
<th data-quarto-table-cell-role="th">Med_expend</th>
<th data-quarto-table-cell-role="th">High_expend</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Adding the dummy columns back to the original dataframe</p>
<div id="8d6e50dc" class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Concatenating the dummy variables to the original data</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>college <span class="op">=</span> pd.concat([college,dummy_Expend],axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(college.shape)</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>college.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(777, 26)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="85">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Unnamed: 0</th>
<th data-quarto-table-cell-role="th">Private</th>
<th data-quarto-table-cell-role="th">Apps</th>
<th data-quarto-table-cell-role="th">Accept</th>
<th data-quarto-table-cell-role="th">Enroll</th>
<th data-quarto-table-cell-role="th">Top10perc</th>
<th data-quarto-table-cell-role="th">Top25perc</th>
<th data-quarto-table-cell-role="th">F.Undergrad</th>
<th data-quarto-table-cell-role="th">P.Undergrad</th>
<th data-quarto-table-cell-role="th">Outstate</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">perc.alumni</th>
<th data-quarto-table-cell-role="th">Expend</th>
<th data-quarto-table-cell-role="th">Grad.Rate</th>
<th data-quarto-table-cell-role="th">z_score</th>
<th data-quarto-table-cell-role="th">is_z_score_outlier</th>
<th data-quarto-table-cell-role="th">is_IQR_outlier</th>
<th data-quarto-table-cell-role="th">Expend_bin</th>
<th data-quarto-table-cell-role="th">Low_expend</th>
<th data-quarto-table-cell-role="th">Med_expend</th>
<th data-quarto-table-cell-role="th">High_expend</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Abilene Christian University</td>
<td>Yes</td>
<td>1660</td>
<td>1232</td>
<td>721</td>
<td>23</td>
<td>52</td>
<td>2885</td>
<td>537</td>
<td>7440</td>
<td>...</td>
<td>12</td>
<td>7041</td>
<td>60</td>
<td>-0.501910</td>
<td>False</td>
<td>False</td>
<td>Low_expend</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Adelphi University</td>
<td>Yes</td>
<td>2186</td>
<td>1924</td>
<td>512</td>
<td>16</td>
<td>29</td>
<td>2683</td>
<td>1227</td>
<td>12280</td>
<td>...</td>
<td>16</td>
<td>10527</td>
<td>56</td>
<td>0.166110</td>
<td>False</td>
<td>False</td>
<td>High_expend</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Adrian College</td>
<td>Yes</td>
<td>1428</td>
<td>1097</td>
<td>336</td>
<td>22</td>
<td>50</td>
<td>1036</td>
<td>99</td>
<td>11250</td>
<td>...</td>
<td>30</td>
<td>8735</td>
<td>54</td>
<td>-0.177290</td>
<td>False</td>
<td>False</td>
<td>Med_expend</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Agnes Scott College</td>
<td>Yes</td>
<td>417</td>
<td>349</td>
<td>137</td>
<td>60</td>
<td>89</td>
<td>510</td>
<td>63</td>
<td>12960</td>
<td>...</td>
<td>37</td>
<td>19016</td>
<td>59</td>
<td>1.792851</td>
<td>False</td>
<td>True</td>
<td>High_expend</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Alaska Pacific University</td>
<td>Yes</td>
<td>193</td>
<td>146</td>
<td>55</td>
<td>16</td>
<td>44</td>
<td>249</td>
<td>869</td>
<td>7560</td>
<td>...</td>
<td>2</td>
<td>10922</td>
<td>15</td>
<td>0.241803</td>
<td>False</td>
<td>False</td>
<td>High_expend</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>

<p>5 rows × 26 columns</p>
</div>
</div>
</div>
<p>We can find the correlation between the dummy variables and graduation rate to identify if any of the dummy variables will be useful to estimate graduation rate (<code>Grad.Rate</code>).</p>
<div id="463bfc04" class="cell" data-execution_count="229">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Finding if dummy variables will be useful to estimate 'Grad.Rate'</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>dummy_Expend.corrwith(college[<span class="st">'Grad.Rate'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="229">
<pre><code>Low_expend    -0.334456
Med_expend     0.024492
High_expend    0.309964
dtype: float64</code></pre>
</div>
</div>
<p>The dummy variables <code>Low expend</code> and <code>High expend</code> may contribute in explaining <code>Grad.Rate</code> in a regression model.</p>
</section>
<section id="using-drop_first-to-avoid-multicollinearity" class="level3" data-number="12.4.4">
<h3 data-number="12.4.4" class="anchored" data-anchor-id="using-drop_first-to-avoid-multicollinearity"><span class="header-section-number">12.4.4</span> Using <code>drop_first</code> to Avoid Multicollinearity</h3>
<p>In cases like linear regression, you may want to drop one dummy variable to avoid multicollinearity (perfect correlation between variables).</p>
<div id="d3ef7a76" class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create dummy variables, dropping the first to avoid multicollinearity</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>dummy_Expend <span class="op">=</span> pd.get_dummies(college[<span class="st">'Expend_bin'</span>], dtype<span class="op">=</span><span class="bu">int</span>, drop_first<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="co"># add the dummy variables to the original dataset</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>college <span class="op">=</span> pd.concat([college, dummy_Expend], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>college.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="86">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Unnamed: 0</th>
<th data-quarto-table-cell-role="th">Private</th>
<th data-quarto-table-cell-role="th">Apps</th>
<th data-quarto-table-cell-role="th">Accept</th>
<th data-quarto-table-cell-role="th">Enroll</th>
<th data-quarto-table-cell-role="th">Top10perc</th>
<th data-quarto-table-cell-role="th">Top25perc</th>
<th data-quarto-table-cell-role="th">F.Undergrad</th>
<th data-quarto-table-cell-role="th">P.Undergrad</th>
<th data-quarto-table-cell-role="th">Outstate</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Grad.Rate</th>
<th data-quarto-table-cell-role="th">z_score</th>
<th data-quarto-table-cell-role="th">is_z_score_outlier</th>
<th data-quarto-table-cell-role="th">is_IQR_outlier</th>
<th data-quarto-table-cell-role="th">Expend_bin</th>
<th data-quarto-table-cell-role="th">Low_expend</th>
<th data-quarto-table-cell-role="th">Med_expend</th>
<th data-quarto-table-cell-role="th">High_expend</th>
<th data-quarto-table-cell-role="th">Med_expend</th>
<th data-quarto-table-cell-role="th">High_expend</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Abilene Christian University</td>
<td>Yes</td>
<td>1660</td>
<td>1232</td>
<td>721</td>
<td>23</td>
<td>52</td>
<td>2885</td>
<td>537</td>
<td>7440</td>
<td>...</td>
<td>60</td>
<td>-0.501910</td>
<td>False</td>
<td>False</td>
<td>Low_expend</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Adelphi University</td>
<td>Yes</td>
<td>2186</td>
<td>1924</td>
<td>512</td>
<td>16</td>
<td>29</td>
<td>2683</td>
<td>1227</td>
<td>12280</td>
<td>...</td>
<td>56</td>
<td>0.166110</td>
<td>False</td>
<td>False</td>
<td>High_expend</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Adrian College</td>
<td>Yes</td>
<td>1428</td>
<td>1097</td>
<td>336</td>
<td>22</td>
<td>50</td>
<td>1036</td>
<td>99</td>
<td>11250</td>
<td>...</td>
<td>54</td>
<td>-0.177290</td>
<td>False</td>
<td>False</td>
<td>Med_expend</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Agnes Scott College</td>
<td>Yes</td>
<td>417</td>
<td>349</td>
<td>137</td>
<td>60</td>
<td>89</td>
<td>510</td>
<td>63</td>
<td>12960</td>
<td>...</td>
<td>59</td>
<td>1.792851</td>
<td>False</td>
<td>True</td>
<td>High_expend</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Alaska Pacific University</td>
<td>Yes</td>
<td>193</td>
<td>146</td>
<td>55</td>
<td>16</td>
<td>44</td>
<td>249</td>
<td>869</td>
<td>7560</td>
<td>...</td>
<td>15</td>
<td>0.241803</td>
<td>False</td>
<td>False</td>
<td>High_expend</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>

<p>5 rows × 28 columns</p>
</div>
</div>
</div>
</section>
</section>
<section id="independent-study" class="level2" data-number="12.5">
<h2 data-number="12.5" class="anchored" data-anchor-id="independent-study"><span class="header-section-number">12.5</span> Independent Study</h2>
<section id="practice-exercise-1" class="level3" data-number="12.5.1">
<h3 data-number="12.5.1" class="anchored" data-anchor-id="practice-exercise-1"><span class="header-section-number">12.5.1</span> Practice exercise 1</h3>
<p>Read <em>survey_data_clean.csv</em>. Split the columns of the dataset, such that all columns with categorical values transform into dummy variables with each category corresponding to a column of 0s and 1s. Leave the <em>Timestamp</em> column.</p>
<p>As all categorical columns are transformed to dummy variables, all columns have numeric values.</p>
<p>What is the total number of columns in the transformed data? What is the total number of columns of the original data?</p>
<p>Find the:</p>
<ol type="1">
<li><p>Top 5 variables having the highest positive correlation with <code>NU_GPA</code>.</p></li>
<li><p>Top 5 variables having the highest negative correlation with <code>NU_GPA</code>.</p></li>
</ol>
</section>
<section id="practice-exercise-2" class="level3" data-number="12.5.2">
<h3 data-number="12.5.2" class="anchored" data-anchor-id="practice-exercise-2"><span class="header-section-number">12.5.2</span> Practice exercise 2</h3>
<p>Consider the dataset <em>survey_data_clean.csv</em> . Find the number of outliers in each column of the dataset based on both the Z-score and IQR criteria. Do not use a <code>for</code> loop.</p>
<p>Which column(s) have the maximum number of outliers using Z-score?</p>
<p>Which column(s) have the maximum number of outliers using IQR?</p>
<p>Do you think the outlying observations identified for those columns(s) should be considered as outliers? If not, then which type of columns should be considered when finding outliers?</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Advanced_Data_Visualization.html" class="pagination-link" aria-label="Advanced Data Visualization">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Advanced Data Visualization</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Data aggregation.html" class="pagination-link" aria-label="Data Grouping and Aggregation">
        <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Data Grouping and Aggregation</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>