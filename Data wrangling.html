<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>14&nbsp; Data Reshaping and Enrichment – Data Science I with python</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Datasets.html" rel="next">
<link href="./Data aggregation.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-8da5b4427184b79ecddefad3d342027e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Data cleaning and preparation.html">From messy to insight</a></li><li class="breadcrumb-item"><a href="./Data wrangling.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Data Reshaping and Enrichment</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="https://statistics.northwestern.edu/" class="sidebar-logo-link">
      <img src="./NU_Stat_logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Science I with python</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Getting started</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./vscode_setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Setting up your environment with VS Code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./python_venv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Python Environments and Package Management</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow_enhance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Enhancing Workflow in Jupyter Notebooks</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Python refresher</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./python_basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Python Basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_structures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data structures</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Core library foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./NumPy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">NumPy</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Pandas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Pandas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Reading data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Reading Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_types_in_pandas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">More on Pandas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Data visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Introduction to Data Visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Advanced_Data_Visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Advanced Data Visualization</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">From messy to insight</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Data cleaning and preparation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Data Cleaning and Preparation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Data aggregation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Data Grouping and Aggregation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Data wrangling.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Data Reshaping and Enrichment</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Datasets &amp; Templates</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#data-reshaping" id="toc-data-reshaping" class="nav-link active" data-scroll-target="#data-reshaping"><span class="header-section-number">14.1</span> Data Reshaping</a>
  <ul>
  <li><a href="#why-data-reshaping-is-important" id="toc-why-data-reshaping-is-important" class="nav-link" data-scroll-target="#why-data-reshaping-is-important"><span class="header-section-number">14.1.1</span> Why Data Reshaping is Important:</a></li>
  <li><a href="#wide-vs.-long-data-format-in-data-reshaping" id="toc-wide-vs.-long-data-format-in-data-reshaping" class="nav-link" data-scroll-target="#wide-vs.-long-data-format-in-data-reshaping"><span class="header-section-number">14.1.2</span> Wide vs.&nbsp;Long Data Format in Data Reshaping</a></li>
  <li><a href="#pivoting-long-to-wide-using-pivot_table" id="toc-pivoting-long-to-wide-using-pivot_table" class="nav-link" data-scroll-target="#pivoting-long-to-wide-using-pivot_table"><span class="header-section-number">14.1.3</span> Pivoting “long” to “wide” using <code>pivot_table()</code></a>
  <ul class="collapse">
  <li><a href="#pivoting-a-single-column" id="toc-pivoting-a-single-column" class="nav-link" data-scroll-target="#pivoting-a-single-column"><span class="header-section-number">14.1.3.1</span> Pivoting a single column</a></li>
  </ul></li>
  <li><a href="#melting-wide-to-long-using-melt" id="toc-melting-wide-to-long-using-melt" class="nav-link" data-scroll-target="#melting-wide-to-long-using-melt"><span class="header-section-number">14.1.4</span> Melting “wide” to “long” using <code>melt()</code></a></li>
  <li><a href="#stacking-and-unstacking-using-stack-and-unstack" id="toc-stacking-and-unstacking-using-stack-and-unstack" class="nav-link" data-scroll-target="#stacking-and-unstacking-using-stack-and-unstack"><span class="header-section-number">14.1.5</span> Stacking and Unstacking using <code>stack()</code> and <code>unstack()</code></a>
  <ul class="collapse">
  <li><a href="#understanding-the-level-in-multi-level-index-and-columns" id="toc-understanding-the-level-in-multi-level-index-and-columns" class="nav-link" data-scroll-target="#understanding-the-level-in-multi-level-index-and-columns"><span class="header-section-number">14.1.5.1</span> Understanding the <code>level</code> in multi-level index and columns</a></li>
  <li><a href="#stacking-columns-to-rows-stack" id="toc-stacking-columns-to-rows-stack" class="nav-link" data-scroll-target="#stacking-columns-to-rows-stack"><span class="header-section-number">14.1.5.2</span> Stacking (Columns to Rows ): <code>stack()</code></a></li>
  <li><a href="#unstacking-rows-to-columns-unstack" id="toc-unstacking-rows-to-columns-unstack" class="nav-link" data-scroll-target="#unstacking-rows-to-columns-unstack"><span class="header-section-number">14.1.5.3</span> Unstacking (Rows to Columns) : <code>unstack()</code></a></li>
  </ul></li>
  <li><a href="#transposing-using-.t-attribute" id="toc-transposing-using-.t-attribute" class="nav-link" data-scroll-target="#transposing-using-.t-attribute"><span class="header-section-number">14.1.6</span> Transposing using <code>.T</code> attribute</a></li>
  <li><a href="#summary-of-common-reshaping-functions" id="toc-summary-of-common-reshaping-functions" class="nav-link" data-scroll-target="#summary-of-common-reshaping-functions"><span class="header-section-number">14.1.7</span> Summary of Common Reshaping Functions</a></li>
  <li><a href="#converting-from-multi-level-index-to-single-level-index-dataframe" id="toc-converting-from-multi-level-index-to-single-level-index-dataframe" class="nav-link" data-scroll-target="#converting-from-multi-level-index-to-single-level-index-dataframe"><span class="header-section-number">14.1.8</span> Converting from Multi-Level Index to Single-Level Index DataFrame</a></li>
  </ul></li>
  <li><a href="#data-enriching" id="toc-data-enriching" class="nav-link" data-scroll-target="#data-enriching"><span class="header-section-number">14.2</span> Data Enriching</a>
  <ul>
  <li><a href="#combining-based-on-common-keys-merge" id="toc-combining-based-on-common-keys-merge" class="nav-link" data-scroll-target="#combining-based-on-common-keys-merge"><span class="header-section-number">14.2.1</span> Combining based on common keys: <code>merge()</code></a>
  <ul class="collapse">
  <li><a href="#outer-join" id="toc-outer-join" class="nav-link" data-scroll-target="#outer-join"><span class="header-section-number">14.2.1.1</span> outer join</a></li>
  </ul></li>
  <li><a href="#combining-based-on-indices-join" id="toc-combining-based-on-indices-join" class="nav-link" data-scroll-target="#combining-based-on-indices-join"><span class="header-section-number">14.2.2</span> Combining based on Indices: <code>join()</code></a></li>
  <li><a href="#stacking-vertically-or-horizontally-concat" id="toc-stacking-vertically-or-horizontally-concat" class="nav-link" data-scroll-target="#stacking-vertically-or-horizontally-concat"><span class="header-section-number">14.2.3</span> Stacking vertically or horizontally: <code>concat()</code></a></li>
  <li><a href="#missing-values-after-data-enriching" id="toc-missing-values-after-data-enriching" class="nav-link" data-scroll-target="#missing-values-after-data-enriching"><span class="header-section-number">14.2.4</span> Missing values after data enriching</a></li>
  </ul></li>
  <li><a href="#independent-study" id="toc-independent-study" class="nav-link" data-scroll-target="#independent-study"><span class="header-section-number">14.3</span> Independent Study</a>
  <ul>
  <li><a href="#practice-exercise-1" id="toc-practice-exercise-1" class="nav-link" data-scroll-target="#practice-exercise-1"><span class="header-section-number">14.3.1</span> Practice exercise 1</a>
  <ul class="collapse">
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"><span class="header-section-number">14.3.1.1</span> </a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1"><span class="header-section-number">14.3.1.2</span> </a></li>
  </ul></li>
  <li><a href="#practice-exercise-2" id="toc-practice-exercise-2" class="nav-link" data-scroll-target="#practice-exercise-2"><span class="header-section-number">14.3.2</span> Practice exercise 2</a>
  <ul class="collapse">
  <li><a href="#preparing-gdp-per-capita-data" id="toc-preparing-gdp-per-capita-data" class="nav-link" data-scroll-target="#preparing-gdp-per-capita-data"><span class="header-section-number">14.3.2.1</span> Preparing GDP per capita data</a></li>
  <li><a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2"><span class="header-section-number">14.3.2.2</span> </a></li>
  <li><a href="#section-3" id="toc-section-3" class="nav-link" data-scroll-target="#section-3"><span class="header-section-number">14.3.2.3</span> </a></li>
  <li><a href="#section-4" id="toc-section-4" class="nav-link" data-scroll-target="#section-4"><span class="header-section-number">14.3.2.4</span> </a></li>
  <li><a href="#section-5" id="toc-section-5" class="nav-link" data-scroll-target="#section-5"><span class="header-section-number">14.3.2.5</span> </a></li>
  <li><a href="#section-6" id="toc-section-6" class="nav-link" data-scroll-target="#section-6"><span class="header-section-number">14.3.2.6</span> </a></li>
  <li><a href="#section-7" id="toc-section-7" class="nav-link" data-scroll-target="#section-7"><span class="header-section-number">14.3.2.7</span> </a></li>
  <li><a href="#preparing-population-data" id="toc-preparing-population-data" class="nav-link" data-scroll-target="#preparing-population-data"><span class="header-section-number">14.3.2.8</span> Preparing population data</a></li>
  <li><a href="#section-8" id="toc-section-8" class="nav-link" data-scroll-target="#section-8"><span class="header-section-number">14.3.2.9</span> </a></li>
  <li><a href="#section-9" id="toc-section-9" class="nav-link" data-scroll-target="#section-9"><span class="header-section-number">14.3.2.10</span> </a></li>
  <li><a href="#merging-gdp-per-capita-and-population-datasets" id="toc-merging-gdp-per-capita-and-population-datasets" class="nav-link" data-scroll-target="#merging-gdp-per-capita-and-population-datasets"><span class="header-section-number">14.3.2.11</span> Merging GDP per capita and population datasets</a></li>
  <li><a href="#section-10" id="toc-section-10" class="nav-link" data-scroll-target="#section-10"><span class="header-section-number">14.3.2.12</span> </a></li>
  </ul></li>
  <li><a href="#merging-datasets-with-similar-values-in-the-key-column" id="toc-merging-datasets-with-similar-values-in-the-key-column" class="nav-link" data-scroll-target="#merging-datasets-with-similar-values-in-the-key-column"><span class="header-section-number">14.3.3</span> Merging datasets with <em>similar</em> values in the <em>key</em> column</a>
  <ul class="collapse">
  <li><a href="#section-11" id="toc-section-11" class="nav-link" data-scroll-target="#section-11"><span class="header-section-number">14.3.3.1</span> </a></li>
  <li><a href="#section-12" id="toc-section-12" class="nav-link" data-scroll-target="#section-12"><span class="header-section-number">14.3.3.2</span> </a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Data cleaning and preparation.html">From messy to insight</a></li><li class="breadcrumb-item"><a href="./Data wrangling.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Data Reshaping and Enrichment</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Data Reshaping and Enrichment</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this chapter, we will explore how to reshape and enrich data using pandas. Data reshaping and enriching are essential steps in data preprocessing because they help transform raw data into a more structured, useful, and meaningful format that can be effectively used for analysis or modeling.</p>
<div id="867f475c" class="cell" data-execution_count="28">
<div class="cell-output cell-output-display">

<div style="display: flex; gap: 20px;">
    <img src="https://ucarecdn.com/fe16e27c-a341-4551-9b84-e0e56bb2d329/-/stretch/off/-/resize/1100x/-/format/webp/" width="400">
    <img src="https://pandas.pydata.org/docs/_images/merging_join_multi_df.png" width="500">
</div>
</div>
</div>
<section id="data-reshaping" class="level2" data-number="14.1">
<h2 data-number="14.1" class="anchored" data-anchor-id="data-reshaping"><span class="header-section-number">14.1</span> Data Reshaping</h2>
<p>Data reshaping involves altering the structure of the data to suit the requirements of the analysis or modeling process. This is often needed when the data is in a format that is difficult to analyze or when it needs to be organized in a specific way.</p>
<section id="why-data-reshaping-is-important" class="level3" data-number="14.1.1">
<h3 data-number="14.1.1" class="anchored" data-anchor-id="why-data-reshaping-is-important"><span class="header-section-number">14.1.1</span> Why Data Reshaping is Important:</h3>
<ul>
<li><p><strong>Improves Data Organization</strong>: Raw data may be in a long format, where each observation is recorded on a separate row, or it may be in a wide format, where the same variable is spread across multiple columns. Reshaping allows you to reorganize the data into a format that is more suitable for analysis, such as turning multiple columns into a single column (melting) or aggregating rows into summary statistics (pivoting).</p></li>
<li><p><strong>Facilitates Analysis</strong>: Some analysis techniques require specific data formats. For example, many machine learning algorithms require data in a matrix form, where each row represents a sample and each column represents a feature. Reshaping helps to convert data into this format.</p></li>
<li><p><strong>Simplifies Visualization</strong>: Visualizing data is easier when it is in the right shape. For instance, plotting categorical data across time is easier when the data is in a tidy format, rather than having multiple variables spread across columns.</p></li>
<li><p><strong>Efficient Grouping and Aggregation</strong>: In some cases, you may want to group data by certain categories or time periods, and reshaping can help aggregate data effectively for summarization.</p></li>
</ul>
</section>
<section id="wide-vs.-long-data-format-in-data-reshaping" class="level3" data-number="14.1.2">
<h3 data-number="14.1.2" class="anchored" data-anchor-id="wide-vs.-long-data-format-in-data-reshaping"><span class="header-section-number">14.1.2</span> Wide vs.&nbsp;Long Data Format in Data Reshaping</h3>
<ul>
<li><strong>Wide Format</strong>: Each variable in its own column; each row represents a unit, and data for multiple variables is spread across columns.</li>
<li><strong>Long Format</strong>: Variables are stacked into one column per variable, with additional columns used to indicate time, categories, or other distinctions, leading to a greater number of rows.</li>
</ul>
<p>To reshape between these two formats, you can use pandas functions such as <code>pivot_table()</code>, <code>melt()</code>, <code>stack()</code>, and <code>unstack()</code>. Let’s next take a look at each of these methods one by one.</p>
<p>Throughout this section, we will continue using the <em>gdp_lifeExpectancy.csv</em> dataset. Let’s start by reading the CSV file into a pandas DataFrame.</p>
<div id="f13ebd23" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cd7d707c" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_data <span class="op">=</span> pd.read_csv(<span class="st">'./Datasets/gdp_lifeExpectancy.csv'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">lifeExp</th>
<th data-quarto-table-cell-role="th">pop</th>
<th data-quarto-table-cell-role="th">gdpPercap</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Afghanistan</td>
<td>Asia</td>
<td>1952</td>
<td>28.801</td>
<td>8425333</td>
<td>779.445314</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Afghanistan</td>
<td>Asia</td>
<td>1957</td>
<td>30.332</td>
<td>9240934</td>
<td>820.853030</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Afghanistan</td>
<td>Asia</td>
<td>1962</td>
<td>31.997</td>
<td>10267083</td>
<td>853.100710</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Afghanistan</td>
<td>Asia</td>
<td>1967</td>
<td>34.020</td>
<td>11537966</td>
<td>836.197138</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Afghanistan</td>
<td>Asia</td>
<td>1972</td>
<td>36.088</td>
<td>13079460</td>
<td>739.981106</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="pivoting-long-to-wide-using-pivot_table" class="level3" data-number="14.1.3">
<h3 data-number="14.1.3" class="anchored" data-anchor-id="pivoting-long-to-wide-using-pivot_table"><span class="header-section-number">14.1.3</span> Pivoting “long” to “wide” using <code>pivot_table()</code></h3>
<p>In the last chapter, we learned that <code>pivot_table()</code> is a powerful tool for performing groupwise aggregation in a structured format. The <code>pivot_table()</code> function is used to reshape data by specifying columns for the index, columns, and values.</p>
<section id="pivoting-a-single-column" class="level4" data-number="14.1.3.1">
<h4 data-number="14.1.3.1" class="anchored" data-anchor-id="pivoting-a-single-column"><span class="header-section-number">14.1.3.1</span> Pivoting a single column</h4>
<p>Consider the life expectancy dataset. Let’s calculate the average life expectancy for each combination of country and year.</p>
<div id="403e0d05" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_data_pivot <span class="op">=</span> gdp_lifeExp_data.pivot_table(index<span class="op">=</span>[<span class="st">'continent'</span>,<span class="st">'country'</span>], columns<span class="op">=</span><span class="st">'year'</span>, values<span class="op">=</span><span class="st">'lifeExp'</span>, aggfunc<span class="op">=</span><span class="st">'mean'</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_data_pivot.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">1952</th>
<th data-quarto-table-cell-role="th">1957</th>
<th data-quarto-table-cell-role="th">1962</th>
<th data-quarto-table-cell-role="th">1967</th>
<th data-quarto-table-cell-role="th">1972</th>
<th data-quarto-table-cell-role="th">1977</th>
<th data-quarto-table-cell-role="th">1982</th>
<th data-quarto-table-cell-role="th">1987</th>
<th data-quarto-table-cell-role="th">1992</th>
<th data-quarto-table-cell-role="th">1997</th>
<th data-quarto-table-cell-role="th">2002</th>
<th data-quarto-table-cell-role="th">2007</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">Africa</td>
<td data-quarto-table-cell-role="th">Algeria</td>
<td>43.077</td>
<td>45.685</td>
<td>48.303</td>
<td>51.407</td>
<td>54.518</td>
<td>58.014</td>
<td>61.368</td>
<td>65.799</td>
<td>67.744</td>
<td>69.152</td>
<td>70.994</td>
<td>72.301</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Angola</td>
<td>30.015</td>
<td>31.999</td>
<td>34.000</td>
<td>35.985</td>
<td>37.928</td>
<td>39.483</td>
<td>39.942</td>
<td>39.906</td>
<td>40.647</td>
<td>40.963</td>
<td>41.003</td>
<td>42.731</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Benin</td>
<td>38.223</td>
<td>40.358</td>
<td>42.618</td>
<td>44.885</td>
<td>47.014</td>
<td>49.190</td>
<td>50.904</td>
<td>52.337</td>
<td>53.919</td>
<td>54.777</td>
<td>54.406</td>
<td>56.728</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Botswana</td>
<td>47.622</td>
<td>49.618</td>
<td>51.520</td>
<td>53.298</td>
<td>56.024</td>
<td>59.319</td>
<td>61.484</td>
<td>63.622</td>
<td>62.745</td>
<td>52.556</td>
<td>46.634</td>
<td>50.728</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Burkina Faso</td>
<td>31.975</td>
<td>34.906</td>
<td>37.814</td>
<td>40.697</td>
<td>43.591</td>
<td>46.137</td>
<td>48.122</td>
<td>49.557</td>
<td>50.260</td>
<td>50.324</td>
<td>50.650</td>
<td>52.295</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Explanation</strong></p>
<ul>
<li><strong>values</strong>: Specifies the column to aggregate (e.g., <code>lifeExp</code> in our example).</li>
<li><strong>index</strong>: Groups by the rows based on the <code>continent</code> and <code>country</code> column.</li>
<li><strong>columns</strong>: Groups by the columns based on the <code>year</code> column.</li>
<li><strong>aggfunc</strong>: Uses <code>mean</code> to calculate the average life expectancy.</li>
</ul>
<p>With values of <code>year</code> as columns, it is easy to compare any metric for different years.</p>
<div id="386ad455" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#visualizing the change in life expectancy of all countries in 2007 as compared to that in 1957, i.e., the overall change in life expectancy in 50 years. </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data <span class="op">=</span> gdp_lifeExp_data_pivot, x <span class="op">=</span> <span class="dv">1957</span>,y<span class="op">=</span><span class="dv">2007</span>,hue <span class="op">=</span> <span class="st">'continent'</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data <span class="op">=</span> gdp_lifeExp_data_pivot, x <span class="op">=</span> <span class="dv">1957</span>,y <span class="op">=</span> <span class="dv">1957</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Data wrangling_files/figure-html/cell-6-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Observe that for some African countries, the life expectancy has decreased after 50 years. It is worth investigating these countries to identify factors associated with the decrease.</p>
<p>Another way to visualize a pivot table is by using a heatmap, which represents the 2D table as a matrix of colors, making it easier to interpret patterns and trends.</p>
<div id="3c2d2b2c" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting a heatmap to visualize the life expectancy of all countries in all years, figure size is set to 15x10</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Life expectancy of all countries in all years"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>sns.heatmap(gdp_lifeExp_data_pivot)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Data wrangling_files/figure-html/cell-7-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Common Aggregation Functions in <code>pivot_table()</code></strong></p>
<p>You can use various aggregation functions within <code>pivot_table()</code> to summarize data:</p>
<ul>
<li><strong><code>mean</code></strong> – Calculates the average of values within each group.</li>
<li><strong><code>sum</code></strong> – Computes the total of values within each group.</li>
<li><strong><code>count</code></strong> – Counts the number of non-null entries within each group.</li>
<li><strong><code>min</code></strong> and <strong><code>max</code></strong> – Finds the minimum and maximum values within each group.</li>
</ul>
<p>We can also define our own custom aggregation function and pass it to the <code>aggfunc</code> parameter of the <code>pivot_table()</code> function</p>
<p><strong>For Example:</strong> Find the <span class="math inline">\(90^{th}\)</span> percentile of life expectancy for each country and year combination</p>
<div id="85a6639d" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>pd.pivot_table(data <span class="op">=</span> gdp_lifeExp_data, values <span class="op">=</span> <span class="st">'lifeExp'</span>,index <span class="op">=</span> <span class="st">'country'</span>, columns <span class="op">=</span><span class="st">'year'</span>,aggfunc <span class="op">=</span> <span class="kw">lambda</span> x:np.percentile(x,<span class="dv">90</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">1952</th>
<th data-quarto-table-cell-role="th">1957</th>
<th data-quarto-table-cell-role="th">1962</th>
<th data-quarto-table-cell-role="th">1967</th>
<th data-quarto-table-cell-role="th">1972</th>
<th data-quarto-table-cell-role="th">1977</th>
<th data-quarto-table-cell-role="th">1982</th>
<th data-quarto-table-cell-role="th">1987</th>
<th data-quarto-table-cell-role="th">1992</th>
<th data-quarto-table-cell-role="th">1997</th>
<th data-quarto-table-cell-role="th">2002</th>
<th data-quarto-table-cell-role="th">2007</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Afghanistan</td>
<td>28.801</td>
<td>30.332</td>
<td>31.997</td>
<td>34.020</td>
<td>36.088</td>
<td>38.438</td>
<td>39.854</td>
<td>40.822</td>
<td>41.674</td>
<td>41.763</td>
<td>42.129</td>
<td>43.828</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Albania</td>
<td>55.230</td>
<td>59.280</td>
<td>64.820</td>
<td>66.220</td>
<td>67.690</td>
<td>68.930</td>
<td>70.420</td>
<td>72.000</td>
<td>71.581</td>
<td>72.950</td>
<td>75.651</td>
<td>76.423</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Algeria</td>
<td>43.077</td>
<td>45.685</td>
<td>48.303</td>
<td>51.407</td>
<td>54.518</td>
<td>58.014</td>
<td>61.368</td>
<td>65.799</td>
<td>67.744</td>
<td>69.152</td>
<td>70.994</td>
<td>72.301</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Angola</td>
<td>30.015</td>
<td>31.999</td>
<td>34.000</td>
<td>35.985</td>
<td>37.928</td>
<td>39.483</td>
<td>39.942</td>
<td>39.906</td>
<td>40.647</td>
<td>40.963</td>
<td>41.003</td>
<td>42.731</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Argentina</td>
<td>62.485</td>
<td>64.399</td>
<td>65.142</td>
<td>65.634</td>
<td>67.065</td>
<td>68.481</td>
<td>69.942</td>
<td>70.774</td>
<td>71.868</td>
<td>73.275</td>
<td>74.340</td>
<td>75.320</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Vietnam</td>
<td>40.412</td>
<td>42.887</td>
<td>45.363</td>
<td>47.838</td>
<td>50.254</td>
<td>55.764</td>
<td>58.816</td>
<td>62.820</td>
<td>67.662</td>
<td>70.672</td>
<td>73.017</td>
<td>74.249</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">West Bank and Gaza</td>
<td>43.160</td>
<td>45.671</td>
<td>48.127</td>
<td>51.631</td>
<td>56.532</td>
<td>60.765</td>
<td>64.406</td>
<td>67.046</td>
<td>69.718</td>
<td>71.096</td>
<td>72.370</td>
<td>73.422</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Yemen, Rep.</td>
<td>32.548</td>
<td>33.970</td>
<td>35.180</td>
<td>36.984</td>
<td>39.848</td>
<td>44.175</td>
<td>49.113</td>
<td>52.922</td>
<td>55.599</td>
<td>58.020</td>
<td>60.308</td>
<td>62.698</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Zambia</td>
<td>42.038</td>
<td>44.077</td>
<td>46.023</td>
<td>47.768</td>
<td>50.107</td>
<td>51.386</td>
<td>51.821</td>
<td>50.821</td>
<td>46.100</td>
<td>40.238</td>
<td>39.193</td>
<td>42.384</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Zimbabwe</td>
<td>48.451</td>
<td>50.469</td>
<td>52.358</td>
<td>53.995</td>
<td>55.635</td>
<td>57.674</td>
<td>60.363</td>
<td>62.351</td>
<td>60.377</td>
<td>46.809</td>
<td>39.989</td>
<td>43.487</td>
</tr>
</tbody>
</table>

<p>142 rows × 12 columns</p>
</div>
</div>
</div>
</section>
</section>
<section id="melting-wide-to-long-using-melt" class="level3" data-number="14.1.4">
<h3 data-number="14.1.4" class="anchored" data-anchor-id="melting-wide-to-long-using-melt"><span class="header-section-number">14.1.4</span> Melting “wide” to “long” using <code>melt()</code></h3>
<p>Melting is the <strong>inverse</strong> of pivoting. It transforms columns into rows. The <code>melt()</code> function is used when you want to unpivot a DataFrame, turning multiple columns into rows.</p>
<p>Let’s first consider <em>gdp_lifeExp_data_pivot</em> created in the previous section</p>
<div id="45a69338" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_data_pivot.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">1952</th>
<th data-quarto-table-cell-role="th">1957</th>
<th data-quarto-table-cell-role="th">1962</th>
<th data-quarto-table-cell-role="th">1967</th>
<th data-quarto-table-cell-role="th">1972</th>
<th data-quarto-table-cell-role="th">1977</th>
<th data-quarto-table-cell-role="th">1982</th>
<th data-quarto-table-cell-role="th">1987</th>
<th data-quarto-table-cell-role="th">1992</th>
<th data-quarto-table-cell-role="th">1997</th>
<th data-quarto-table-cell-role="th">2002</th>
<th data-quarto-table-cell-role="th">2007</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">Africa</td>
<td data-quarto-table-cell-role="th">Algeria</td>
<td>43.077</td>
<td>45.685</td>
<td>48.303</td>
<td>51.407</td>
<td>54.518</td>
<td>58.014</td>
<td>61.368</td>
<td>65.799</td>
<td>67.744</td>
<td>69.152</td>
<td>70.994</td>
<td>72.301</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Angola</td>
<td>30.015</td>
<td>31.999</td>
<td>34.000</td>
<td>35.985</td>
<td>37.928</td>
<td>39.483</td>
<td>39.942</td>
<td>39.906</td>
<td>40.647</td>
<td>40.963</td>
<td>41.003</td>
<td>42.731</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Benin</td>
<td>38.223</td>
<td>40.358</td>
<td>42.618</td>
<td>44.885</td>
<td>47.014</td>
<td>49.190</td>
<td>50.904</td>
<td>52.337</td>
<td>53.919</td>
<td>54.777</td>
<td>54.406</td>
<td>56.728</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Botswana</td>
<td>47.622</td>
<td>49.618</td>
<td>51.520</td>
<td>53.298</td>
<td>56.024</td>
<td>59.319</td>
<td>61.484</td>
<td>63.622</td>
<td>62.745</td>
<td>52.556</td>
<td>46.634</td>
<td>50.728</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Burkina Faso</td>
<td>31.975</td>
<td>34.906</td>
<td>37.814</td>
<td>40.697</td>
<td>43.591</td>
<td>46.137</td>
<td>48.122</td>
<td>49.557</td>
<td>50.260</td>
<td>50.324</td>
<td>50.650</td>
<td>52.295</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="bb5dabac" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_data_pivot.melt(value_name<span class="op">=</span><span class="st">'lifeExp'</span>, var_name<span class="op">=</span><span class="st">'year'</span>, ignore_index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">lifeExp</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">Africa</td>
<td data-quarto-table-cell-role="th">Algeria</td>
<td>1952</td>
<td>43.077</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Angola</td>
<td>1952</td>
<td>30.015</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Benin</td>
<td>1952</td>
<td>38.223</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Botswana</td>
<td>1952</td>
<td>47.622</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Burkina Faso</td>
<td>1952</td>
<td>31.975</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td rowspan="3" data-quarto-table-cell-role="th" data-valign="top">Europe</td>
<td data-quarto-table-cell-role="th">Switzerland</td>
<td>2007</td>
<td>81.701</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Turkey</td>
<td>2007</td>
<td>71.777</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">United Kingdom</td>
<td>2007</td>
<td>79.425</td>
</tr>
<tr class="even">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Oceania</td>
<td data-quarto-table-cell-role="th">Australia</td>
<td>2007</td>
<td>81.235</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">New Zealand</td>
<td>2007</td>
<td>80.204</td>
</tr>
</tbody>
</table>

<p>1704 rows × 2 columns</p>
</div>
</div>
</div>
<p>With the above DataFrame, we can visualize the mean life expectancy against year separately for each country in each continent.</p>
</section>
<section id="stacking-and-unstacking-using-stack-and-unstack" class="level3" data-number="14.1.5">
<h3 data-number="14.1.5" class="anchored" data-anchor-id="stacking-and-unstacking-using-stack-and-unstack"><span class="header-section-number">14.1.5</span> Stacking and Unstacking using <code>stack()</code> and <code>unstack()</code></h3>
<p>Stacking and unstacking are powerful techniques used to reshape DataFrames by moving data between rows and columns. These operations are particularly useful when working with <strong>multi-level index</strong> or <strong>multi-level columns</strong>, where the data is structured in a hierarchical format.</p>
<ul>
<li><code>stack()</code>: Converts columns into rows, which means it “stacks” the data into a long format.</li>
<li><code>unstack()</code>: Converts rows into columns, reversing the effect of <code>stack()</code>.</li>
</ul>
<p>Let’s use the GDP per capita dataset and create a DataFrame with a multi-level index (e.g., continent, country) and multi-level columns (e.g., lifeExp , gdpPercap, and pop).</p>
<div id="a6be488d" class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the average and standard deviation of life expectancy, population, and GDP per capita for countries across the years.</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_multilevel_data <span class="op">=</span> gdp_lifeExp_data.groupby([<span class="st">'continent'</span>, <span class="st">'country'</span>])[[<span class="st">'lifeExp'</span>, <span class="st">'pop'</span>, <span class="st">'gdpPercap'</span>]].agg([<span class="st">'mean'</span>, <span class="st">'std'</span>])</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_multilevel_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">lifeExp</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">pop</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">gdpPercap</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
</tr>
<tr class="header">
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">Africa</td>
<td data-quarto-table-cell-role="th">Algeria</td>
<td>59.030167</td>
<td>10.340069</td>
<td>1.987541e+07</td>
<td>8.613355e+06</td>
<td>4426.025973</td>
<td>1310.337656</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Angola</td>
<td>37.883500</td>
<td>4.005276</td>
<td>7.309390e+06</td>
<td>2.672281e+06</td>
<td>3607.100529</td>
<td>1165.900251</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Benin</td>
<td>48.779917</td>
<td>6.128681</td>
<td>4.017497e+06</td>
<td>2.105002e+06</td>
<td>1155.395107</td>
<td>159.741306</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Botswana</td>
<td>54.597500</td>
<td>5.929476</td>
<td>9.711862e+05</td>
<td>4.710965e+05</td>
<td>5031.503557</td>
<td>4178.136987</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Burkina Faso</td>
<td>44.694000</td>
<td>6.845792</td>
<td>7.548677e+06</td>
<td>3.247808e+06</td>
<td>843.990665</td>
<td>183.430087</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td rowspan="3" data-quarto-table-cell-role="th" data-valign="top">Europe</td>
<td data-quarto-table-cell-role="th">Switzerland</td>
<td>75.565083</td>
<td>4.011572</td>
<td>6.384293e+06</td>
<td>8.582009e+05</td>
<td>27074.334405</td>
<td>6886.463308</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Turkey</td>
<td>59.696417</td>
<td>9.030591</td>
<td>4.590901e+07</td>
<td>1.667768e+07</td>
<td>4469.453380</td>
<td>2049.665102</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">United Kingdom</td>
<td>73.922583</td>
<td>3.378943</td>
<td>5.608780e+07</td>
<td>3.174339e+06</td>
<td>19380.472986</td>
<td>7388.189399</td>
</tr>
<tr class="even">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Oceania</td>
<td data-quarto-table-cell-role="th">Australia</td>
<td>74.662917</td>
<td>4.147774</td>
<td>1.464931e+07</td>
<td>3.915203e+06</td>
<td>19980.595634</td>
<td>7815.405220</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">New Zealand</td>
<td>73.989500</td>
<td>3.559724</td>
<td>3.100032e+06</td>
<td>6.547108e+05</td>
<td>17262.622813</td>
<td>4409.009167</td>
</tr>
</tbody>
</table>

<p>142 rows × 6 columns</p>
</div>
</div>
</div>
<p>The resulting DataFrame has two levels of index and two levels of columns, as shown below:</p>
<div id="df4ef260" class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check the level of row and column index</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_multilevel_data.index.nlevels</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>2</code></pre>
</div>
</div>
<div id="a254737b" class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_multilevel_data.columns.nlevels</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>2</code></pre>
</div>
</div>
<p>if you want to see the data along with the index and columns (in a more accessible way), you can directly print the <code>.index</code> and <code>.columns</code> attributes.</p>
<div id="a504b644" class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_multilevel_data.index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>MultiIndex([( 'Africa',                  'Algeria'),
            ( 'Africa',                   'Angola'),
            ( 'Africa',                    'Benin'),
            ( 'Africa',                 'Botswana'),
            ( 'Africa',             'Burkina Faso'),
            ( 'Africa',                  'Burundi'),
            ( 'Africa',                 'Cameroon'),
            ( 'Africa', 'Central African Republic'),
            ( 'Africa',                     'Chad'),
            ( 'Africa',                  'Comoros'),
            ...
            ( 'Europe',                   'Serbia'),
            ( 'Europe',          'Slovak Republic'),
            ( 'Europe',                 'Slovenia'),
            ( 'Europe',                    'Spain'),
            ( 'Europe',                   'Sweden'),
            ( 'Europe',              'Switzerland'),
            ( 'Europe',                   'Turkey'),
            ( 'Europe',           'United Kingdom'),
            ('Oceania',                'Australia'),
            ('Oceania',              'New Zealand')],
           names=['continent', 'country'], length=142)</code></pre>
</div>
</div>
<div id="8e24a0da" class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_multilevel_data.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>MultiIndex([(  'lifeExp', 'mean'),
            (  'lifeExp',  'std'),
            (      'pop', 'mean'),
            (      'pop',  'std'),
            ('gdpPercap', 'mean'),
            ('gdpPercap',  'std')],
           )</code></pre>
</div>
</div>
<p>As seen, <strong>the index and columns each contain tuples</strong>. This is the reason that when performing data subsetting on a DataFrame with multi-level index and columns, you need to supply a tuple to specify the exact location of the data.</p>
<div id="c2f675aa" class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_multilevel_data.loc[(<span class="st">'Americas'</span>, <span class="st">'United States'</span>), (<span class="st">'lifeExp'</span>, <span class="st">'mean'</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>73.4785</code></pre>
</div>
</div>
<div id="726fe86b" class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_multilevel_data.columns.values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>array([('lifeExp', 'mean'), ('lifeExp', 'std'), ('pop', 'mean'),
       ('pop', 'std'), ('gdpPercap', 'mean'), ('gdpPercap', 'std')],
      dtype=object)</code></pre>
</div>
</div>
<section id="understanding-the-level-in-multi-level-index-and-columns" class="level4" data-number="14.1.5.1">
<h4 data-number="14.1.5.1" class="anchored" data-anchor-id="understanding-the-level-in-multi-level-index-and-columns"><span class="header-section-number">14.1.5.1</span> Understanding the <code>level</code> in multi-level index and columns</h4>
<p>The <code>gdp_lifeExp_multilevel_data</code> dataframe have two levels of index and two level of columns, You can reference these levels in various operations, such as grouping, subsetting, or performing aggregations. The <code>level</code> parameter helps identify which part of the multi-level structure you’re working with.</p>
<div id="a82ff7eb" class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_multilevel_data.index.get_level_values(<span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>Index(['Africa', 'Africa', 'Africa', 'Africa', 'Africa', 'Africa', 'Africa',
       'Africa', 'Africa', 'Africa',
       ...
       'Europe', 'Europe', 'Europe', 'Europe', 'Europe', 'Europe', 'Europe',
       'Europe', 'Oceania', 'Oceania'],
      dtype='object', name='continent', length=142)</code></pre>
</div>
</div>
<div id="79d05eaf" class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_multilevel_data.index.get_level_values(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="89604fa7" class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_multilevel_data.columns.get_level_values(<span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>Index(['lifeExp', 'lifeExp', 'pop', 'pop', 'gdpPercap', 'gdpPercap'], dtype='object')</code></pre>
</div>
</div>
<div id="10ee4c08" class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_multilevel_data.columns.get_level_values(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>Index(['mean', 'std', 'mean', 'std', 'mean', 'std'], dtype='object')</code></pre>
</div>
</div>
<div id="c11d1835" class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_multilevel_data.columns.get_level_values(<span class="op">-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>Index(['mean', 'std', 'mean', 'std', 'mean', 'std'], dtype='object')</code></pre>
</div>
</div>
<p>As seen above, the outermost level corresponds to <code>level=0</code>, and it increases as we move inward to the inner levels. The innermost level can be referred to as <code>-1</code>.</p>
<p>Now, let’s use the level number in the <code>droplevel()</code> method to see how it works. The syntax for this method is as follows:</p>
<p><code>DataFrame.droplevel(level, axis=0)</code></p>
<div id="8b02b978" class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop the first level of row index</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_multilevel_data.droplevel(<span class="dv">0</span>, axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">lifeExp</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">pop</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">gdpPercap</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
</tr>
<tr class="header">
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Algeria</td>
<td>59.030167</td>
<td>10.340069</td>
<td>1.987541e+07</td>
<td>8.613355e+06</td>
<td>4426.025973</td>
<td>1310.337656</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Angola</td>
<td>37.883500</td>
<td>4.005276</td>
<td>7.309390e+06</td>
<td>2.672281e+06</td>
<td>3607.100529</td>
<td>1165.900251</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Benin</td>
<td>48.779917</td>
<td>6.128681</td>
<td>4.017497e+06</td>
<td>2.105002e+06</td>
<td>1155.395107</td>
<td>159.741306</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Botswana</td>
<td>54.597500</td>
<td>5.929476</td>
<td>9.711862e+05</td>
<td>4.710965e+05</td>
<td>5031.503557</td>
<td>4178.136987</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Burkina Faso</td>
<td>44.694000</td>
<td>6.845792</td>
<td>7.548677e+06</td>
<td>3.247808e+06</td>
<td>843.990665</td>
<td>183.430087</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Switzerland</td>
<td>75.565083</td>
<td>4.011572</td>
<td>6.384293e+06</td>
<td>8.582009e+05</td>
<td>27074.334405</td>
<td>6886.463308</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Turkey</td>
<td>59.696417</td>
<td>9.030591</td>
<td>4.590901e+07</td>
<td>1.667768e+07</td>
<td>4469.453380</td>
<td>2049.665102</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">United Kingdom</td>
<td>73.922583</td>
<td>3.378943</td>
<td>5.608780e+07</td>
<td>3.174339e+06</td>
<td>19380.472986</td>
<td>7388.189399</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Australia</td>
<td>74.662917</td>
<td>4.147774</td>
<td>1.464931e+07</td>
<td>3.915203e+06</td>
<td>19980.595634</td>
<td>7815.405220</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">New Zealand</td>
<td>73.989500</td>
<td>3.559724</td>
<td>3.100032e+06</td>
<td>6.547108e+05</td>
<td>17262.622813</td>
<td>4409.009167</td>
</tr>
</tbody>
</table>

<p>142 rows × 6 columns</p>
</div>
</div>
</div>
<div id="7d68d6fd" class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop the first level of column index</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_multilevel_data.droplevel(<span class="dv">0</span>, axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">Africa</td>
<td data-quarto-table-cell-role="th">Algeria</td>
<td>59.030167</td>
<td>10.340069</td>
<td>1.987541e+07</td>
<td>8.613355e+06</td>
<td>4426.025973</td>
<td>1310.337656</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Angola</td>
<td>37.883500</td>
<td>4.005276</td>
<td>7.309390e+06</td>
<td>2.672281e+06</td>
<td>3607.100529</td>
<td>1165.900251</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Benin</td>
<td>48.779917</td>
<td>6.128681</td>
<td>4.017497e+06</td>
<td>2.105002e+06</td>
<td>1155.395107</td>
<td>159.741306</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Botswana</td>
<td>54.597500</td>
<td>5.929476</td>
<td>9.711862e+05</td>
<td>4.710965e+05</td>
<td>5031.503557</td>
<td>4178.136987</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Burkina Faso</td>
<td>44.694000</td>
<td>6.845792</td>
<td>7.548677e+06</td>
<td>3.247808e+06</td>
<td>843.990665</td>
<td>183.430087</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td rowspan="3" data-quarto-table-cell-role="th" data-valign="top">Europe</td>
<td data-quarto-table-cell-role="th">Switzerland</td>
<td>75.565083</td>
<td>4.011572</td>
<td>6.384293e+06</td>
<td>8.582009e+05</td>
<td>27074.334405</td>
<td>6886.463308</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Turkey</td>
<td>59.696417</td>
<td>9.030591</td>
<td>4.590901e+07</td>
<td>1.667768e+07</td>
<td>4469.453380</td>
<td>2049.665102</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">United Kingdom</td>
<td>73.922583</td>
<td>3.378943</td>
<td>5.608780e+07</td>
<td>3.174339e+06</td>
<td>19380.472986</td>
<td>7388.189399</td>
</tr>
<tr class="even">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Oceania</td>
<td data-quarto-table-cell-role="th">Australia</td>
<td>74.662917</td>
<td>4.147774</td>
<td>1.464931e+07</td>
<td>3.915203e+06</td>
<td>19980.595634</td>
<td>7815.405220</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">New Zealand</td>
<td>73.989500</td>
<td>3.559724</td>
<td>3.100032e+06</td>
<td>6.547108e+05</td>
<td>17262.622813</td>
<td>4409.009167</td>
</tr>
</tbody>
</table>

<p>142 rows × 6 columns</p>
</div>
</div>
</div>
</section>
<section id="stacking-columns-to-rows-stack" class="level4" data-number="14.1.5.2">
<h4 data-number="14.1.5.2" class="anchored" data-anchor-id="stacking-columns-to-rows-stack"><span class="header-section-number">14.1.5.2</span> Stacking (Columns to Rows ): <code>stack()</code></h4>
<p>The <code>stack()</code> function pivots the columns into rows. You can specify which level you want to stack using the <code>level</code> parameter. By default, it will stack the innermost level of the columns.</p>
<div id="c1ba9994" class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_multilevel_data.stack(future_stack<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">lifeExp</th>
<th data-quarto-table-cell-role="th">pop</th>
<th data-quarto-table-cell-role="th">gdpPercap</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">Africa</td>
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Algeria</td>
<td data-quarto-table-cell-role="th">mean</td>
<td>59.030167</td>
<td>1.987541e+07</td>
<td>4426.025973</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">std</td>
<td>10.340069</td>
<td>8.613355e+06</td>
<td>1310.337656</td>
</tr>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Angola</td>
<td data-quarto-table-cell-role="th">mean</td>
<td>37.883500</td>
<td>7.309390e+06</td>
<td>3607.100529</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">std</td>
<td>4.005276</td>
<td>2.672281e+06</td>
<td>1165.900251</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Benin</td>
<td data-quarto-table-cell-role="th">mean</td>
<td>48.779917</td>
<td>4.017497e+06</td>
<td>1155.395107</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td data-quarto-table-cell-role="th">...</td>
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Europe</td>
<td data-quarto-table-cell-role="th">United Kingdom</td>
<td data-quarto-table-cell-role="th">std</td>
<td>3.378943</td>
<td>3.174339e+06</td>
<td>7388.189399</td>
</tr>
<tr class="even">
<td rowspan="4" data-quarto-table-cell-role="th" data-valign="top">Oceania</td>
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Australia</td>
<td data-quarto-table-cell-role="th">mean</td>
<td>74.662917</td>
<td>1.464931e+07</td>
<td>19980.595634</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>4.147774</td>
<td>3.915203e+06</td>
<td>7815.405220</td>
</tr>
<tr class="even">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">New Zealand</td>
<td data-quarto-table-cell-role="th">mean</td>
<td>73.989500</td>
<td>3.100032e+06</td>
<td>17262.622813</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>3.559724</td>
<td>6.547108e+05</td>
<td>4409.009167</td>
</tr>
</tbody>
</table>

<p>284 rows × 3 columns</p>
</div>
</div>
</div>
<p>Let’s change the default setting by specifying the <code>level=0</code>(the outmost level)</p>
<div id="e1c309f7" class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_multilevel_data.stack(level<span class="op">=</span><span class="dv">0</span>, future_stack<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">Africa</td>
<td rowspan="3" data-quarto-table-cell-role="th" data-valign="top">Algeria</td>
<td data-quarto-table-cell-role="th">lifeExp</td>
<td>5.903017e+01</td>
<td>1.034007e+01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">pop</td>
<td>1.987541e+07</td>
<td>8.613355e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">gdpPercap</td>
<td>4.426026e+03</td>
<td>1.310338e+03</td>
</tr>
<tr class="even">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Angola</td>
<td data-quarto-table-cell-role="th">lifeExp</td>
<td>3.788350e+01</td>
<td>4.005276e+00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">pop</td>
<td>7.309390e+06</td>
<td>2.672281e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td data-quarto-table-cell-role="th">...</td>
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">Oceania</td>
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Australia</td>
<td data-quarto-table-cell-role="th">pop</td>
<td>1.464931e+07</td>
<td>3.915203e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">gdpPercap</td>
<td>1.998060e+04</td>
<td>7.815405e+03</td>
</tr>
<tr class="odd">
<td rowspan="3" data-quarto-table-cell-role="th" data-valign="top">New Zealand</td>
<td data-quarto-table-cell-role="th">lifeExp</td>
<td>7.398950e+01</td>
<td>3.559724e+00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">pop</td>
<td>3.100032e+06</td>
<td>6.547108e+05</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">gdpPercap</td>
<td>1.726262e+04</td>
<td>4.409009e+03</td>
</tr>
</tbody>
</table>

<p>426 rows × 2 columns</p>
</div>
</div>
</div>
</section>
<section id="unstacking-rows-to-columns-unstack" class="level4" data-number="14.1.5.3">
<h4 data-number="14.1.5.3" class="anchored" data-anchor-id="unstacking-rows-to-columns-unstack"><span class="header-section-number">14.1.5.3</span> Unstacking (Rows to Columns) : <code>unstack()</code></h4>
<p>The <code>unstack()</code> function pivots the rows back into columns. By default, it will unstack the innermost level of the index.</p>
<p>Let’s reverse the prevous dataframe to its original shape using <code>unstack()</code>.</p>
<div id="c804d7f9" class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_multilevel_data.stack(level<span class="op">=</span><span class="dv">0</span>, future_stack<span class="op">=</span><span class="va">True</span>).unstack()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th colspan="3" data-quarto-table-cell-role="th" data-halign="left">mean</th>
<th colspan="3" data-quarto-table-cell-role="th" data-halign="left">std</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">lifeExp</th>
<th data-quarto-table-cell-role="th">pop</th>
<th data-quarto-table-cell-role="th">gdpPercap</th>
<th data-quarto-table-cell-role="th">lifeExp</th>
<th data-quarto-table-cell-role="th">pop</th>
<th data-quarto-table-cell-role="th">gdpPercap</th>
</tr>
<tr class="header">
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">Africa</td>
<td data-quarto-table-cell-role="th">Algeria</td>
<td>59.030167</td>
<td>1.987541e+07</td>
<td>4426.025973</td>
<td>10.340069</td>
<td>8.613355e+06</td>
<td>1310.337656</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Angola</td>
<td>37.883500</td>
<td>7.309390e+06</td>
<td>3607.100529</td>
<td>4.005276</td>
<td>2.672281e+06</td>
<td>1165.900251</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Benin</td>
<td>48.779917</td>
<td>4.017497e+06</td>
<td>1155.395107</td>
<td>6.128681</td>
<td>2.105002e+06</td>
<td>159.741306</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Botswana</td>
<td>54.597500</td>
<td>9.711862e+05</td>
<td>5031.503557</td>
<td>5.929476</td>
<td>4.710965e+05</td>
<td>4178.136987</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Burkina Faso</td>
<td>44.694000</td>
<td>7.548677e+06</td>
<td>843.990665</td>
<td>6.845792</td>
<td>3.247808e+06</td>
<td>183.430087</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td rowspan="3" data-quarto-table-cell-role="th" data-valign="top">Europe</td>
<td data-quarto-table-cell-role="th">Switzerland</td>
<td>75.565083</td>
<td>6.384293e+06</td>
<td>27074.334405</td>
<td>4.011572</td>
<td>8.582009e+05</td>
<td>6886.463308</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Turkey</td>
<td>59.696417</td>
<td>4.590901e+07</td>
<td>4469.453380</td>
<td>9.030591</td>
<td>1.667768e+07</td>
<td>2049.665102</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">United Kingdom</td>
<td>73.922583</td>
<td>5.608780e+07</td>
<td>19380.472986</td>
<td>3.378943</td>
<td>3.174339e+06</td>
<td>7388.189399</td>
</tr>
<tr class="even">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Oceania</td>
<td data-quarto-table-cell-role="th">Australia</td>
<td>74.662917</td>
<td>1.464931e+07</td>
<td>19980.595634</td>
<td>4.147774</td>
<td>3.915203e+06</td>
<td>7815.405220</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">New Zealand</td>
<td>73.989500</td>
<td>3.100032e+06</td>
<td>17262.622813</td>
<td>3.559724</td>
<td>6.547108e+05</td>
<td>4409.009167</td>
</tr>
</tbody>
</table>

<p>142 rows × 6 columns</p>
</div>
</div>
</div>
</section>
</section>
<section id="transposing-using-.t-attribute" class="level3" data-number="14.1.6">
<h3 data-number="14.1.6" class="anchored" data-anchor-id="transposing-using-.t-attribute"><span class="header-section-number">14.1.6</span> Transposing using <code>.T</code> attribute</h3>
<p>If you simply want to swap rows and columns, you can use the <code>.T</code> attribute.</p>
<div id="b88727d0" class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_multilevel_data.T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">continent</th>
<th colspan="10" data-quarto-table-cell-role="th" data-halign="left">Africa</th>
<th data-quarto-table-cell-role="th">...</th>
<th colspan="8" data-quarto-table-cell-role="th" data-halign="left">Europe</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">Oceania</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">Algeria</th>
<th data-quarto-table-cell-role="th">Angola</th>
<th data-quarto-table-cell-role="th">Benin</th>
<th data-quarto-table-cell-role="th">Botswana</th>
<th data-quarto-table-cell-role="th">Burkina Faso</th>
<th data-quarto-table-cell-role="th">Burundi</th>
<th data-quarto-table-cell-role="th">Cameroon</th>
<th data-quarto-table-cell-role="th">Central African Republic</th>
<th data-quarto-table-cell-role="th">Chad</th>
<th data-quarto-table-cell-role="th">Comoros</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Serbia</th>
<th data-quarto-table-cell-role="th">Slovak Republic</th>
<th data-quarto-table-cell-role="th">Slovenia</th>
<th data-quarto-table-cell-role="th">Spain</th>
<th data-quarto-table-cell-role="th">Sweden</th>
<th data-quarto-table-cell-role="th">Switzerland</th>
<th data-quarto-table-cell-role="th">Turkey</th>
<th data-quarto-table-cell-role="th">United Kingdom</th>
<th data-quarto-table-cell-role="th">Australia</th>
<th data-quarto-table-cell-role="th">New Zealand</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">lifeExp</td>
<td data-quarto-table-cell-role="th">mean</td>
<td>5.903017e+01</td>
<td>3.788350e+01</td>
<td>4.877992e+01</td>
<td>54.597500</td>
<td>4.469400e+01</td>
<td>4.481733e+01</td>
<td>4.812850e+01</td>
<td>4.386692e+01</td>
<td>4.677358e+01</td>
<td>52.381750</td>
<td>...</td>
<td>6.855100e+01</td>
<td>7.069608e+01</td>
<td>7.160075e+01</td>
<td>7.420342e+01</td>
<td>7.617700e+01</td>
<td>7.556508e+01</td>
<td>5.969642e+01</td>
<td>7.392258e+01</td>
<td>7.466292e+01</td>
<td>7.398950e+01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">std</td>
<td>1.034007e+01</td>
<td>4.005276e+00</td>
<td>6.128681e+00</td>
<td>5.929476</td>
<td>6.845792e+00</td>
<td>3.174882e+00</td>
<td>5.467960e+00</td>
<td>4.720690e+00</td>
<td>4.887978e+00</td>
<td>8.132353</td>
<td>...</td>
<td>4.906736e+00</td>
<td>2.715787e+00</td>
<td>3.677979e+00</td>
<td>5.155859e+00</td>
<td>3.003990e+00</td>
<td>4.011572e+00</td>
<td>9.030591e+00</td>
<td>3.378943e+00</td>
<td>4.147774e+00</td>
<td>3.559724e+00</td>
</tr>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">pop</td>
<td data-quarto-table-cell-role="th">mean</td>
<td>1.987541e+07</td>
<td>7.309390e+06</td>
<td>4.017497e+06</td>
<td>971186.166667</td>
<td>7.548677e+06</td>
<td>4.651608e+06</td>
<td>9.816648e+06</td>
<td>2.560963e+06</td>
<td>5.329256e+06</td>
<td>361683.916667</td>
<td>...</td>
<td>8.783887e+06</td>
<td>4.774507e+06</td>
<td>1.794381e+06</td>
<td>3.585180e+07</td>
<td>8.220029e+06</td>
<td>6.384293e+06</td>
<td>4.590901e+07</td>
<td>5.608780e+07</td>
<td>1.464931e+07</td>
<td>3.100032e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">std</td>
<td>8.613355e+06</td>
<td>2.672281e+06</td>
<td>2.105002e+06</td>
<td>471096.527435</td>
<td>3.247808e+06</td>
<td>1.874538e+06</td>
<td>4.363640e+06</td>
<td>1.072158e+06</td>
<td>2.464304e+06</td>
<td>182998.737990</td>
<td>...</td>
<td>1.192153e+06</td>
<td>6.425096e+05</td>
<td>2.022077e+05</td>
<td>4.323928e+06</td>
<td>6.365660e+05</td>
<td>8.582009e+05</td>
<td>1.667768e+07</td>
<td>3.174339e+06</td>
<td>3.915203e+06</td>
<td>6.547108e+05</td>
</tr>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">gdpPercap</td>
<td data-quarto-table-cell-role="th">mean</td>
<td>4.426026e+03</td>
<td>3.607101e+03</td>
<td>1.155395e+03</td>
<td>5031.503557</td>
<td>8.439907e+02</td>
<td>4.716630e+02</td>
<td>1.774634e+03</td>
<td>9.587847e+02</td>
<td>1.165454e+03</td>
<td>1314.380339</td>
<td>...</td>
<td>9.305049e+03</td>
<td>1.041553e+04</td>
<td>1.407458e+04</td>
<td>1.402983e+04</td>
<td>1.994313e+04</td>
<td>2.707433e+04</td>
<td>4.469453e+03</td>
<td>1.938047e+04</td>
<td>1.998060e+04</td>
<td>1.726262e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">std</td>
<td>1.310338e+03</td>
<td>1.165900e+03</td>
<td>1.597413e+02</td>
<td>4178.136987</td>
<td>1.834301e+02</td>
<td>9.932972e+01</td>
<td>4.195899e+02</td>
<td>1.919529e+02</td>
<td>2.305481e+02</td>
<td>298.334389</td>
<td>...</td>
<td>3.829907e+03</td>
<td>3.650231e+03</td>
<td>6.470288e+03</td>
<td>8.046635e+03</td>
<td>7.723248e+03</td>
<td>6.886463e+03</td>
<td>2.049665e+03</td>
<td>7.388189e+03</td>
<td>7.815405e+03</td>
<td>4.409009e+03</td>
</tr>
</tbody>
</table>

<p>6 rows × 142 columns</p>
</div>
</div>
</div>
</section>
<section id="summary-of-common-reshaping-functions" class="level3" data-number="14.1.7">
<h3 data-number="14.1.7" class="anchored" data-anchor-id="summary-of-common-reshaping-functions"><span class="header-section-number">14.1.7</span> Summary of Common Reshaping Functions</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 13%">
<col style="width: 53%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>pivot()</code></td>
<td>Reshape data by creating new columns from existing ones.</td>
<td>Pivot data on index/columns.</td>
</tr>
<tr class="even">
<td><code>melt()</code></td>
<td>Unpivot data, turning columns into rows.</td>
<td>Convert wide format to long.</td>
</tr>
<tr class="odd">
<td><code>stack()</code></td>
<td>Convert columns to rows.</td>
<td>Move column data to rows.</td>
</tr>
<tr class="even">
<td><code>unstack()</code></td>
<td>Convert rows back to columns.</td>
<td>Move row data to columns.</td>
</tr>
<tr class="odd">
<td><code>.T</code></td>
<td>Transpose the DataFrame (swap rows and columns).</td>
<td>Transpose the entire DataFrame.</td>
</tr>
</tbody>
</table>
<p><strong>Practical Use Cases:</strong></p>
<ul>
<li><strong>Pivoting:</strong> Useful for time series analysis or when you want to group and summarize data by specific categories.</li>
<li><strong>Melting:</strong> Helpful when you need to reshape wide data for easier analysis or when preparing data for machine learning algorithms.</li>
<li><strong>Stacking/Unstacking:</strong> Useful when you are working with hierarchical index DataFrames.</li>
<li><strong>Transpose:</strong> Helpful for reorienting data for analysis or visualization.</li>
</ul>
</section>
<section id="converting-from-multi-level-index-to-single-level-index-dataframe" class="level3" data-number="14.1.8">
<h3 data-number="14.1.8" class="anchored" data-anchor-id="converting-from-multi-level-index-to-single-level-index-dataframe"><span class="header-section-number">14.1.8</span> Converting from Multi-Level Index to Single-Level Index DataFrame</h3>
<p>If you’re uncomfortable working with DataFrames that have multi-level indexes and columns, you can convert them into single-level DataFrames using the methods you learned in the previous chapter:</p>
<ul>
<li><code>reset_index()</code></li>
<li>Flattening the multi-level columns</li>
</ul>
<div id="284613ec" class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reset the index to convert the multi-level index to a single-level index</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_multilevel_data.reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">country</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">lifeExp</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">pop</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">gdpPercap</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Africa</td>
<td>Algeria</td>
<td>59.030167</td>
<td>10.340069</td>
<td>1.987541e+07</td>
<td>8.613355e+06</td>
<td>4426.025973</td>
<td>1310.337656</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Africa</td>
<td>Angola</td>
<td>37.883500</td>
<td>4.005276</td>
<td>7.309390e+06</td>
<td>2.672281e+06</td>
<td>3607.100529</td>
<td>1165.900251</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Africa</td>
<td>Benin</td>
<td>48.779917</td>
<td>6.128681</td>
<td>4.017497e+06</td>
<td>2.105002e+06</td>
<td>1155.395107</td>
<td>159.741306</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Africa</td>
<td>Botswana</td>
<td>54.597500</td>
<td>5.929476</td>
<td>9.711862e+05</td>
<td>4.710965e+05</td>
<td>5031.503557</td>
<td>4178.136987</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Africa</td>
<td>Burkina Faso</td>
<td>44.694000</td>
<td>6.845792</td>
<td>7.548677e+06</td>
<td>3.247808e+06</td>
<td>843.990665</td>
<td>183.430087</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">137</td>
<td>Europe</td>
<td>Switzerland</td>
<td>75.565083</td>
<td>4.011572</td>
<td>6.384293e+06</td>
<td>8.582009e+05</td>
<td>27074.334405</td>
<td>6886.463308</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">138</td>
<td>Europe</td>
<td>Turkey</td>
<td>59.696417</td>
<td>9.030591</td>
<td>4.590901e+07</td>
<td>1.667768e+07</td>
<td>4469.453380</td>
<td>2049.665102</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">139</td>
<td>Europe</td>
<td>United Kingdom</td>
<td>73.922583</td>
<td>3.378943</td>
<td>5.608780e+07</td>
<td>3.174339e+06</td>
<td>19380.472986</td>
<td>7388.189399</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">140</td>
<td>Oceania</td>
<td>Australia</td>
<td>74.662917</td>
<td>4.147774</td>
<td>1.464931e+07</td>
<td>3.915203e+06</td>
<td>19980.595634</td>
<td>7815.405220</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">141</td>
<td>Oceania</td>
<td>New Zealand</td>
<td>73.989500</td>
<td>3.559724</td>
<td>3.100032e+06</td>
<td>6.547108e+05</td>
<td>17262.622813</td>
<td>4409.009167</td>
</tr>
</tbody>
</table>

<p>142 rows × 8 columns</p>
</div>
</div>
</div>
<div id="ef825ba9" class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># flatten the multi-level column</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_multilevel_data.columns <span class="op">=</span> [<span class="st">'_'</span>.join(col).strip() <span class="cf">for</span> col <span class="kw">in</span> gdp_lifeExp_multilevel_data.columns.values]</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_multilevel_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">lifeExp_mean</th>
<th data-quarto-table-cell-role="th">lifeExp_std</th>
<th data-quarto-table-cell-role="th">pop_mean</th>
<th data-quarto-table-cell-role="th">pop_std</th>
<th data-quarto-table-cell-role="th">gdpPercap_mean</th>
<th data-quarto-table-cell-role="th">gdpPercap_std</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">Africa</td>
<td data-quarto-table-cell-role="th">Algeria</td>
<td>59.030167</td>
<td>10.340069</td>
<td>1.987541e+07</td>
<td>8.613355e+06</td>
<td>4426.025973</td>
<td>1310.337656</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Angola</td>
<td>37.883500</td>
<td>4.005276</td>
<td>7.309390e+06</td>
<td>2.672281e+06</td>
<td>3607.100529</td>
<td>1165.900251</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Benin</td>
<td>48.779917</td>
<td>6.128681</td>
<td>4.017497e+06</td>
<td>2.105002e+06</td>
<td>1155.395107</td>
<td>159.741306</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Botswana</td>
<td>54.597500</td>
<td>5.929476</td>
<td>9.711862e+05</td>
<td>4.710965e+05</td>
<td>5031.503557</td>
<td>4178.136987</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Burkina Faso</td>
<td>44.694000</td>
<td>6.845792</td>
<td>7.548677e+06</td>
<td>3.247808e+06</td>
<td>843.990665</td>
<td>183.430087</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td rowspan="3" data-quarto-table-cell-role="th" data-valign="top">Europe</td>
<td data-quarto-table-cell-role="th">Switzerland</td>
<td>75.565083</td>
<td>4.011572</td>
<td>6.384293e+06</td>
<td>8.582009e+05</td>
<td>27074.334405</td>
<td>6886.463308</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Turkey</td>
<td>59.696417</td>
<td>9.030591</td>
<td>4.590901e+07</td>
<td>1.667768e+07</td>
<td>4469.453380</td>
<td>2049.665102</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">United Kingdom</td>
<td>73.922583</td>
<td>3.378943</td>
<td>5.608780e+07</td>
<td>3.174339e+06</td>
<td>19380.472986</td>
<td>7388.189399</td>
</tr>
<tr class="even">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Oceania</td>
<td data-quarto-table-cell-role="th">Australia</td>
<td>74.662917</td>
<td>4.147774</td>
<td>1.464931e+07</td>
<td>3.915203e+06</td>
<td>19980.595634</td>
<td>7815.405220</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">New Zealand</td>
<td>73.989500</td>
<td>3.559724</td>
<td>3.100032e+06</td>
<td>6.547108e+05</td>
<td>17262.622813</td>
<td>4409.009167</td>
</tr>
</tbody>
</table>

<p>142 rows × 6 columns</p>
</div>
</div>
</div>
</section>
</section>
<section id="data-enriching" class="level2" data-number="14.2">
<h2 data-number="14.2" class="anchored" data-anchor-id="data-enriching"><span class="header-section-number">14.2</span> Data Enriching</h2>
<p><a href="https://pandas.pydata.org/docs/user_guide/merging.html">Data enriching</a> involves enhancing your existing dataset by adding additional data, often from external sources, to make your dataset more insightful.</p>
<p><img src="https://pandas.pydata.org/docs/_images/merging_join_multi_df.png" class="img-fluid"></p>
<p>There are 3 common methods for data enriching:</p>
<ul>
<li><strong>Merging using <code>merge()</code></strong>: Combining datasets based on a common key.</li>
<li><strong>Joining using <code>join()</code></strong>: Using indices to combine data.</li>
<li><strong>Concatenation using <code>concat()</code></strong>: Stacking DataFrames vertically or horizontally.</li>
</ul>
<p>Let’s first load the existing data</p>
<div id="13d7701d" class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>df_existing <span class="op">=</span> pd.read_csv(<span class="st">'./datasets/LOTR.csv'</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_existing.shape)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>df_existing.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(4, 3)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="87">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">FellowshipID</th>
<th data-quarto-table-cell-role="th">FirstName</th>
<th data-quarto-table-cell-role="th">Skills</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1001</td>
<td>Frodo</td>
<td>Hiding</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1002</td>
<td>Samwise</td>
<td>Gardening</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1003</td>
<td>Gandalf</td>
<td>Spells</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1004</td>
<td>Pippin</td>
<td>Fireworks</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Let’s next load the external data we want to combine to the existing data</p>
<div id="b22e86eb" class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>df_external <span class="op">=</span> pd.read_csv(<span class="st">"./datasets/LOTR 2.csv"</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_external.shape)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>df_external.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(5, 3)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="88">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">FellowshipID</th>
<th data-quarto-table-cell-role="th">FirstName</th>
<th data-quarto-table-cell-role="th">Age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1001</td>
<td>Frodo</td>
<td>50</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1002</td>
<td>Samwise</td>
<td>39</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1006</td>
<td>Legolas</td>
<td>2931</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1007</td>
<td>Elrond</td>
<td>6520</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1008</td>
<td>Barromir</td>
<td>51</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="combining-based-on-common-keys-merge" class="level3" data-number="14.2.1">
<h3 data-number="14.2.1" class="anchored" data-anchor-id="combining-based-on-common-keys-merge"><span class="header-section-number">14.2.1</span> Combining based on common keys: <code>merge()</code></h3>
<div id="ee4b8a4f" class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>df_enriched_merge <span class="op">=</span> pd.merge(df_existing, df_external)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_enriched_merge.shape)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>df_enriched_merge.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(2, 4)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="89">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">FellowshipID</th>
<th data-quarto-table-cell-role="th">FirstName</th>
<th data-quarto-table-cell-role="th">Skills</th>
<th data-quarto-table-cell-role="th">Age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1001</td>
<td>Frodo</td>
<td>Hiding</td>
<td>50</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1002</td>
<td>Samwise</td>
<td>Gardening</td>
<td>39</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>You can also do this way</p>
<div id="805082cb" class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>df_enriched_merge <span class="op">=</span> df_existing.merge(df_external)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_enriched_merge.shape)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>df_enriched_merge.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(2, 4)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="90">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">FellowshipID</th>
<th data-quarto-table-cell-role="th">FirstName</th>
<th data-quarto-table-cell-role="th">Skills</th>
<th data-quarto-table-cell-role="th">Age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1001</td>
<td>Frodo</td>
<td>Hiding</td>
<td>50</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1002</td>
<td>Samwise</td>
<td>Gardening</td>
<td>39</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>By default, the <code>merge()</code> function in pandas performs an <strong>inner join</strong>, which combines two DataFrames based on the <strong>common keys shared by both</strong>. Only the rows with matching keys in both DataFrames are retained in the result.</p>
<p>This behavior can be observed in the following code:</p>
<div id="e2da9e77" class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>df_enriched_merge <span class="op">=</span> pd.merge(df_existing, df_external, how<span class="op">=</span><span class="st">'inner'</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_enriched_merge.shape)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>df_enriched_merge.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(2, 4)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="91">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">FellowshipID</th>
<th data-quarto-table-cell-role="th">FirstName</th>
<th data-quarto-table-cell-role="th">Skills</th>
<th data-quarto-table-cell-role="th">Age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1001</td>
<td>Frodo</td>
<td>Hiding</td>
<td>50</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1002</td>
<td>Samwise</td>
<td>Gardening</td>
<td>39</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>When you may use inner join?</strong> You should use inner join when you cannot carry out the analysis unless the observation corresponding to the <em>key column(s)</em> is present in both the tables.</p>
<p><strong>Example:</strong> Suppose you wish to analyze the association between vaccinations and covid infection rate based on country-level data. In one of the datasets, you have the infection rate for each country, while in the other one you have the number of vaccinations in each country. The countries which have either the vaccination or the infection rate missing, cannot help analyze the association. In such as case you may be interested only in countries that have values for both the variables. Thus, you will use inner join to discard the countries with either value missing.</p>
<p>In <code>merge()</code>, the <code>how</code> parameter specifies the type of merge to be performed, the default option is <code>inner</code>, it could also be <code>left</code>, <code>right</code>, and <code>outer</code>.</p>
<p><img src="https://miro.medium.com/v2/resize:fit:752/0*ZGDgg-0SznYlwiij.png" alt="Description" width="400px"></p>
<p>These join types give you flexibility in how you want to merge and combine data from different sources.</p>
<p>Let’s see how each of these works using our dataframes defined above</p>
<p><strong>Left Join</strong></p>
<ul>
<li>Returns all rows from the left DataFrame and the matching rows from the right DataFrame.</li>
<li>Missing values (<code>NaN</code>) are introduced for non-matching keys from the right DataFrame.</li>
</ul>
<div id="8fd0c8a5" class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>df_merge_lft <span class="op">=</span> pd.merge(df_existing, df_external, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_merge_lft.shape)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>df_merge_lft.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(4, 4)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="92">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">FellowshipID</th>
<th data-quarto-table-cell-role="th">FirstName</th>
<th data-quarto-table-cell-role="th">Skills</th>
<th data-quarto-table-cell-role="th">Age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1001</td>
<td>Frodo</td>
<td>Hiding</td>
<td>50.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1002</td>
<td>Samwise</td>
<td>Gardening</td>
<td>39.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1003</td>
<td>Gandalf</td>
<td>Spells</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1004</td>
<td>Pippin</td>
<td>Fireworks</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>When you may use left join?</strong> You should use left join when the primary variable(s) of interest are present in the one of the datasets, and whose missing values cannot be imputed. The variable(s) in the other dataset may not be as important or it may be possible to reasonably impute their values, if missing corresponding to the observation in the primary dataset.</p>
<p><strong>Examples:</strong></p>
<ol type="1">
<li><p>Suppose you wish to analyze the association between the covid infection rate and the government effectiveness score (a metric used to determine the effectiveness of the government in implementing policies, upholding law and order etc.) based on the data of all countries. Let us say that one of the datasets contains the covid infection rate, while the other one contains the government effectiveness score for each country. If the infection rate for a country is missing, it might be hard to impute. However, the government effectiveness score may be easier to impute based on GDP per capita, crime rate etc. - information that is easily available online. In such a case, you may wish to use a left join where you keep all the countries for which the infection rate is known.</p></li>
<li><p>Suppose you wish to analyze the association between demographics such as age, income etc. and the amount of credit card spend. Let us say one of the datasets contains the demographic information of each customer, while the other one contains the credit card spend for the customers who made at least one purchase. In such as case, you may want to do a left join as customers not making any purchase might be absent in the card spend data. Their spend can be imputed as zero after merging the datasets.</p></li>
</ol>
<p><strong>Right join</strong></p>
<ul>
<li>Returns all rows from the right DataFrame and the matching rows from the left DataFrame.</li>
<li>Missing values (<code>NaN</code>) are introduced for non-matching keys from the left DataFrame.</li>
</ul>
<div id="03a633ee" class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>df_merge_right <span class="op">=</span> pd.merge(df_existing, df_external, how<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_merge_right.shape)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>df_merge_right.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(5, 4)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="93">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">FellowshipID</th>
<th data-quarto-table-cell-role="th">FirstName</th>
<th data-quarto-table-cell-role="th">Skills</th>
<th data-quarto-table-cell-role="th">Age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1001</td>
<td>Frodo</td>
<td>Hiding</td>
<td>50</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1002</td>
<td>Samwise</td>
<td>Gardening</td>
<td>39</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1006</td>
<td>Legolas</td>
<td>NaN</td>
<td>2931</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1007</td>
<td>Elrond</td>
<td>NaN</td>
<td>6520</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1008</td>
<td>Barromir</td>
<td>NaN</td>
<td>51</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>When you may use right join?</strong> You can always use a left join instead of a right join. Their purpose is the same.</p>
<section id="outer-join" class="level4" data-number="14.2.1.1">
<h4 data-number="14.2.1.1" class="anchored" data-anchor-id="outer-join"><span class="header-section-number">14.2.1.1</span> outer join</h4>
<ul>
<li>Returns all rows from both DataFrames, with <code>NaN</code> values where no match is found.</li>
</ul>
<div id="eb135e3d" class="cell" data-scrolled="false">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>df_merge_outer <span class="op">=</span> pd.merge(df_existing, df_external, how<span class="op">=</span><span class="st">'outer'</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_merge_outer.shape)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>df_merge_outer</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(7, 4)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="94">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">FellowshipID</th>
<th data-quarto-table-cell-role="th">FirstName</th>
<th data-quarto-table-cell-role="th">Skills</th>
<th data-quarto-table-cell-role="th">Age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1001</td>
<td>Frodo</td>
<td>Hiding</td>
<td>50.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1002</td>
<td>Samwise</td>
<td>Gardening</td>
<td>39.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1003</td>
<td>Gandalf</td>
<td>Spells</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1004</td>
<td>Pippin</td>
<td>Fireworks</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1006</td>
<td>Legolas</td>
<td>NaN</td>
<td>2931.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>1007</td>
<td>Elrond</td>
<td>NaN</td>
<td>6520.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>1008</td>
<td>Barromir</td>
<td>NaN</td>
<td>51.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>When you may use outer join?</strong> You should use an outer join when you cannot afford to lose data present in either of the tables. All the other joins may result in loss of data.</p>
<p><strong>Example:</strong> Suppose I took two course surveys for this course. If I need to analyze student sentiment during the course, I will take an outer join of both the surveys. Assume that each survey is a dataset, where each row corresponds to a unique student. Even if a student has answered one of the two surverys, it will be indicative of the sentiment, and will be useful to keep in the merged dataset.</p>
</section>
</section>
<section id="combining-based-on-indices-join" class="level3" data-number="14.2.2">
<h3 data-number="14.2.2" class="anchored" data-anchor-id="combining-based-on-indices-join"><span class="header-section-number">14.2.2</span> Combining based on Indices: <code>join()</code></h3>
<p>Unlike <code>merge()</code>, <code>join()</code> in pandas combines data based on the <strong>index</strong>. When using <code>join()</code>, you must specify the <code>suffixes</code> parameter if there are overlapping column names, as it does not have default values. You can refer to the official function definition here: <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.join.html">pandas.DataFrame.join</a>.</p>
<p>Please copy the code below and run it in your notebook:</p>
<pre class="{python}"><code>df_enriched_join = df_existing.join(df_external)
print(df_enriched_join.shape)
df_enriched_join.head()</code></pre>
<p>Let’s set the suffix to fix this issue</p>
<div id="368567a9" class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>df_enriched_join <span class="op">=</span> df_existing.join(df_external, lsuffix <span class="op">=</span> <span class="st">'_existing'</span>,rsuffix <span class="op">=</span> <span class="st">'_external'</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_enriched_join.shape)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>df_enriched_join.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(4, 6)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="96">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">FellowshipID_existing</th>
<th data-quarto-table-cell-role="th">FirstName_existing</th>
<th data-quarto-table-cell-role="th">Skills</th>
<th data-quarto-table-cell-role="th">FellowshipID_external</th>
<th data-quarto-table-cell-role="th">FirstName_external</th>
<th data-quarto-table-cell-role="th">Age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1001</td>
<td>Frodo</td>
<td>Hiding</td>
<td>1001</td>
<td>Frodo</td>
<td>50</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1002</td>
<td>Samwise</td>
<td>Gardening</td>
<td>1002</td>
<td>Samwise</td>
<td>39</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1003</td>
<td>Gandalf</td>
<td>Spells</td>
<td>1006</td>
<td>Legolas</td>
<td>2931</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1004</td>
<td>Pippin</td>
<td>Fireworks</td>
<td>1007</td>
<td>Elrond</td>
<td>6520</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>As can be observed, <strong><code>join()</code> merges DataFrames using their index and performs a left join</strong>.</p>
<p>Now, let’s set the “FellowshipID” column as the index in both DataFrames and see what happens.</p>
<div id="fdec7ce7" class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set the index of the dataframes as the "FellowshipID" column</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>df_existing.set_index(<span class="st">'FellowshipID'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>df_external.set_index(<span class="st">'FellowshipID'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="7d7986d8" class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># join the two dataframes</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>df_enriched_join <span class="op">=</span> df_existing.join(df_external, lsuffix <span class="op">=</span> <span class="st">'_existing'</span>,rsuffix <span class="op">=</span> <span class="st">'_external'</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_enriched_join.shape)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>df_enriched_join</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(4, 4)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="98">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">FirstName_existing</th>
<th data-quarto-table-cell-role="th">Skills</th>
<th data-quarto-table-cell-role="th">FirstName_external</th>
<th data-quarto-table-cell-role="th">Age</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">FellowshipID</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1001</td>
<td>Frodo</td>
<td>Hiding</td>
<td>Frodo</td>
<td>50.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1002</td>
<td>Samwise</td>
<td>Gardening</td>
<td>Samwise</td>
<td>39.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1003</td>
<td>Gandalf</td>
<td>Spells</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1004</td>
<td>Pippin</td>
<td>Fireworks</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>In this case, <code>df_enriched_join</code> will contain all rows from <code>df_existing</code> and the corresponding matching rows from <code>df_external</code>, with <code>NaN</code> values for non-matching entries.</p>
<p>Similar to <code>merge()</code>, you can change the type of join in <code>join()</code> by explicitly specifying the <code>how</code> parameter. However, this explanation will be skipped here, as the different join types have already been covered in the <code>merge()</code> section above.</p>
</section>
<section id="stacking-vertically-or-horizontally-concat" class="level3" data-number="14.2.3">
<h3 data-number="14.2.3" class="anchored" data-anchor-id="stacking-vertically-or-horizontally-concat"><span class="header-section-number">14.2.3</span> Stacking vertically or horizontally: <code>concat()</code></h3>
<p><code>concat()</code> is used in pandas to concatenate DataFrames along a specified axis, either rows or columns. Similar to <code>concat()</code> in NumPy, it defaults to concatenating along the rows.</p>
<div id="8fe09215" class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let's concatenate the two dataframes using default setting</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>df_concat <span class="op">=</span> pd.concat([df_existing, df_external])</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_concat.shape)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>df_concat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(9, 3)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="99">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">FirstName</th>
<th data-quarto-table-cell-role="th">Skills</th>
<th data-quarto-table-cell-role="th">Age</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">FellowshipID</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1001</td>
<td>Frodo</td>
<td>Hiding</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1002</td>
<td>Samwise</td>
<td>Gardening</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1003</td>
<td>Gandalf</td>
<td>Spells</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1004</td>
<td>Pippin</td>
<td>Fireworks</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1001</td>
<td>Frodo</td>
<td>NaN</td>
<td>50.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1002</td>
<td>Samwise</td>
<td>NaN</td>
<td>39.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1006</td>
<td>Legolas</td>
<td>NaN</td>
<td>2931.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1007</td>
<td>Elrond</td>
<td>NaN</td>
<td>6520.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1008</td>
<td>Barromir</td>
<td>NaN</td>
<td>51.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="be29c54f" class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenating along columns (horizontal)</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>df_concat_columns <span class="op">=</span> pd.concat([df_existing, df_external], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_concat_columns.shape)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>df_concat_columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(7, 4)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="100">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">FirstName</th>
<th data-quarto-table-cell-role="th">Skills</th>
<th data-quarto-table-cell-role="th">FirstName</th>
<th data-quarto-table-cell-role="th">Age</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">FellowshipID</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1001</td>
<td>Frodo</td>
<td>Hiding</td>
<td>Frodo</td>
<td>50.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1002</td>
<td>Samwise</td>
<td>Gardening</td>
<td>Samwise</td>
<td>39.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1003</td>
<td>Gandalf</td>
<td>Spells</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1004</td>
<td>Pippin</td>
<td>Fireworks</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1006</td>
<td>NaN</td>
<td>NaN</td>
<td>Legolas</td>
<td>2931.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1007</td>
<td>NaN</td>
<td>NaN</td>
<td>Elrond</td>
<td>6520.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1008</td>
<td>NaN</td>
<td>NaN</td>
<td>Barromir</td>
<td>51.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="missing-values-after-data-enriching" class="level3" data-number="14.2.4">
<h3 data-number="14.2.4" class="anchored" data-anchor-id="missing-values-after-data-enriching"><span class="header-section-number">14.2.4</span> Missing values after data enriching</h3>
<p>Using either of the approaches mentioned above may introduce missing values for unmatched entries. Handling these missing values is crucial for maintaining the quality and integrity of your dataset after merging or joining DataFrames. It is important to choose a method that best fits your data and analysis goals, and to document your decisions regarding missing value handling for transparency in your analysis.</p>
<p><strong>Question</strong>: Read the documentations of the Pandas DataFrame methods <code>merge()</code> and <code>concat()</code>, and identify the differences. Mention examples when you can use (i) either, (ii) only <code>concat()</code>, (iii) only <code>merge()</code></p>
<p><strong>Solution:</strong></p>
<ol type="i">
<li><p>If we need to merge datasets using row indices, we can use either function.</p></li>
<li><p>If we need to stack datasets one on top of the other, we can only use <code>concat()</code></p></li>
<li><p>If we need to merge datasets using overlapping columns we can only use <code>merge()</code></p></li>
</ol>
<p>For a comprehensive user guide, please refer to the <a href="https://pandas.pydata.org/docs/user_guide/merging.html">official documentation</a>.</p>
</section>
</section>
<section id="independent-study" class="level2" data-number="14.3">
<h2 data-number="14.3" class="anchored" data-anchor-id="independent-study"><span class="header-section-number">14.3</span> Independent Study</h2>
<section id="practice-exercise-1" class="level3" data-number="14.3.1">
<h3 data-number="14.3.1" class="anchored" data-anchor-id="practice-exercise-1"><span class="header-section-number">14.3.1</span> Practice exercise 1</h3>
<p>You are given the life expectancy data of each continent as a separate *.csv file.</p>
<section id="section" class="level4" data-number="14.3.1.1">
<h4 data-number="14.3.1.1" class="anchored" data-anchor-id="section"><span class="header-section-number">14.3.1.1</span> </h4>
<p>Visualize the change of life expectancy over time for different continents.</p>
</section>
<section id="section-1" class="level4" data-number="14.3.1.2">
<h4 data-number="14.3.1.2" class="anchored" data-anchor-id="section-1"><span class="header-section-number">14.3.1.2</span> </h4>
<p>Appending all the data files, i.e., stacking them on top of each other to form a combined datasets called “data_all_continents”</p>
</section>
</section>
<section id="practice-exercise-2" class="level3" data-number="14.3.2">
<h3 data-number="14.3.2" class="anchored" data-anchor-id="practice-exercise-2"><span class="header-section-number">14.3.2</span> Practice exercise 2</h3>
<section id="preparing-gdp-per-capita-data" class="level4" data-number="14.3.2.1">
<h4 data-number="14.3.2.1" class="anchored" data-anchor-id="preparing-gdp-per-capita-data"><span class="header-section-number">14.3.2.1</span> Preparing GDP per capita data</h4>
<p>Read the GDP per capita data from https://en.wikipedia.org/wiki/List_of_countries_by_GDP_(nominal)_per_capita</p>
<p>Drop all the <code>Year</code> columns. Use the <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.drop.html"><code>drop()</code></a> method with the <code>columns</code>, <code>level</code> and <code>inplace</code> arguments. Print the first 2 rows of the updated DataFrame. If the first row of the DataFrame has missing values for all columns, drop that row as well.</p>
</section>
<section id="section-2" class="level4" data-number="14.3.2.2">
<h4 data-number="14.3.2.2" class="anchored" data-anchor-id="section-2"><span class="header-section-number">14.3.2.2</span> </h4>
<p>Drop the inner level of column labels. Use the <code>droplevel()</code> method. Print the first 2 rows of the updated DataFrame.</p>
</section>
<section id="section-3" class="level4" data-number="14.3.2.3">
<h4 data-number="14.3.2.3" class="anchored" data-anchor-id="section-3"><span class="header-section-number">14.3.2.3</span> </h4>
<p>Convert the columns consisting of GDP per capita by <em>IMF, World Bank</em>, and the <em>United Nations</em> to numeric. Apply a lambda function on these columns to convert them to numeric. Print the number of missing values in each column of the updated DataFrame.</p>
<p>Note: <em>Do not apply the function 3 times. Apply it once on a DataFrame consisting of these 3 columns.</em></p>
</section>
<section id="section-4" class="level4" data-number="14.3.2.4">
<h4 data-number="14.3.2.4" class="anchored" data-anchor-id="section-4"><span class="header-section-number">14.3.2.4</span> </h4>
<p>Apply the lambda function below on all the column names of the dataset obtained in the previous question to clean the column names.</p>
<p><code>import re</code></p>
<p><code>column_name_cleaner = lambda x:re.split(r'\[|/', x)[0]</code></p>
<p><em>Note: You will need to edit the parameter of the function, i.e., <code>x</code> in the above function to make sure it is applied on column names and not columns.</em></p>
<p>Print the first 2 rows of the updated DataFrame.</p>
</section>
<section id="section-5" class="level4" data-number="14.3.2.5">
<h4 data-number="14.3.2.5" class="anchored" data-anchor-id="section-5"><span class="header-section-number">14.3.2.5</span> </h4>
<p>Create a new column <code>GDP_per_capita</code> that copies the GDP per capita values of the <code>United Nations</code>. If the GDP per capita is missing in the <code>United Nations</code> column, then copy it from the <code>World Bank</code> column. If the GDP per capita is missing both in the <code>United Nations</code> and the <code>World Bank</code> columns, then copy it from the <code>IMF</code> column.</p>
<p>Print the number of missing values in the <code>GDP_per_capita</code> column.</p>
</section>
<section id="section-6" class="level4" data-number="14.3.2.6">
<h4 data-number="14.3.2.6" class="anchored" data-anchor-id="section-6"><span class="header-section-number">14.3.2.6</span> </h4>
<p>Drop all the columns except <code>Country</code> and <code>GDP_per_capita</code>. Print the first 2 rows of the updated DataFrame.</p>
</section>
<section id="section-7" class="level4" data-number="14.3.2.7">
<h4 data-number="14.3.2.7" class="anchored" data-anchor-id="section-7"><span class="header-section-number">14.3.2.7</span> </h4>
<p>The country names contain some special characters <em>(characters other than letters)</em> and need to be cleaned. The following function can help clean country names:</p>
<p><code>import re</code></p>
<p><code>country_names_clean_gdp_data = lambda x: re.sub(r'[^\w\s]', '', x).strip()</code></p>
<p>Apply the above lambda function on the country column to clean country names. Save the cleaned dataset as <code>gdp_per_capita_data</code>. Print the first 2 rows of the updated DataFrame.</p>
</section>
<section id="preparing-population-data" class="level4" data-number="14.3.2.8">
<h4 data-number="14.3.2.8" class="anchored" data-anchor-id="preparing-population-data"><span class="header-section-number">14.3.2.8</span> Preparing population data</h4>
<p>Read the population data from https://en.wikipedia.org/wiki/List_of_countries_by_population_(United_Nations).</p>
<ul>
<li>Drop all columns except <code>Country</code>, <code>UN Continental Region[1]</code>, and <code>Population (1 July 2023)</code>.</li>
<li>Drop the first row since it is the total population in the world</li>
</ul>
</section>
<section id="section-8" class="level4" data-number="14.3.2.9">
<h4 data-number="14.3.2.9" class="anchored" data-anchor-id="section-8"><span class="header-section-number">14.3.2.9</span> </h4>
<p>Apply the lambda function below on all the column names of the dataset obtained in the previous question to clean the column names.</p>
<p><code>import re</code></p>
<p><code>column_name_cleaner = lambda x:re.split(r'\[|/|\(| ', x.name)[0]</code></p>
<p><em>Note: You will need to edit the parameter of the function, i.e., <code>x</code> in the above function to make sure it is applied on column names and not columns.</em></p>
<p>Print the first 2 rows of the updated DataFrame.</p>
</section>
<section id="section-9" class="level4" data-number="14.3.2.10">
<h4 data-number="14.3.2.10" class="anchored" data-anchor-id="section-9"><span class="header-section-number">14.3.2.10</span> </h4>
<p>The country names contain some special characters <em>(characters other than letters)</em> and need to be cleaned. The following function can help clean country names:</p>
<p><code>import re</code></p>
<p><code>country_names_clean_population_data = lambda x: re.sub("[\(\[].*?[\)\]]", "", x).strip()</code></p>
<p>Apply the above lambda function on the country column to clean country names. Save the cleaned dataset as <code>population_data</code>.</p>
</section>
<section id="merging-gdp-per-capita-and-population-datasets" class="level4" data-number="14.3.2.11">
<h4 data-number="14.3.2.11" class="anchored" data-anchor-id="merging-gdp-per-capita-and-population-datasets"><span class="header-section-number">14.3.2.11</span> Merging GDP per capita and population datasets</h4>
<p>Merge <code>gdp_per_capita_data</code> with <code>population_data</code> to get the population and GDP per capita of countries in a single dataset. Print the first two rows of the merged DataFrame.</p>
<p>Assume that:</p>
<ol type="1">
<li><p>We want to keep the GDP per capita of all countries in the merged dataset, even if their population in unavailable in the population dataset. For countries whose population in unavailable, their <code>Population</code> column will show <code>NA</code>.</p></li>
<li><p>We want to discard an observation of a country if its GDP per capita is unavailable.</p></li>
</ol>
</section>
<section id="section-10" class="level4" data-number="14.3.2.12">
<h4 data-number="14.3.2.12" class="anchored" data-anchor-id="section-10"><span class="header-section-number">14.3.2.12</span> </h4>
<p>For how many countries in <code>gdp_per_capita_data</code> does the population seem to be unavailable in <code>population_data</code>? Note that you don’t need to clean country names any further than cleaned by the functions provided.</p>
<p>Print the observations of <code>gdp_per_capita_data</code> with missing <code>Population</code>.</p>
</section>
</section>
<section id="merging-datasets-with-similar-values-in-the-key-column" class="level3" data-number="14.3.3">
<h3 data-number="14.3.3" class="anchored" data-anchor-id="merging-datasets-with-similar-values-in-the-key-column"><span class="header-section-number">14.3.3</span> Merging datasets with <em>similar</em> values in the <em>key</em> column</h3>
<p>We suspect that population of more countries may be available in <code>population_data</code>. However, due to unclean country names, the observations could not merge. For example, the country <em>Guinea Bissau</em> is mentioned as <em>GuineaBissau</em> in <code>gdp_per_capita_data</code> and <em>Guinea-Bissau</em> in <code>population_data</code>. To resolve this issue, we’ll use a different approach to merge datasts. We’ll merge the population of a country to an observation in the GDP per capita dataset, whose name in <code>population_data</code> is the most <em>‘similar’</em> to the name of the country in <code>gdp_per_capita_data</code>.</p>
<section id="section-11" class="level4" data-number="14.3.3.1">
<h4 data-number="14.3.3.1" class="anchored" data-anchor-id="section-11"><span class="header-section-number">14.3.3.1</span> </h4>
<p>Proceed as follows:</p>
<ol type="1">
<li><p>For each country in <code>gdp_per_capita_data</code>, find the <code>country</code> with the most <em>‘similar’</em> name in <code>population_data</code>, based on the similarity score. Use the lambda function provided below to compute the similarity score between two strings <em>(The higher the score, the more similar are the strings. The similarity score is <span class="math inline">\(1.0\)</span> if two strings are exactly the same).</em></p></li>
<li><p>Merge the population of the most <em>‘similar’</em> country to the country in <code>gdp_per_capita_data</code>. The merged dataset must include 5 columns - the country name as it appears in <code>gdp_per_capita_data</code>, the GDP per capita, the country name of the most <em>‘similar’</em> country as it appears in <code>population_data</code>, the population of that country, and the similarity score between the country names.</p></li>
<li><p>After creating the merged dataset, <strong>print</strong> the rows of the dataset that have similarity scores less than 1.</p></li>
</ol>
<p>Use the function below to compute the similarity score between the <code>Country</code> names of the two datasets:</p>
<p><code>from difflib import SequenceMatcher</code></p>
<p><code>similar = lambda a,b: SequenceMatcher(None, a, b).ratio()</code></p>
<p><strong>Note: You may use one <code>for</code> loop only for this particular question. However, it would be perfect if don’t use a <code>for</code> loop</strong></p>
<p><strong>Hint:</strong></p>
<ol type="1">
<li><p>Define a function that computes the index of the observation having the most <em>‘similar’</em> country name in <code>population_data</code> for an observation in <code>gdp_per_capita_data</code>. The function returns a Series consisting of the most <em>‘similar’</em> country name, its population, and its similarity score <em>(This function can be written with only one line in its body, excluding the return statement and the definition statement. However, you may use as many lines as you wish)</em>.</p></li>
<li><p>Apply the function on the <code>Country</code> column of <code>gdp_per_capita_data</code>. A DataFrame will be obtained.</p></li>
<li><p>Concatenate the DataFrame obtained in (2) with <code>gdp_per_capita_data</code> with the pandas <code>concat()</code> function.</p></li>
</ol>
</section>
<section id="section-12" class="level4" data-number="14.3.3.2">
<h4 data-number="14.3.3.2" class="anchored" data-anchor-id="section-12"><span class="header-section-number">14.3.3.2</span> </h4>
<p>In the dataset obtained in the previous question, for all observations where similarity score is less than 0.8, replace the population with <code>Nan</code>.</p>
<p>Print the observations of the dataset having missing values of population.</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Data aggregation.html" class="pagination-link" aria-label="Data Grouping and Aggregation">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Data Grouping and Aggregation</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Datasets.html" class="pagination-link" aria-label="Datasets &amp; Templates">
        <span class="nav-page-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Datasets &amp; Templates</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>