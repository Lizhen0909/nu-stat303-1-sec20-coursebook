<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>12&nbsp; Data Grouping and Aggregation – Data Science I with python</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Data wrangling.html" rel="next">
<link href="./Data cleaning and preparation.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-8da5b4427184b79ecddefad3d342027e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Data cleaning and preparation.html">From messy to insight</a></li><li class="breadcrumb-item"><a href="./Data aggregation.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Data Grouping and Aggregation</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="https://statistics.northwestern.edu/" class="sidebar-logo-link">
      <img src="./NU_Stat_logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Science I with python</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Getting started</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./venv_setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Setting up your environment with VS Code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow_enhance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Enhancing Workflow in Jupyter Notebooks</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Python refresher</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Introduction to Python and Jupyter Notebooks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Python Basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_structures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data structures</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Core Library Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./NumPy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">NumPy</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Pandas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Pandas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Reading data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Reading Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_types_in_pandas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">More on Pandas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Data visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Introduction to Data Visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Advanced_Data_Visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Advanced Data Visualization</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">From messy to insight</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Data cleaning and preparation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Data Cleaning and Preparation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Data aggregation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Data Grouping and Aggregation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Data wrangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Data Reshaping and Enrichment</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Datasets &amp; Templates</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#grouping-by-a-single-column" id="toc-grouping-by-a-single-column" class="nav-link active" data-scroll-target="#grouping-by-a-single-column"><span class="header-section-number">12.1</span> Grouping by a single column</a>
  <ul>
  <li><a href="#syntax-of-groupby" id="toc-syntax-of-groupby" class="nav-link" data-scroll-target="#syntax-of-groupby"><span class="header-section-number">12.1.1</span> Syntax of <code>groupby()</code></a></li>
  <li><a href="#attributes-and-methods-of-the-groupby-object" id="toc-attributes-and-methods-of-the-groupby-object" class="nav-link" data-scroll-target="#attributes-and-methods-of-the-groupby-object"><span class="header-section-number">12.1.2</span> Attributes and methods of the <em>GroupBy</em> object</a>
  <ul class="collapse">
  <li><a href="#keys" id="toc-keys" class="nav-link" data-scroll-target="#keys"><span class="header-section-number">12.1.2.1</span> <code>keys</code></a></li>
  <li><a href="#ngroups" id="toc-ngroups" class="nav-link" data-scroll-target="#ngroups"><span class="header-section-number">12.1.2.2</span> <code>ngroups</code></a></li>
  <li><a href="#groups" id="toc-groups" class="nav-link" data-scroll-target="#groups"><span class="header-section-number">12.1.2.3</span> <code>groups</code></a></li>
  <li><a href="#groups.values" id="toc-groups.values" class="nav-link" data-scroll-target="#groups.values"><span class="header-section-number">12.1.2.4</span> <code>groups.values</code></a></li>
  <li><a href="#size" id="toc-size" class="nav-link" data-scroll-target="#size"><span class="header-section-number">12.1.2.5</span> <code>size()</code></a></li>
  <li><a href="#first" id="toc-first" class="nav-link" data-scroll-target="#first"><span class="header-section-number">12.1.2.6</span> <code>first()</code></a></li>
  <li><a href="#get_group" id="toc-get_group" class="nav-link" data-scroll-target="#get_group"><span class="header-section-number">12.1.2.7</span> <code>get_group()</code></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#data-aggregation-within-groups" id="toc-data-aggregation-within-groups" class="nav-link" data-scroll-target="#data-aggregation-within-groups"><span class="header-section-number">12.2</span> Data aggregation within groups</a>
  <ul>
  <li><a href="#common-aggregation-functions" id="toc-common-aggregation-functions" class="nav-link" data-scroll-target="#common-aggregation-functions"><span class="header-section-number">12.2.1</span> Common Aggregation Functions</a></li>
  <li><a href="#multiple-aggregations-and-custom-aggregation-using-agg" id="toc-multiple-aggregations-and-custom-aggregation-using-agg" class="nav-link" data-scroll-target="#multiple-aggregations-and-custom-aggregation-using-agg"><span class="header-section-number">12.2.2</span> Multiple aggregations and Custom aggregation using <code>agg()</code></a>
  <ul class="collapse">
  <li><a href="#multiple-aggregations" id="toc-multiple-aggregations" class="nav-link" data-scroll-target="#multiple-aggregations"><span class="header-section-number">12.2.2.1</span> Multiple aggregations</a></li>
  <li><a href="#custom-aggregation" id="toc-custom-aggregation" class="nav-link" data-scroll-target="#custom-aggregation"><span class="header-section-number">12.2.2.2</span> Custom aggregation</a></li>
  </ul></li>
  <li><a href="#multiple-aggregate-functions-on-multiple-columns" id="toc-multiple-aggregate-functions-on-multiple-columns" class="nav-link" data-scroll-target="#multiple-aggregate-functions-on-multiple-columns"><span class="header-section-number">12.2.3</span> Multiple aggregate functions on multiple columns</a></li>
  <li><a href="#distinct-aggregate-functions-on-multiple-columns" id="toc-distinct-aggregate-functions-on-multiple-columns" class="nav-link" data-scroll-target="#distinct-aggregate-functions-on-multiple-columns"><span class="header-section-number">12.2.4</span> Distinct aggregate functions on multiple columns</a></li>
  </ul></li>
  <li><a href="#grouping-by-multiple-columns" id="toc-grouping-by-multiple-columns" class="nav-link" data-scroll-target="#grouping-by-multiple-columns"><span class="header-section-number">12.3</span> Grouping by Multiple Columns</a>
  <ul>
  <li><a href="#basic-syntax-for-grouping-by-multiple-columns" id="toc-basic-syntax-for-grouping-by-multiple-columns" class="nav-link" data-scroll-target="#basic-syntax-for-grouping-by-multiple-columns"><span class="header-section-number">12.3.1</span> Basic Syntax for Grouping by Multiple Columns</a></li>
  <li><a href="#understanding-hierarchical-multi-level-indexing" id="toc-understanding-hierarchical-multi-level-indexing" class="nav-link" data-scroll-target="#understanding-hierarchical-multi-level-indexing"><span class="header-section-number">12.3.2</span> Understanding Hierarchical (Multi-Level) Indexing</a></li>
  <li><a href="#subsetting-data-in-a-hierarchical-index" id="toc-subsetting-data-in-a-hierarchical-index" class="nav-link" data-scroll-target="#subsetting-data-in-a-hierarchical-index"><span class="header-section-number">12.3.3</span> Subsetting Data in a Hierarchical Index</a></li>
  <li><a href="#grouping-by-multiple-columns-and-aggregating-multiple-variables" id="toc-grouping-by-multiple-columns-and-aggregating-multiple-variables" class="nav-link" data-scroll-target="#grouping-by-multiple-columns-and-aggregating-multiple-variables"><span class="header-section-number">12.3.4</span> Grouping by multiple columns and aggregating multiple variables</a></li>
  </ul></li>
  <li><a href="#advanced-operations-within-groups-apply-transform-and-filter" id="toc-advanced-operations-within-groups-apply-transform-and-filter" class="nav-link" data-scroll-target="#advanced-operations-within-groups-apply-transform-and-filter"><span class="header-section-number">12.4</span> Advanced Operations within groups: <code>apply()</code>, <code>transform()</code>, and <code>filter()</code></a>
  <ul>
  <li><a href="#using-apply-on-groups" id="toc-using-apply-on-groups" class="nav-link" data-scroll-target="#using-apply-on-groups"><span class="header-section-number">12.4.1</span> Using <code>apply()</code> on groups</a></li>
  <li><a href="#using-transform-on-groups" id="toc-using-transform-on-groups" class="nav-link" data-scroll-target="#using-transform-on-groups"><span class="header-section-number">12.4.2</span> Using <code>transform()</code> on Groups</a>
  <ul class="collapse">
  <li><a href="#behavior-of-groupby.apply-vs.-groupby.transform" id="toc-behavior-of-groupby.apply-vs.-groupby.transform" class="nav-link" data-scroll-target="#behavior-of-groupby.apply-vs.-groupby.transform"><span class="header-section-number">12.4.2.1</span> Behavior of <code>groupby().apply()</code> vs.&nbsp;<code>groupby().transform()</code></a></li>
  <li><a href="#why-transform-works-for-imputation" id="toc-why-transform-works-for-imputation" class="nav-link" data-scroll-target="#why-transform-works-for-imputation"><span class="header-section-number">12.4.2.2</span> Why <code>transform()</code> Works for Imputation</a></li>
  </ul></li>
  <li><a href="#using-filter-on-groups" id="toc-using-filter-on-groups" class="nav-link" data-scroll-target="#using-filter-on-groups"><span class="header-section-number">12.4.3</span> Using <code>filter()</code> on Groups</a></li>
  </ul></li>
  <li><a href="#sampling-data-by-group" id="toc-sampling-data-by-group" class="nav-link" data-scroll-target="#sampling-data-by-group"><span class="header-section-number">12.5</span> Sampling data by group</a></li>
  <li><a href="#corr-correlation-by-group" id="toc-corr-correlation-by-group" class="nav-link" data-scroll-target="#corr-correlation-by-group"><span class="header-section-number">12.6</span> <code>corr()</code>: Correlation by group</a></li>
  <li><a href="#pivot_table" id="toc-pivot_table" class="nav-link" data-scroll-target="#pivot_table"><span class="header-section-number">12.7</span> <code>pivot_table()</code></a></li>
  <li><a href="#crosstab" id="toc-crosstab" class="nav-link" data-scroll-target="#crosstab"><span class="header-section-number">12.8</span> <code>crosstab()</code></a>
  <ul>
  <li><a href="#basic-usage-of-crosstab" id="toc-basic-usage-of-crosstab" class="nav-link" data-scroll-target="#basic-usage-of-crosstab"><span class="header-section-number">12.8.1</span> Basic Usage of <code>crosstab()</code></a></li>
  <li><a href="#using-crosstab-with-aggregation-functions" id="toc-using-crosstab-with-aggregation-functions" class="nav-link" data-scroll-target="#using-crosstab-with-aggregation-functions"><span class="header-section-number">12.8.2</span> Using <code>crosstab()</code> with Aggregation Functions</a></li>
  </ul></li>
  <li><a href="#independent-study" id="toc-independent-study" class="nav-link" data-scroll-target="#independent-study"><span class="header-section-number">12.9</span> Independent Study</a>
  <ul>
  <li><a href="#practice-exercise-1" id="toc-practice-exercise-1" class="nav-link" data-scroll-target="#practice-exercise-1"><span class="header-section-number">12.9.1</span> Practice exercise 1</a></li>
  <li><a href="#practice-exercise-2" id="toc-practice-exercise-2" class="nav-link" data-scroll-target="#practice-exercise-2"><span class="header-section-number">12.9.2</span> Practice exercise 2</a>
  <ul class="collapse">
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"><span class="header-section-number">12.9.2.1</span> </a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1"><span class="header-section-number">12.9.2.2</span> </a></li>
  <li><a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2"><span class="header-section-number">12.9.2.3</span> </a></li>
  <li><a href="#section-3" id="toc-section-3" class="nav-link" data-scroll-target="#section-3"><span class="header-section-number">12.9.2.4</span> </a></li>
  <li><a href="#section-4" id="toc-section-4" class="nav-link" data-scroll-target="#section-4"><span class="header-section-number">12.9.2.5</span> </a></li>
  <li><a href="#section-5" id="toc-section-5" class="nav-link" data-scroll-target="#section-5"><span class="header-section-number">12.9.2.6</span> </a></li>
  <li><a href="#section-6" id="toc-section-6" class="nav-link" data-scroll-target="#section-6"><span class="header-section-number">12.9.2.7</span> </a></li>
  <li><a href="#section-7" id="toc-section-7" class="nav-link" data-scroll-target="#section-7"><span class="header-section-number">12.9.2.8</span> </a></li>
  <li><a href="#section-8" id="toc-section-8" class="nav-link" data-scroll-target="#section-8"><span class="header-section-number">12.9.2.9</span> </a></li>
  <li><a href="#section-9" id="toc-section-9" class="nav-link" data-scroll-target="#section-9"><span class="header-section-number">12.9.2.10</span> </a></li>
  <li><a href="#section-10" id="toc-section-10" class="nav-link" data-scroll-target="#section-10"><span class="header-section-number">12.9.2.11</span> </a></li>
  <li><a href="#section-11" id="toc-section-11" class="nav-link" data-scroll-target="#section-11"><span class="header-section-number">12.9.2.12</span> </a></li>
  <li><a href="#section-12" id="toc-section-12" class="nav-link" data-scroll-target="#section-12"><span class="header-section-number">12.9.2.13</span> </a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Data cleaning and preparation.html">From messy to insight</a></li><li class="breadcrumb-item"><a href="./Data aggregation.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Data Grouping and Aggregation</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Data Grouping and Aggregation</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Grouping and aggregation are essential in data science because they enable meaningful analysis and insights from complex and large-scale datasets. Here are key reasons why they are important:</p>
<ul>
<li><strong>Data Summarization:</strong> Grouping allows you to condense large amounts of data into concise summaries. Aggregation provides statistical summaries (e.g., mean, sum, count), making it easier to understand data trends and characteristics without needing to examine every detail.</li>
<li><strong>Insights Across Categories:</strong> Grouping by categories, like regions, demographics, or time periods, lets you analyze patterns within each group. For example, aggregating sales data by region can reveal which areas are performing better, or grouping customer data by age group can highlight consumer trends.</li>
<li><strong>Time Series Analysis:</strong> In time-series data, grouping by time intervals (e.g., day, month, quarter) allows you to observe trends over time, which can be crucial for forecasting, seasonal analysis, and trend detection.</li>
<li><strong>Reducing Data Complexity:</strong> By summarizing data at a higher level, you reduce complexity, making it easier to visualize and interpret, especially in large datasets where working with raw data could be overwhelming.</li>
</ul>
<p>In this chapter, we are going to see grouping and aggregating using pandas. Grouping and aggregating will help to achieve data analysis easily using various functions. These methods will help us to the group and summarize our data and make complex analysis comparatively easy.</p>
<p>Througout this chapter, we will use <em>gdp_lifeExpectancy.csv</em>, let’s read the csv file to pandas dataframe first</p>
<div id="cell-2" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-3" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_data <span class="op">=</span> pd.read_csv(<span class="st">'./Datasets/gdp_lifeExpectancy.csv'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">lifeExp</th>
<th data-quarto-table-cell-role="th">pop</th>
<th data-quarto-table-cell-role="th">gdpPercap</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Afghanistan</td>
<td>Asia</td>
<td>1952</td>
<td>28.801</td>
<td>8425333</td>
<td>779.445314</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Afghanistan</td>
<td>Asia</td>
<td>1957</td>
<td>30.332</td>
<td>9240934</td>
<td>820.853030</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Afghanistan</td>
<td>Asia</td>
<td>1962</td>
<td>31.997</td>
<td>10267083</td>
<td>853.100710</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Afghanistan</td>
<td>Asia</td>
<td>1967</td>
<td>34.020</td>
<td>11537966</td>
<td>836.197138</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Afghanistan</td>
<td>Asia</td>
<td>1972</td>
<td>36.088</td>
<td>13079460</td>
<td>739.981106</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="grouping-by-a-single-column" class="level2" data-number="12.1">
<h2 data-number="12.1" class="anchored" data-anchor-id="grouping-by-a-single-column"><span class="header-section-number">12.1</span> Grouping by a single column</h2>
<p><code>groupby()</code> allows you to split a DataFrame based on the values in one or more columns. First, we’ll explore grouping by a single column.</p>
<section id="syntax-of-groupby" class="level3" data-number="12.1.1">
<h3 data-number="12.1.1" class="anchored" data-anchor-id="syntax-of-groupby"><span class="header-section-number">12.1.1</span> Syntax of <code>groupby()</code></h3>
<ul>
<li><code>DataFrame.groupby(by="column_name")</code> – Groups data by the specified column.</li>
</ul>
<p>Consider the life expectancy dataset. suppose we want to group by the observations by <code>continent</code> by passing it as an argument to the <code>groupby()</code> method.</p>
<div id="cell-5" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating a GroupBy object</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>grouped <span class="op">=</span> gdp_lifeExp_data.groupby(<span class="st">'continent'</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#This will split the data into groups that correspond to values of the column 'continent'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>groupby()</code> method returns a GroupBy object.</p>
<div id="cell-7" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#A 'GroupBy' objects is created with the `groupby()` function</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(grouped)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>pandas.core.groupby.generic.DataFrameGroupBy</code></pre>
</div>
</div>
<p>The GroupBy object <code>grouped</code> contains the information of the groups in which the data is distributed. Each observation has been assigned to a specific group of the column(s) used to group the data. However, note that the dataset is not physically split into different DataFrames. For example, in the above case, each observation is assigned to a particular group depending on the value of the <code>continent</code> for that observation. However, all the observations are still in the same DataFrame <code>data</code>.</p>
</section>
<section id="attributes-and-methods-of-the-groupby-object" class="level3" data-number="12.1.2">
<h3 data-number="12.1.2" class="anchored" data-anchor-id="attributes-and-methods-of-the-groupby-object"><span class="header-section-number">12.1.2</span> Attributes and methods of the <a href="https://pandas.pydata.org/docs/reference/groupby.html"><em>GroupBy</em></a> object</h3>
<section id="keys" class="level4" data-number="12.1.2.1">
<h4 data-number="12.1.2.1" class="anchored" data-anchor-id="keys"><span class="header-section-number">12.1.2.1</span> <code>keys</code></h4>
<p>The object(s) grouping the data are called <em>key(s)</em>. Here <code>continent</code> is the group key. The keys of the <em>GroupBy</em> object can be seen using Its <code>keys</code> attribute.</p>
<div id="cell-11" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Key(s) of the GroupBy object</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>grouped.keys</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>'continent'</code></pre>
</div>
</div>
</section>
<section id="ngroups" class="level4" data-number="12.1.2.2">
<h4 data-number="12.1.2.2" class="anchored" data-anchor-id="ngroups"><span class="header-section-number">12.1.2.2</span> <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.core.groupby.GroupBy.ngroup.html"><code>ngroups</code></a></h4>
<p>The number of groups in which the data is distributed based on the keys can be seen with the <code>ngroups</code> attribute.</p>
<div id="cell-13" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#The number of groups based on the key(s)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>grouped.ngroups</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>5</code></pre>
</div>
</div>
<p>The group names are the <em>keys</em> of the dictionary, while the row labels are the corresponding <em>values</em></p>
<div id="cell-15" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Group names</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>grouped.groups.keys()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>dict_keys(['Africa', 'Americas', 'Asia', 'Europe', 'Oceania'])</code></pre>
</div>
</div>
</section>
<section id="groups" class="level4" data-number="12.1.2.3">
<h4 data-number="12.1.2.3" class="anchored" data-anchor-id="groups"><span class="header-section-number">12.1.2.3</span> <a href="https://pandas.pydata.org/docs/reference/api/pandas.core.groupby.GroupBy.groups.html"><code>groups</code></a></h4>
<p>The <code>groups</code> attribute of the <em>GroupBy</em> object contains the group labels (or names) and the row labels of the observations in each group, as a dictionary.</p>
<div id="cell-17" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#The groups (in the dictionary format)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>grouped.groups</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>{'Africa': [24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 156, 157, 158, 159, 160, 161, 162, 163, 164, 165, 166, 167, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 207, 208, 209, 210, 211, 212, 213, 214, 215, 228, 229, 230, 231, 232, 233, 234, 235, 236, 237, 238, 239, 252, 253, 254, 255, 256, 257, 258, 259, 260, 261, 262, 263, 264, 265, 266, 267, ...], 'Americas': [48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179, 240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250, 251, 276, 277, 278, 279, 280, 281, 282, 283, 284, 285, 286, 287, 300, 301, 302, 303, 304, 305, 306, 307, 308, 309, 310, 311, 348, 349, 350, 351, 352, 353, 354, 355, 356, 357, 358, 359, 384, 385, 386, 387, 388, 389, 390, 391, 392, 393, 394, 395, 432, 433, 434, 435, ...], 'Asia': [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 216, 217, 218, 219, 220, 221, 222, 223, 224, 225, 226, 227, 288, 289, 290, 291, 292, 293, 294, 295, 296, 297, 298, 299, 660, 661, 662, 663, 664, 665, 666, 667, 668, 669, 670, 671, 696, 697, 698, 699, 700, 701, 702, 703, 704, 705, 706, 707, 708, 709, 710, 711, 712, 713, 714, 715, 716, 717, 718, 719, 720, 721, 722, 723, ...], 'Europe': [12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 180, 181, 182, 183, 184, 185, 186, 187, 188, 189, 190, 191, 372, 373, 374, 375, 376, 377, 378, 379, 380, 381, 382, 383, 396, 397, 398, 399, 400, 401, 402, 403, 404, 405, 406, 407, 408, 409, 410, 411, 412, 413, 414, 415, 416, 417, 418, 419, 516, 517, 518, 519, ...], 'Oceania': [60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 1092, 1093, 1094, 1095, 1096, 1097, 1098, 1099, 1100, 1101, 1102, 1103]}</code></pre>
</div>
</div>
</section>
<section id="groups.values" class="level4" data-number="12.1.2.4">
<h4 data-number="12.1.2.4" class="anchored" data-anchor-id="groups.values"><span class="header-section-number">12.1.2.4</span> <code>groups.values</code></h4>
<p>The <code>groups.values</code> attribute of the <em>GroupBy</em> object contains the row labels of the observations in each group, as a dictionary.</p>
<div id="cell-19" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Group values are the row labels corresponding to a particular group</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>grouped.groups.values()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>dict_values([Index([  24,   25,   26,   27,   28,   29,   30,   31,   32,   33,
       ...
       1694, 1695, 1696, 1697, 1698, 1699, 1700, 1701, 1702, 1703],
      dtype='int64', length=624), Index([  48,   49,   50,   51,   52,   53,   54,   55,   56,   57,
       ...
       1634, 1635, 1636, 1637, 1638, 1639, 1640, 1641, 1642, 1643],
      dtype='int64', length=300), Index([   0,    1,    2,    3,    4,    5,    6,    7,    8,    9,
       ...
       1670, 1671, 1672, 1673, 1674, 1675, 1676, 1677, 1678, 1679],
      dtype='int64', length=396), Index([  12,   13,   14,   15,   16,   17,   18,   19,   20,   21,
       ...
       1598, 1599, 1600, 1601, 1602, 1603, 1604, 1605, 1606, 1607],
      dtype='int64', length=360), Index([  60,   61,   62,   63,   64,   65,   66,   67,   68,   69,   70,   71,
       1092, 1093, 1094, 1095, 1096, 1097, 1098, 1099, 1100, 1101, 1102, 1103],
      dtype='int64')])</code></pre>
</div>
</div>
</section>
<section id="size" class="level4" data-number="12.1.2.5">
<h4 data-number="12.1.2.5" class="anchored" data-anchor-id="size"><span class="header-section-number">12.1.2.5</span> <a href="https://pandas.pydata.org/docs/reference/api/pandas.core.groupby.GroupBy.size.html"><code>size()</code></a></h4>
<p>The <code>size()</code> method of the <em>GroupBy</em> object returns the number of observations in each group.</p>
<div id="cell-21" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Number of observations in each group</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>grouped.size()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>continent
Africa      624
Americas    300
Asia        396
Europe      360
Oceania      24
dtype: int64</code></pre>
</div>
</div>
</section>
<section id="first" class="level4" data-number="12.1.2.6">
<h4 data-number="12.1.2.6" class="anchored" data-anchor-id="first"><span class="header-section-number">12.1.2.6</span> <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.core.groupby.GroupBy.first.html"><code>first()</code></a></h4>
<p>The first non missing element of each group is returned with the <code>first()</code> method of the <em>GroupBy</em> object.</p>
<div id="cell-23" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#The first element of the group can be printed using the first() method</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>grouped.first()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">lifeExp</th>
<th data-quarto-table-cell-role="th">pop</th>
<th data-quarto-table-cell-role="th">gdpPercap</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Africa</td>
<td>Algeria</td>
<td>1952</td>
<td>43.077</td>
<td>9279525</td>
<td>2449.008185</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Americas</td>
<td>Argentina</td>
<td>1952</td>
<td>62.485</td>
<td>17876956</td>
<td>5911.315053</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Asia</td>
<td>Afghanistan</td>
<td>1952</td>
<td>28.801</td>
<td>8425333</td>
<td>779.445314</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Europe</td>
<td>Albania</td>
<td>1952</td>
<td>55.230</td>
<td>1282697</td>
<td>1601.056136</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Oceania</td>
<td>Australia</td>
<td>1952</td>
<td>69.120</td>
<td>8691212</td>
<td>10039.595640</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="get_group" class="level4" data-number="12.1.2.7">
<h4 data-number="12.1.2.7" class="anchored" data-anchor-id="get_group"><span class="header-section-number">12.1.2.7</span> <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.core.groupby.GroupBy.get_group.html"><code>get_group()</code></a></h4>
<p>This method returns the observations for a particular group of the <em>GroupBy</em> object.</p>
<div id="cell-25" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Observations for individual groups can be obtained using the get_group() function</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>grouped.get_group(<span class="st">'Asia'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">lifeExp</th>
<th data-quarto-table-cell-role="th">pop</th>
<th data-quarto-table-cell-role="th">gdpPercap</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Afghanistan</td>
<td>Asia</td>
<td>1952</td>
<td>28.801</td>
<td>8425333</td>
<td>779.445314</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Afghanistan</td>
<td>Asia</td>
<td>1957</td>
<td>30.332</td>
<td>9240934</td>
<td>820.853030</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Afghanistan</td>
<td>Asia</td>
<td>1962</td>
<td>31.997</td>
<td>10267083</td>
<td>853.100710</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Afghanistan</td>
<td>Asia</td>
<td>1967</td>
<td>34.020</td>
<td>11537966</td>
<td>836.197138</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Afghanistan</td>
<td>Asia</td>
<td>1972</td>
<td>36.088</td>
<td>13079460</td>
<td>739.981106</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1675</td>
<td>Yemen, Rep.</td>
<td>Asia</td>
<td>1987</td>
<td>52.922</td>
<td>11219340</td>
<td>1971.741538</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1676</td>
<td>Yemen, Rep.</td>
<td>Asia</td>
<td>1992</td>
<td>55.599</td>
<td>13367997</td>
<td>1879.496673</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1677</td>
<td>Yemen, Rep.</td>
<td>Asia</td>
<td>1997</td>
<td>58.020</td>
<td>15826497</td>
<td>2117.484526</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1678</td>
<td>Yemen, Rep.</td>
<td>Asia</td>
<td>2002</td>
<td>60.308</td>
<td>18701257</td>
<td>2234.820827</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1679</td>
<td>Yemen, Rep.</td>
<td>Asia</td>
<td>2007</td>
<td>62.698</td>
<td>22211743</td>
<td>2280.769906</td>
</tr>
</tbody>
</table>

<p>396 rows × 6 columns</p>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="data-aggregation-within-groups" class="level2" data-number="12.2">
<h2 data-number="12.2" class="anchored" data-anchor-id="data-aggregation-within-groups"><span class="header-section-number">12.2</span> Data aggregation within groups</h2>
<section id="common-aggregation-functions" class="level3" data-number="12.2.1">
<h3 data-number="12.2.1" class="anchored" data-anchor-id="common-aggregation-functions"><span class="header-section-number">12.2.1</span> Common Aggregation Functions</h3>
<p>Aggregation functions are essential for summarizing and analyzing data in pandas. These functions allow you to compute summary statistics for your data, making it easier to identify trends and patterns.</p>
<p>Below are some of the most commonly used aggregation functions when working with grouped data in pandas:</p>
<ul>
<li><strong><code>mean()</code></strong> – Calculates the <strong>average</strong> value of the group.</li>
<li><strong><code>sum()</code></strong> – Computes the <strong>total</strong> value by summing all elements in the group.</li>
<li><strong><code>min()</code></strong> – Finds the <strong>minimum</strong> value in the group.</li>
<li><strong><code>max()</code></strong> – Finds the <strong>maximum</strong> value in the group.</li>
<li><strong><code>count()</code></strong> – Returns the <strong>number of occurrences</strong> or entries in the group.</li>
<li><strong><code>median()</code></strong> – Finds the <strong>middle value</strong> in the sorted group.</li>
<li><strong><code>std()</code></strong> – Calculates the <strong>standard deviation</strong>, measuring the spread or variation in the values of the group.</li>
</ul>
<p>Each of these functions can help summarize and provide insights into different aspects of the grouped data.</p>
<p>Consider the life expectancy dataset, let’s find the mean life expectancy, population and GDP per capita for each country during the period of 1952 -2007.</p>
<p>Next, we’ll find the mean statistics for each group with the <code>mean()</code> method. The method will be applied on all columns of the DataFrame and all groups.</p>
<div id="cell-28" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Grouping the observations by 'country'</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>grouped_country <span class="op">=</span> gdp_lifeExp_data.drop ([<span class="st">'continent'</span>, <span class="st">'year'</span>], axis <span class="op">=</span> <span class="dv">1</span>).groupby(<span class="st">'country'</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Finding the mean stastistic of all columns of the DataFrame and all groups</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>grouped_country.mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">lifeExp</th>
<th data-quarto-table-cell-role="th">pop</th>
<th data-quarto-table-cell-role="th">gdpPercap</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Afghanistan</td>
<td>37.478833</td>
<td>1.582372e+07</td>
<td>802.674598</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Albania</td>
<td>68.432917</td>
<td>2.580249e+06</td>
<td>3255.366633</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Algeria</td>
<td>59.030167</td>
<td>1.987541e+07</td>
<td>4426.025973</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Angola</td>
<td>37.883500</td>
<td>7.309390e+06</td>
<td>3607.100529</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Argentina</td>
<td>69.060417</td>
<td>2.860224e+07</td>
<td>8955.553783</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Vietnam</td>
<td>57.479500</td>
<td>5.456857e+07</td>
<td>1017.712615</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">West Bank and Gaza</td>
<td>60.328667</td>
<td>1.848606e+06</td>
<td>3759.996781</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Yemen, Rep.</td>
<td>46.780417</td>
<td>1.084319e+07</td>
<td>1569.274672</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Zambia</td>
<td>45.996333</td>
<td>6.353805e+06</td>
<td>1358.199409</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Zimbabwe</td>
<td>52.663167</td>
<td>7.641966e+06</td>
<td>635.858042</td>
</tr>
</tbody>
</table>

<p>142 rows × 3 columns</p>
</div>
</div>
</div>
<p>Next, we’ll find the standard deviation statistics for each group with the <code>std()</code> method.</p>
<div id="cell-30" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>grouped_country.std()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">lifeExp</th>
<th data-quarto-table-cell-role="th">pop</th>
<th data-quarto-table-cell-role="th">gdpPercap</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Afghanistan</td>
<td>5.098646</td>
<td>7.114583e+06</td>
<td>108.202929</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Albania</td>
<td>6.322911</td>
<td>8.285855e+05</td>
<td>1192.351513</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Algeria</td>
<td>10.340069</td>
<td>8.613355e+06</td>
<td>1310.337656</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Angola</td>
<td>4.005276</td>
<td>2.672281e+06</td>
<td>1165.900251</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Argentina</td>
<td>4.186470</td>
<td>7.546609e+06</td>
<td>1862.583151</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Vietnam</td>
<td>12.172331</td>
<td>2.052585e+07</td>
<td>567.482251</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">West Bank and Gaza</td>
<td>11.000069</td>
<td>1.023057e+06</td>
<td>1716.840614</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Yemen, Rep.</td>
<td>11.019302</td>
<td>5.590408e+06</td>
<td>609.939160</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Zambia</td>
<td>4.453246</td>
<td>3.096949e+06</td>
<td>247.494984</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Zimbabwe</td>
<td>7.071816</td>
<td>3.376895e+06</td>
<td>133.689213</td>
</tr>
</tbody>
</table>

<p>142 rows × 3 columns</p>
</div>
</div>
</div>
<p>Alternatively, you can compute other statistical metrics.</p>
</section>
<section id="multiple-aggregations-and-custom-aggregation-using-agg" class="level3" data-number="12.2.2">
<h3 data-number="12.2.2" class="anchored" data-anchor-id="multiple-aggregations-and-custom-aggregation-using-agg"><span class="header-section-number">12.2.2</span> Multiple aggregations and Custom aggregation using <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.agg.html"><code>agg()</code></a></h3>
<section id="multiple-aggregations" class="level4" data-number="12.2.2.1">
<h4 data-number="12.2.2.1" class="anchored" data-anchor-id="multiple-aggregations"><span class="header-section-number">12.2.2.1</span> Multiple aggregations</h4>
<p>Directly applying the aggregate methods of the <em>GroupBy</em> object such as mean, count, etc., lets us apply only one function at a time. Also, we may wish to apply an aggregate function of our own, which is not there in the set of methods of the <em>GroupBy</em> object, such as the range of values of a column.</p>
<p>The <code>agg()</code> function of a <em>GroupBy</em> object lets us aggregate data using:</p>
<ol type="1">
<li><p>Multiple aggregation functions</p></li>
<li><p>Custom aggregate functions (in addition to in-built functions like mean, std, count etc.)</p></li>
</ol>
<p>Consider the life expectancy dataset, Let us use the agg() method of the GroupBy object to simultaneously find the mean and standard deviation of the <em>gdpPercap</em> for each country.</p>
<p>For aggregating by multiple functions, we pass a list of strings to agg(), where the strings are the function names.</p>
<div id="cell-35" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>grouped_country[<span class="st">'gdpPercap'</span>].agg([<span class="st">'mean'</span>,<span class="st">'std'</span>]).sort_values(by <span class="op">=</span> <span class="st">'mean'</span>,ascending <span class="op">=</span> <span class="va">False</span>).head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Kuwait</td>
<td>65332.910472</td>
<td>33882.139536</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Switzerland</td>
<td>27074.334405</td>
<td>6886.463308</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Norway</td>
<td>26747.306554</td>
<td>13421.947245</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">United States</td>
<td>26261.151347</td>
<td>9695.058103</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Canada</td>
<td>22410.746340</td>
<td>8210.112789</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="custom-aggregation" class="level4" data-number="12.2.2.2">
<h4 data-number="12.2.2.2" class="anchored" data-anchor-id="custom-aggregation"><span class="header-section-number">12.2.2.2</span> Custom aggregation</h4>
<p>In addition to the mean and standard deviation of the gdpPercap of each country, let us also include the range of gdpPercap in the table above using lambda function</p>
<div id="cell-37" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>grouped_country[<span class="st">'gdpPercap'</span>].agg(<span class="kw">lambda</span> x: x.<span class="bu">max</span>() <span class="op">-</span> x.<span class="bu">min</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>country
Afghanistan            342.670088
Albania               4335.973390
Algeria               3774.359280
Angola                3245.635491
Argentina             6868.064587
                         ...     
Vietnam               1836.509912
West Bank and Gaza    5595.075290
Yemen, Rep.           1499.052330
Zambia                 705.723500
Zimbabwe               392.478061
Name: gdpPercap, Length: 142, dtype: float64</code></pre>
</div>
</div>
<div id="cell-38" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define a function that calculates the range</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> range_func(x):</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x.<span class="bu">max</span>() <span class="op">-</span> x.<span class="bu">min</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-39" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># apply the range function to the 'gdpPercap' column besides the mean and standard deviation</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>grouped_country[<span class="st">'gdpPercap'</span>].agg([<span class="st">'mean'</span>, <span class="st">'std'</span>, range_func]).sort_values(by <span class="op">=</span> <span class="st">'range_func'</span>, ascending <span class="op">=</span> <span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">range_func</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Kuwait</td>
<td>65332.910472</td>
<td>33882.139536</td>
<td>85404.702920</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Singapore</td>
<td>17425.382267</td>
<td>14926.147774</td>
<td>44828.041413</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Norway</td>
<td>26747.306554</td>
<td>13421.947245</td>
<td>39261.768450</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Hong Kong, China</td>
<td>16228.700865</td>
<td>12207.329731</td>
<td>36670.557461</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Ireland</td>
<td>15758.606238</td>
<td>11573.311022</td>
<td>35465.716022</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Rwanda</td>
<td>675.669043</td>
<td>142.229906</td>
<td>388.246772</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Senegal</td>
<td>1533.121694</td>
<td>105.399353</td>
<td>344.572767</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Afghanistan</td>
<td>802.674598</td>
<td>108.202929</td>
<td>342.670088</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Ethiopia</td>
<td>509.115155</td>
<td>96.427627</td>
<td>328.659296</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Burundi</td>
<td>471.662990</td>
<td>99.329720</td>
<td>292.403419</td>
</tr>
</tbody>
</table>

<p>142 rows × 3 columns</p>
</div>
</div>
</div>
<p>For aggregating by multiple functions &amp; changing the column names resulting from those functions, we pass a list of tuples to <code>agg()</code>, where each tuple is of length two, and contains the new column name &amp; the function to be applied.</p>
<div id="cell-41" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Simultaneous renaming of columns while grouping</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>grouped_country[<span class="st">'gdpPercap'</span>].agg([(<span class="st">'Average'</span>,<span class="st">'mean'</span>),(<span class="st">'Standard Deviation'</span>,<span class="st">'std'</span>),(<span class="st">'90th Percentile'</span>,<span class="kw">lambda</span> x:x.quantile(<span class="fl">0.9</span>))]).sort_values(by <span class="op">=</span> <span class="st">'90th Percentile'</span>,ascending <span class="op">=</span> <span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Average</th>
<th data-quarto-table-cell-role="th">Standard Deviation</th>
<th data-quarto-table-cell-role="th">90th Percentile</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Kuwait</td>
<td>65332.910472</td>
<td>33882.139536</td>
<td>109251.315590</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Norway</td>
<td>26747.306554</td>
<td>13421.947245</td>
<td>44343.894158</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">United States</td>
<td>26261.151347</td>
<td>9695.058103</td>
<td>38764.132898</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Singapore</td>
<td>17425.382267</td>
<td>14926.147774</td>
<td>35772.742520</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Switzerland</td>
<td>27074.334405</td>
<td>6886.463308</td>
<td>34246.394240</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Liberia</td>
<td>604.814141</td>
<td>98.988329</td>
<td>706.275527</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Malawi</td>
<td>575.447212</td>
<td>122.999953</td>
<td>689.590541</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Burundi</td>
<td>471.662990</td>
<td>99.329720</td>
<td>615.597260</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Myanmar</td>
<td>439.333333</td>
<td>175.401531</td>
<td>592.300000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Ethiopia</td>
<td>509.115155</td>
<td>96.427627</td>
<td>577.448804</td>
</tr>
</tbody>
</table>

<p>142 rows × 3 columns</p>
</div>
</div>
</div>
</section>
</section>
<section id="multiple-aggregate-functions-on-multiple-columns" class="level3" data-number="12.2.3">
<h3 data-number="12.2.3" class="anchored" data-anchor-id="multiple-aggregate-functions-on-multiple-columns"><span class="header-section-number">12.2.3</span> Multiple aggregate functions on multiple columns</h3>
<p>Let us find the mean and standard deviation of lifeExp and pop for each country</p>
<div id="cell-43" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># find the meand and standard deviation of the 'lifeExp' and 'pop' column for each country</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>grouped_country[[<span class="st">'lifeExp'</span>, <span class="st">'pop'</span>]].agg([<span class="st">'mean'</span>, <span class="st">'std'</span>]).sort_values(by <span class="op">=</span> (<span class="st">'lifeExp'</span>, <span class="st">'mean'</span>), ascending <span class="op">=</span> <span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">lifeExp</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">pop</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
</tr>
<tr class="header">
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Iceland</td>
<td>76.511417</td>
<td>3.026593</td>
<td>2.269781e+05</td>
<td>4.854168e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Sweden</td>
<td>76.177000</td>
<td>3.003990</td>
<td>8.220029e+06</td>
<td>6.365660e+05</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Norway</td>
<td>75.843000</td>
<td>2.423994</td>
<td>4.031441e+06</td>
<td>4.107955e+05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Netherlands</td>
<td>75.648500</td>
<td>2.486363</td>
<td>1.378680e+07</td>
<td>2.005631e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Switzerland</td>
<td>75.565083</td>
<td>4.011572</td>
<td>6.384293e+06</td>
<td>8.582009e+05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Mozambique</td>
<td>40.379500</td>
<td>4.599184</td>
<td>1.204670e+07</td>
<td>4.457509e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Guinea-Bissau</td>
<td>39.210250</td>
<td>4.937369</td>
<td>8.820084e+05</td>
<td>3.132917e+05</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Angola</td>
<td>37.883500</td>
<td>4.005276</td>
<td>7.309390e+06</td>
<td>2.672281e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Afghanistan</td>
<td>37.478833</td>
<td>5.098646</td>
<td>1.582372e+07</td>
<td>7.114583e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Sierra Leone</td>
<td>36.769167</td>
<td>3.937828</td>
<td>3.605425e+06</td>
<td>1.270945e+06</td>
</tr>
</tbody>
</table>

<p>142 rows × 4 columns</p>
</div>
</div>
</div>
</section>
<section id="distinct-aggregate-functions-on-multiple-columns" class="level3" data-number="12.2.4">
<h3 data-number="12.2.4" class="anchored" data-anchor-id="distinct-aggregate-functions-on-multiple-columns"><span class="header-section-number">12.2.4</span> Distinct aggregate functions on multiple columns</h3>
<p>For aggregating by multiple functions, we pass a list of strings to <code>agg()</code>, where the strings are the function names.</p>
<p>For aggregating by multiple functions &amp; changing the column names resulting from those functions, we pass a list of tuples to <code>agg()</code>, where each tuple is of length two, and contains the new column name as the first object and the function to be applied as the second object of the tuple.</p>
<p>For aggregating by multiple functions such that a distinct set of functions is applied to each column, we pass a dictionary to <code>agg()</code>, where the keys are the column names on which the function is to be applied, and the values are the list of strings that are the function names, or a list of tuples if we also wish to name the aggregated columns.</p>
<div id="cell-45" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We can use a list to apply multiple aggregation functions to a single column, and a dictionary to specify different functions for multiple columns</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Use string names for the aggregation functions</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>grouped_country.agg({<span class="st">"gdpPercap"</span>: [<span class="st">"mean"</span>, <span class="st">"std"</span>], <span class="st">"lifeExp"</span>: [<span class="st">"median"</span>, <span class="st">"std"</span>], <span class="st">"pop"</span>: [<span class="st">"max"</span>, <span class="st">"min"</span>]})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">gdpPercap</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">lifeExp</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">pop</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">median</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">max</th>
<th data-quarto-table-cell-role="th">min</th>
</tr>
<tr class="header">
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Afghanistan</td>
<td>802.674598</td>
<td>108.202929</td>
<td>39.1460</td>
<td>5.098646</td>
<td>31889923</td>
<td>8425333</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Albania</td>
<td>3255.366633</td>
<td>1192.351513</td>
<td>69.6750</td>
<td>6.322911</td>
<td>3600523</td>
<td>1282697</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Algeria</td>
<td>4426.025973</td>
<td>1310.337656</td>
<td>59.6910</td>
<td>10.340069</td>
<td>33333216</td>
<td>9279525</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Angola</td>
<td>3607.100529</td>
<td>1165.900251</td>
<td>39.6945</td>
<td>4.005276</td>
<td>12420476</td>
<td>4232095</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Argentina</td>
<td>8955.553783</td>
<td>1862.583151</td>
<td>69.2115</td>
<td>4.186470</td>
<td>40301927</td>
<td>17876956</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Vietnam</td>
<td>1017.712615</td>
<td>567.482251</td>
<td>57.2900</td>
<td>12.172331</td>
<td>85262356</td>
<td>26246839</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">West Bank and Gaza</td>
<td>3759.996781</td>
<td>1716.840614</td>
<td>62.5855</td>
<td>11.000069</td>
<td>4018332</td>
<td>1030585</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Yemen, Rep.</td>
<td>1569.274672</td>
<td>609.939160</td>
<td>46.6440</td>
<td>11.019302</td>
<td>22211743</td>
<td>4963829</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Zambia</td>
<td>1358.199409</td>
<td>247.494984</td>
<td>46.0615</td>
<td>4.453246</td>
<td>11746035</td>
<td>2672000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Zimbabwe</td>
<td>635.858042</td>
<td>133.689213</td>
<td>53.1765</td>
<td>7.071816</td>
<td>12311143</td>
<td>3080907</td>
</tr>
</tbody>
</table>

<p>142 rows × 6 columns</p>
</div>
</div>
</div>
<p>Next, for each country, find the mean and standard deviation of the <code>lifeExp</code>, and the minimum and maximum values of gdpPercap.</p>
<div id="cell-47" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Specifying arguments to the function as a dictionary if distinct functions are to be applied on distinct columns</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>grouped_country.agg({<span class="st">'lifeExp'</span>:[(<span class="st">'Average'</span>,<span class="st">'mean'</span>),(<span class="st">'Standard deviation'</span>,<span class="st">'std'</span>)],<span class="st">'gdpPercap'</span>:[<span class="st">'min'</span>,<span class="st">'max'</span>]})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">lifeExp</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">gdpPercap</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Average</th>
<th data-quarto-table-cell-role="th">Standard deviation</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
<tr class="header">
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Afghanistan</td>
<td>37.478833</td>
<td>5.098646</td>
<td>635.341351</td>
<td>978.011439</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Albania</td>
<td>68.432917</td>
<td>6.322911</td>
<td>1601.056136</td>
<td>5937.029526</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Algeria</td>
<td>59.030167</td>
<td>10.340069</td>
<td>2449.008185</td>
<td>6223.367465</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Angola</td>
<td>37.883500</td>
<td>4.005276</td>
<td>2277.140884</td>
<td>5522.776375</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Argentina</td>
<td>69.060417</td>
<td>4.186470</td>
<td>5911.315053</td>
<td>12779.379640</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Vietnam</td>
<td>57.479500</td>
<td>12.172331</td>
<td>605.066492</td>
<td>2441.576404</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">West Bank and Gaza</td>
<td>60.328667</td>
<td>11.000069</td>
<td>1515.592329</td>
<td>7110.667619</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Yemen, Rep.</td>
<td>46.780417</td>
<td>11.019302</td>
<td>781.717576</td>
<td>2280.769906</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Zambia</td>
<td>45.996333</td>
<td>4.453246</td>
<td>1071.353818</td>
<td>1777.077318</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Zimbabwe</td>
<td>52.663167</td>
<td>7.071816</td>
<td>406.884115</td>
<td>799.362176</td>
</tr>
</tbody>
</table>

<p>142 rows × 4 columns</p>
</div>
</div>
</div>
</section>
</section>
<section id="grouping-by-multiple-columns" class="level2" data-number="12.3">
<h2 data-number="12.3" class="anchored" data-anchor-id="grouping-by-multiple-columns"><span class="header-section-number">12.3</span> Grouping by Multiple Columns</h2>
<p>Above, we demonstrated grouping by a single column, which is useful for summarizing data based on one categorical variable. However, in many cases, we need to group by multiple columns. Grouping by multiple columns allows us to create more detailed summaries by accounting for multiple categorical variables. This approach enables us to analyze data at a finer granularity, revealing insights that might be missed with single-column grouping alone.</p>
<section id="basic-syntax-for-grouping-by-multiple-columns" class="level3" data-number="12.3.1">
<h3 data-number="12.3.1" class="anchored" data-anchor-id="basic-syntax-for-grouping-by-multiple-columns"><span class="header-section-number">12.3.1</span> Basic Syntax for Grouping by Multiple Columns</h3>
<p>Use <code>groupby()</code> with a list of column names to group data by multiple columns.</p>
<ul>
<li><code>DataFrame.groupby(by=["col1", "col2"])</code></li>
</ul>
<p>Consider the life expectancy dataset, we can group by both country and continent to analyze <code>gdpPercap</code>, <code>lifeExp</code>, and <code>pop</code> trends for each country within each continent, providing a more comprehensive view of the data.</p>
<div id="cell-49" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Grouping by multiple columns</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>grouped_continent_contry <span class="op">=</span> gdp_lifeExp_data.groupby([<span class="st">'continent'</span>, <span class="st">'country'</span>])[ <span class="st">"lifeExp"</span>].agg([<span class="st">'mean'</span>, <span class="st">'std'</span>, <span class="st">'max'</span>, <span class="st">'min'</span>]).sort_values(by <span class="op">=</span> <span class="st">'mean'</span>, ascending <span class="op">=</span> <span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-50" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>grouped_continent_contry</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">max</th>
<th data-quarto-table-cell-role="th">min</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">Europe</td>
<td data-quarto-table-cell-role="th">Iceland</td>
<td>76.511417</td>
<td>3.026593</td>
<td>81.757</td>
<td>72.490</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Sweden</td>
<td>76.177000</td>
<td>3.003990</td>
<td>80.884</td>
<td>71.860</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Norway</td>
<td>75.843000</td>
<td>2.423994</td>
<td>80.196</td>
<td>72.670</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Netherlands</td>
<td>75.648500</td>
<td>2.486363</td>
<td>79.762</td>
<td>72.130</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Switzerland</td>
<td>75.565083</td>
<td>4.011572</td>
<td>81.701</td>
<td>69.620</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td rowspan="3" data-quarto-table-cell-role="th" data-valign="top">Africa</td>
<td data-quarto-table-cell-role="th">Mozambique</td>
<td>40.379500</td>
<td>4.599184</td>
<td>46.344</td>
<td>31.286</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Guinea-Bissau</td>
<td>39.210250</td>
<td>4.937369</td>
<td>46.388</td>
<td>32.500</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Angola</td>
<td>37.883500</td>
<td>4.005276</td>
<td>42.731</td>
<td>30.015</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Asia</td>
<td data-quarto-table-cell-role="th">Afghanistan</td>
<td>37.478833</td>
<td>5.098646</td>
<td>43.828</td>
<td>28.801</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Africa</td>
<td data-quarto-table-cell-role="th">Sierra Leone</td>
<td>36.769167</td>
<td>3.937828</td>
<td>42.568</td>
<td>30.331</td>
</tr>
</tbody>
</table>

<p>142 rows × 4 columns</p>
</div>
</div>
</div>
</section>
<section id="understanding-hierarchical-multi-level-indexing" class="level3" data-number="12.3.2">
<h3 data-number="12.3.2" class="anchored" data-anchor-id="understanding-hierarchical-multi-level-indexing"><span class="header-section-number">12.3.2</span> Understanding Hierarchical (Multi-Level) Indexing</h3>
<ul>
<li>Grouping by multiple columns creates a hierarchical index (also called a multi-level index).</li>
<li>This index allows each level (e.g., continent, country) to act as an independent category that can be accessed individually.</li>
</ul>
<p>In the above output, <code>continent</code> and <code>country</code> form a two-level hierarchical index, allowing us to drill down from continent-level to country-level summaries.</p>
<div id="cell-52" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>grouped_continent_contry.index.nlevels</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>2</code></pre>
</div>
</div>
<div id="cell-53" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the first level of the index</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>grouped_continent_contry.index.levels[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>Index(['Africa', 'Americas', 'Asia', 'Europe', 'Oceania'], dtype='object', name='continent')</code></pre>
</div>
</div>
<div id="cell-54" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the second level of the index</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>grouped_continent_contry.index.levels[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>Index(['Afghanistan', 'Albania', 'Algeria', 'Angola', 'Argentina', 'Australia',
       'Austria', 'Bahrain', 'Bangladesh', 'Belgium',
       ...
       'Uganda', 'United Kingdom', 'United States', 'Uruguay', 'Venezuela',
       'Vietnam', 'West Bank and Gaza', 'Yemen, Rep.', 'Zambia', 'Zimbabwe'],
      dtype='object', name='country', length=142)</code></pre>
</div>
</div>
</section>
<section id="subsetting-data-in-a-hierarchical-index" class="level3" data-number="12.3.3">
<h3 data-number="12.3.3" class="anchored" data-anchor-id="subsetting-data-in-a-hierarchical-index"><span class="header-section-number">12.3.3</span> Subsetting Data in a Hierarchical Index</h3>
<p><code>grouped_continent_country</code> is still a DataFrame with hierarchical indexing. You can use <code>.loc[]</code> for subsetting, just as you would with a single-level index.</p>
<div id="cell-56" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the observations for the 'Americas' continent</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>grouped_continent_contry.loc[<span class="st">'Americas'</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">max</th>
<th data-quarto-table-cell-role="th">min</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Canada</td>
<td>74.902750</td>
<td>3.952871</td>
<td>80.653</td>
<td>68.750</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">United States</td>
<td>73.478500</td>
<td>3.343781</td>
<td>78.242</td>
<td>68.440</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Puerto Rico</td>
<td>72.739333</td>
<td>3.984267</td>
<td>78.746</td>
<td>64.280</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Cuba</td>
<td>71.045083</td>
<td>6.022798</td>
<td>78.273</td>
<td>59.421</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Uruguay</td>
<td>70.781583</td>
<td>3.342937</td>
<td>76.384</td>
<td>66.071</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-57" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the mean life expectancy for the 'Americas' continent</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>grouped_continent_contry.loc[<span class="st">'Americas'</span>][<span class="st">'mean'</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>country
Canada           74.902750
United States    73.478500
Puerto Rico      72.739333
Cuba             71.045083
Uruguay          70.781583
Name: mean, dtype: float64</code></pre>
</div>
</div>
<div id="cell-58" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># another way to get the mean life expectancy for the 'Americas' continent</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>grouped_continent_contry.loc[<span class="st">'Americas'</span>, <span class="st">'mean'</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>country
Canada           74.902750
United States    73.478500
Puerto Rico      72.739333
Cuba             71.045083
Uruguay          70.781583
Name: mean, dtype: float64</code></pre>
</div>
</div>
<p>You can use a tuple to access data for specific levels in a multi-level index.</p>
<div id="cell-60" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the observations for the 'United States' country</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>grouped_continent_contry.loc[( <span class="st">'Americas'</span>, <span class="st">'United States'</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>mean    73.478500
std      3.343781
max     78.242000
min     68.440000
Name: (Americas, United States), dtype: float64</code></pre>
</div>
</div>
<div id="cell-61" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>grouped_continent_contry.loc[( <span class="st">'Americas'</span>, <span class="st">'United States'</span>), [<span class="st">'mean'</span>, <span class="st">'std'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>mean    73.478500
std      3.343781
Name: (Americas, United States), dtype: float64</code></pre>
</div>
</div>
<div id="cell-62" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_data.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>Index(['country', 'continent', 'year', 'lifeExp', 'pop', 'gdpPercap'], dtype='object')</code></pre>
</div>
</div>
<p>Finally, you can use <code>reset_index()</code> to convert the hierarchical index into a regular index, allowing you to apply the standard subsetting and filtering methods covered in previous chapters</p>
<div id="cell-64" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>grouped_continent_contry.reset_index().head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">max</th>
<th data-quarto-table-cell-role="th">min</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Europe</td>
<td>Iceland</td>
<td>76.511417</td>
<td>3.026593</td>
<td>81.757</td>
<td>72.49</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Europe</td>
<td>Sweden</td>
<td>76.177000</td>
<td>3.003990</td>
<td>80.884</td>
<td>71.86</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Europe</td>
<td>Norway</td>
<td>75.843000</td>
<td>2.423994</td>
<td>80.196</td>
<td>72.67</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Europe</td>
<td>Netherlands</td>
<td>75.648500</td>
<td>2.486363</td>
<td>79.762</td>
<td>72.13</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Europe</td>
<td>Switzerland</td>
<td>75.565083</td>
<td>4.011572</td>
<td>81.701</td>
<td>69.62</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="grouping-by-multiple-columns-and-aggregating-multiple-variables" class="level3" data-number="12.3.4">
<h3 data-number="12.3.4" class="anchored" data-anchor-id="grouping-by-multiple-columns-and-aggregating-multiple-variables"><span class="header-section-number">12.3.4</span> Grouping by multiple columns and aggregating multiple variables</h3>
<div id="cell-66" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Grouping by multiple columns</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>grouped_continent_contry_multi <span class="op">=</span> gdp_lifeExp_data.groupby([<span class="st">'continent'</span>, <span class="st">'country'</span>,<span class="st">'year'</span>])[ [<span class="st">'lifeExp'</span>, <span class="st">'pop'</span>, <span class="st">'gdpPercap'</span>]].agg([<span class="st">'mean'</span>, <span class="st">'max'</span>, <span class="st">'min'</span>])</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>grouped_continent_contry_multi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th colspan="3" data-quarto-table-cell-role="th" data-halign="left">lifeExp</th>
<th colspan="3" data-quarto-table-cell-role="th" data-halign="left">pop</th>
<th colspan="3" data-quarto-table-cell-role="th" data-halign="left">gdpPercap</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">max</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">max</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">max</th>
<th data-quarto-table-cell-role="th">min</th>
</tr>
<tr class="header">
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">Africa</td>
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">Algeria</td>
<td data-quarto-table-cell-role="th">1952</td>
<td>43.077</td>
<td>43.077</td>
<td>43.077</td>
<td>9279525.0</td>
<td>9279525</td>
<td>9279525</td>
<td>2449.008185</td>
<td>2449.008185</td>
<td>2449.008185</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1957</td>
<td>45.685</td>
<td>45.685</td>
<td>45.685</td>
<td>10270856.0</td>
<td>10270856</td>
<td>10270856</td>
<td>3013.976023</td>
<td>3013.976023</td>
<td>3013.976023</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1962</td>
<td>48.303</td>
<td>48.303</td>
<td>48.303</td>
<td>11000948.0</td>
<td>11000948</td>
<td>11000948</td>
<td>2550.816880</td>
<td>2550.816880</td>
<td>2550.816880</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1967</td>
<td>51.407</td>
<td>51.407</td>
<td>51.407</td>
<td>12760499.0</td>
<td>12760499</td>
<td>12760499</td>
<td>3246.991771</td>
<td>3246.991771</td>
<td>3246.991771</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1972</td>
<td>54.518</td>
<td>54.518</td>
<td>54.518</td>
<td>14760787.0</td>
<td>14760787</td>
<td>14760787</td>
<td>4182.663766</td>
<td>4182.663766</td>
<td>4182.663766</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td data-quarto-table-cell-role="th">...</td>
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">Oceania</td>
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">New Zealand</td>
<td data-quarto-table-cell-role="th">1987</td>
<td>74.320</td>
<td>74.320</td>
<td>74.320</td>
<td>3317166.0</td>
<td>3317166</td>
<td>3317166</td>
<td>19007.191290</td>
<td>19007.191290</td>
<td>19007.191290</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1992</td>
<td>76.330</td>
<td>76.330</td>
<td>76.330</td>
<td>3437674.0</td>
<td>3437674</td>
<td>3437674</td>
<td>18363.324940</td>
<td>18363.324940</td>
<td>18363.324940</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1997</td>
<td>77.550</td>
<td>77.550</td>
<td>77.550</td>
<td>3676187.0</td>
<td>3676187</td>
<td>3676187</td>
<td>21050.413770</td>
<td>21050.413770</td>
<td>21050.413770</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2002</td>
<td>79.110</td>
<td>79.110</td>
<td>79.110</td>
<td>3908037.0</td>
<td>3908037</td>
<td>3908037</td>
<td>23189.801350</td>
<td>23189.801350</td>
<td>23189.801350</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2007</td>
<td>80.204</td>
<td>80.204</td>
<td>80.204</td>
<td>4115771.0</td>
<td>4115771</td>
<td>4115771</td>
<td>25185.009110</td>
<td>25185.009110</td>
<td>25185.009110</td>
</tr>
</tbody>
</table>

<p>1704 rows × 9 columns</p>
</div>
</div>
</div>
<p>Breaking Down Grouping and Aggregation</p>
<ul>
<li><p><strong>Grouping by Multiple Columns</strong>:<br>
In this example, we are grouping the data by three columns: <code>continent</code>, <code>country</code>, and <code>year</code>. This creates groups based on unique combinations of these columns.</p></li>
<li><p><strong>Aggregating Multiple Variables</strong>:<br>
We apply multiple aggregation functions (<code>mean</code>, <code>std</code>, <code>max</code>, and <code>min</code>) to multiple variables (<code>lifeExp</code>, <code>pop</code>, and <code>gdpPercap</code>).</p></li>
</ul>
<p>This type of operation is commonly referred to as <strong>“multi-column grouping with multiple aggregations”</strong> in pandas. It’s a powerful approach because it allows us to obtain a detailed statistical summary for each combination of grouping columns across several variables.</p>
<div id="cell-68" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># its columns are also two levels deep</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>grouped_continent_contry_multi.columns.nlevels</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>2</code></pre>
</div>
</div>
<div id="cell-69" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pass a tuple to the loc() method to access the values of the multi-level columns with a multi-level index</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>grouped_continent_contry_multi.loc[(<span class="st">'Americas'</span>,<span class="st">'United States'</span>), (<span class="st">'lifeExp'</span>, <span class="st">'mean'</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>year
1952    68.440
1957    69.490
1962    70.210
1967    70.760
1972    71.340
1977    73.380
1982    74.650
1987    75.020
1992    76.090
1997    76.810
2002    77.310
2007    78.242
Name: (lifeExp, mean), dtype: float64</code></pre>
</div>
</div>
</section>
</section>
<section id="advanced-operations-within-groups-apply-transform-and-filter" class="level2" data-number="12.4">
<h2 data-number="12.4" class="anchored" data-anchor-id="advanced-operations-within-groups-apply-transform-and-filter"><span class="header-section-number">12.4</span> Advanced Operations within groups: <code>apply()</code>, <code>transform()</code>, and <code>filter()</code></h2>
<section id="using-apply-on-groups" class="level3" data-number="12.4.1">
<h3 data-number="12.4.1" class="anchored" data-anchor-id="using-apply-on-groups"><span class="header-section-number">12.4.1</span> Using <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.core.groupby.GroupBy.apply.html"><code>apply()</code></a> on groups</h3>
<p>The <code>apply()</code> function applies a custom function to each group, allowing for flexible operations. The function can return either a scalar, Series, or DataFrame.</p>
<p><strong>Example</strong>: Consider the life expectancy dataset, find the top 3 life expectancy values for each continent</p>
<p>We’ll first define a function that sorts a dataset by decreasing life expectancy and returns the top 3 rows. Then, we’ll apply this function on each group using the <code>apply()</code> method of the <em>GroupBy</em> object.</p>
<div id="cell-74" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function to get the top 3 rows based on life expectancy for each group</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> top_3_life_expectancy(group):</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> group.nlargest(<span class="dv">3</span>, <span class="st">'lifeExp'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-75" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Defining the groups in the data</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>grouped_gdpcapital_data <span class="op">=</span> gdp_lifeExp_data.groupby(<span class="st">'continent'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we’ll use the <code>apply()</code> method to apply the <code>top_3_life_expectancy()</code> function on each group of the object <code>grouped_gdpcapital_data</code>.</p>
<div id="cell-77" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the function to each continent group</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>top_life_expectancy <span class="op">=</span> gdp_lifeExp_data.groupby(<span class="st">'continent'</span>)[[<span class="st">'continent'</span>, <span class="st">'country'</span>, <span class="st">'year'</span>, <span class="st">'lifeExp'</span>, <span class="st">'gdpPercap'</span>]].<span class="bu">apply</span>(top_3_life_expectancy).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the result</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>top_life_expectancy.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">lifeExp</th>
<th data-quarto-table-cell-role="th">gdpPercap</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Africa</td>
<td>Reunion</td>
<td>2007</td>
<td>76.442</td>
<td>7670.122558</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Africa</td>
<td>Reunion</td>
<td>2002</td>
<td>75.744</td>
<td>6316.165200</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Africa</td>
<td>Reunion</td>
<td>1997</td>
<td>74.772</td>
<td>6071.941411</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Americas</td>
<td>Canada</td>
<td>2007</td>
<td>80.653</td>
<td>36319.235010</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Americas</td>
<td>Canada</td>
<td>2002</td>
<td>79.770</td>
<td>33328.965070</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The <code>top_3_life_expectancy()</code> function is applied to each group, and the results are concatenated internally with the <code>concat()</code> function. The output therefore has a hierarchical index whose outer level indices are the group keys.</p>
<p>We can also use a lambda function instead of separately defining the function <code>top_3_life_expectancy()</code>:</p>
<div id="cell-80" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Use a lambda function to get the top 3 life expectancy values for each continent</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>top_life_expectancy <span class="op">=</span> (</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    gdp_lifeExp_data</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">'continent'</span>)[[<span class="st">'continent'</span>, <span class="st">'country'</span>, <span class="st">'year'</span>, <span class="st">'lifeExp'</span>, <span class="st">'gdpPercap'</span>]]  <span class="co"># Avoid adding group labels in the index</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.nlargest(<span class="dv">3</span>, <span class="st">'lifeExp'</span>))</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>    .reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the result</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>top_life_expectancy.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">lifeExp</th>
<th data-quarto-table-cell-role="th">gdpPercap</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Africa</td>
<td>Reunion</td>
<td>2007</td>
<td>76.442</td>
<td>7670.122558</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Africa</td>
<td>Reunion</td>
<td>2002</td>
<td>75.744</td>
<td>6316.165200</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Africa</td>
<td>Reunion</td>
<td>1997</td>
<td>74.772</td>
<td>6071.941411</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Americas</td>
<td>Canada</td>
<td>2007</td>
<td>80.653</td>
<td>36319.235010</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Americas</td>
<td>Canada</td>
<td>2002</td>
<td>79.770</td>
<td>33328.965070</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="using-transform-on-groups" class="level3" data-number="12.4.2">
<h3 data-number="12.4.2" class="anchored" data-anchor-id="using-transform-on-groups"><span class="header-section-number">12.4.2</span> Using <a href="https://pandas.pydata.org/docs/reference/api/pandas.core.groupby.DataFrameGroupBy.transform.html"><code>transform()</code></a> on Groups</h3>
<p>The <code>transform()</code> function applies a function to each group and returns a Series aligned with the original DataFrame’s index. This makes it suitable for adding or modifying columns based on group-level calculations.</p>
<p>Recall that in the data cleaning and preparation chapter, we imputed missing values based on correlated variables in the dataset.</p>
<p>In the example provided, some countries had missing values for GDP per capita. To handle this, we imputed the missing GDP per capita for each country using the average GDP per capita of its corresponding continent.</p>
<p>Now, we’ll explore an alternative approach using <code>groupby()</code> and <code>transform()</code> to perform this imputation.</p>
<p>Let us read the datasets and the function that makes a visualization to compare the imputed values with the actual values.</p>
<div id="cell-84" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Importing data with missing values</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>gdp_missing_data <span class="op">=</span> pd.read_csv(<span class="st">'./Datasets/GDP_missing_data.csv'</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Importing data with all values</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>gdp_complete_data <span class="op">=</span> pd.read_csv(<span class="st">'./Datasets/GDP_complete_data.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-85" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Index of rows with missing values for GDP per capita</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>null_ind_gdpPC <span class="op">=</span> gdp_missing_data.index[gdp_missing_data.gdpPerCapita.isnull()]</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Defining a function to plot the imputed values vs actual values </span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_actual_vs_predicted():</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    plt.rc(<span class="st">'xtick'</span>, labelsize<span class="op">=</span><span class="dv">15</span>) </span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>    plt.rc(<span class="st">'ytick'</span>, labelsize<span class="op">=</span><span class="dv">15</span>) </span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> gdp_complete_data.loc[null_ind_gdpPC,<span class="st">'gdpPerCapita'</span>]</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> gdp_imputed_data.loc[null_ind_gdpPC,<span class="st">'gdpPerCapita'</span>]</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>    plt.scatter(x,y)</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>    z<span class="op">=</span>np.polyfit(x,y,<span class="dv">1</span>)</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>    p<span class="op">=</span>np.poly1d(z)</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>    plt.plot(x,x,color<span class="op">=</span><span class="st">'orange'</span>)</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Actual GDP per capita'</span>,fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Imputed GDP per capita'</span>,fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>    ax.xaxis.set_major_formatter(<span class="st">'$</span><span class="sc">{x:,.0f}</span><span class="st">'</span>)</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>    ax.yaxis.set_major_formatter(<span class="st">'$</span><span class="sc">{x:,.0f}</span><span class="st">'</span>)</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>    rmse <span class="op">=</span> np.sqrt(((x<span class="op">-</span>y).<span class="bu">pow</span>(<span class="dv">2</span>)).mean())</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"RMSE="</span>,rmse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Approach 1:</strong> Using the approach we used in the previous chapter</p>
<div id="cell-87" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Finding the mean GDP per capita of the continent</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>avg_gdpPerCapita <span class="op">=</span> gdp_missing_data[<span class="st">'gdpPerCapita'</span>].groupby(gdp_missing_data[<span class="st">'continent'</span>]).mean()</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating a copy of missing data to impute missing values</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>gdp_imputed_data <span class="op">=</span> gdp_missing_data.copy()</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Replacing missing GDP per capita with the mean GDP per capita for the corresponding continent</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cont <span class="kw">in</span> avg_gdpPerCapita.index:</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>    gdp_imputed_data.loc[(gdp_imputed_data.continent<span class="op">==</span>cont) <span class="op">&amp;</span> (gdp_imputed_data.gdpPerCapita.isnull()),</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'gdpPerCapita'</span>]<span class="op">=</span>avg_gdpPerCapita[cont]</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>plot_actual_vs_predicted()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE= 25473.20645170116</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Data aggregation_files/figure-html/cell-45-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Approach 2:</strong> Using the <code>groupby()</code> and <code>transform()</code> methods.</p>
<p>The <code>transform()</code> function is a powerful tool for filling missing values in grouped data. It allows us to apply a function across each group and align the result back to the original DataFrame, making it perfect for filling missing values based on group statistics.</p>
<p>In this example, we use <code>transform()</code> to impute missing values in the <code>gdpPerCapita</code> column by filling them with the mean <code>gdpPerCapita</code> of each continent:</p>
<div id="cell-89" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating a copy of missing data to impute missing values</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>gdp_imputed_data <span class="op">=</span> gdp_missing_data.copy()</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Grouping data by continent</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>grouped <span class="op">=</span> gdp_missing_data.groupby(<span class="st">'continent'</span>)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Imputing missing values with the mean GDP per capita of the continent</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>gdp_imputed_data[<span class="st">'gdpPerCapita'</span>] <span class="op">=</span> grouped[<span class="st">'gdpPerCapita'</span>].transform(<span class="kw">lambda</span> x: x.fillna(x.mean()))</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>plot_actual_vs_predicted()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE= 25473.20645170116</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Data aggregation_files/figure-html/cell-46-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Using the <code>transform()</code> function, missing values in gdpPerCapita for each group are filled with the group’s mean <code>gdpPerCapita</code>. This approach is not only more convenient to write but also faster compared to using for loops. While a for loop imputes missing values one group at a time, <code>transform()</code> performs built-in operations (like mean, sum, etc.) in a way that is optimized internally, making it more efficient.</p>
<p>Let’s use <code>apply()</code> instead of <code>transform()</code> with <code>groupby()</code></p>
<p>Please copy the code below and run it in your notebook:</p>
<pre class="{python}"><code>#Creating a copy of missing data to impute missing values
gdp_imputed_data = gdp_missing_data.copy()

#Grouping data by continent
grouped = gdp_missing_data.groupby('continent')

#Applying the lambda function on the 'gdpPerCapita' column of the groups
gdp_imputed_data['gdpPerCapita'] = grouped['gdpPerCapita'].apply(lambda x: x.fillna(x.mean()))

plot_actual_vs_predicted()</code></pre>
<p>Why we ran into this error? and <code>apply()</code> doesn’t work?</p>
<p>Here’s a deeper look at why <code>apply()</code> doesn’t work as expected here:</p>
<section id="behavior-of-groupby.apply-vs.-groupby.transform" class="level4" data-number="12.4.2.1">
<h4 data-number="12.4.2.1" class="anchored" data-anchor-id="behavior-of-groupby.apply-vs.-groupby.transform"><span class="header-section-number">12.4.2.1</span> Behavior of <code>groupby().apply()</code> vs.&nbsp;<code>groupby().transform()</code></h4>
<ul>
<li><p><strong><code>groupby().apply()</code></strong>: This method applies a function to each group and returns the result with a hierarchical (multi-level) index by default. This hierarchical index can make it difficult to align the result back to a single column in the original DataFrame.</p></li>
<li><p><strong><code>groupby().transform()</code></strong>: In contrast, <code>transform()</code> is specifically designed to apply a function to each group and return a Series that is aligned with the original DataFrame’s index. This alignment makes it directly compatible for assignment to a new or existing column in the original DataFrame.</p></li>
</ul>
</section>
<section id="why-transform-works-for-imputation" class="level4" data-number="12.4.2.2">
<h4 data-number="12.4.2.2" class="anchored" data-anchor-id="why-transform-works-for-imputation"><span class="header-section-number">12.4.2.2</span> Why <code>transform()</code> Works for Imputation</h4>
<p>When using <code>transform()</code> to fill missing values, it applies the function (e.g., <code>fillna(x.mean())</code>) based on each group’s statistics, such as the mean, while keeping the result aligned with the original DataFrame’s index. This allows for smooth assignment to a column in the DataFrame without any index mismatch issues.</p>
<p>Additionally, <code>transform()</code> applies the function to each element in a group independently and returns a result that has the same shape as the original data, making it ideal for adding or modifying columns.</p>
</section>
</section>
<section id="using-filter-on-groups" class="level3" data-number="12.4.3">
<h3 data-number="12.4.3" class="anchored" data-anchor-id="using-filter-on-groups"><span class="header-section-number">12.4.3</span> Using <a href="https://pandas.pydata.org/docs/reference/api/pandas.core.groupby.DataFrameGroupBy.filter.html"><code>filter()</code></a> on Groups</h3>
<p>The <code>filter()</code> function filters entire groups based on a condition. It evaluates each group and keeps only those that meet the specified criteria.</p>
<p>Example: Keep only the countries where the mean life expectancy is greater than 70</p>
<div id="cell-94" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># keep only the continent where the mean life expectancy is greater than 74</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_data.groupby(<span class="st">'continent'</span>).<span class="bu">filter</span>(<span class="kw">lambda</span> x: x[<span class="st">'lifeExp'</span>].mean() <span class="op">&gt;</span> <span class="dv">74</span>)[<span class="st">'continent'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>array(['Oceania'], dtype=object)</code></pre>
</div>
</div>
<div id="cell-95" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># keep only the country where the mean life expectancy is greater than 74</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_data.groupby(<span class="st">'country'</span>).<span class="bu">filter</span>(<span class="kw">lambda</span> x: x[<span class="st">'lifeExp'</span>].mean() <span class="op">&gt;</span> <span class="dv">74</span>)[<span class="st">'country'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>array(['Australia', 'Canada', 'Denmark', 'France', 'Iceland', 'Italy',
       'Japan', 'Netherlands', 'Norway', 'Spain', 'Sweden', 'Switzerland'],
      dtype=object)</code></pre>
</div>
</div>
<p>Using <code>.nunique()</code> get the number of countries that satisfy this condition</p>
<div id="cell-97" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_data.groupby(<span class="st">'country'</span>).<span class="bu">filter</span>(<span class="kw">lambda</span> x: x[<span class="st">'lifeExp'</span>].mean() <span class="op">&gt;</span> <span class="dv">74</span>)[<span class="st">'country'</span>].nunique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<pre><code>12</code></pre>
</div>
</div>
</section>
</section>
<section id="sampling-data-by-group" class="level2" data-number="12.5">
<h2 data-number="12.5" class="anchored" data-anchor-id="sampling-data-by-group"><span class="header-section-number">12.5</span> Sampling data by group</h2>
<p>If a dataset contains a large number of observations, operating on it can be computationally expensive. Instead, working on a sample of entire observations is a more efficient alterative. The <code>groupby()</code> method combined with <code>apply()</code> can be used for stratified random sampling from a large dataset.</p>
<p>Before taking the random sample, let us find the number of countries in each continent.</p>
<div id="cell-100" class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_data.continent.value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>continent
Africa      624
Asia        396
Europe      360
Americas    300
Oceania      24
Name: count, dtype: int64</code></pre>
</div>
</div>
<p>Let us take a random sample of 650 observations from the entire dataset.</p>
<div id="cell-102" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>sample_lifeExp_data <span class="op">=</span> gdp_lifeExp_data.sample(<span class="dv">650</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, let us see the number of countries of each continent in our sample.</p>
<div id="cell-104" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>sample_lifeExp_data.continent.value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>continent
Africa      241
Asia        149
Europe      142
Americas    109
Oceania       9
Name: count, dtype: int64</code></pre>
</div>
</div>
<p>Some of the continent have a very low representation in the data. To rectify this, we can take a random sample of 130 observations from each of the 5 continents. In other words, we can take a random sample from each of the continent-based groups.</p>
<div id="cell-106" class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>evenly_sampled_lifeExp_data <span class="op">=</span> gdp_lifeExp_data.groupby(<span class="st">'continent'</span>).<span class="bu">apply</span>(<span class="kw">lambda</span> x:x.sample(<span class="dv">130</span>, replace<span class="op">=</span><span class="va">True</span>), include_groups<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>group_sizes <span class="op">=</span> evenly_sampled_lifeExp_data.groupby(level<span class="op">=</span><span class="dv">0</span>).size()</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(group_sizes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>continent
Africa      130
Americas    130
Asia        130
Europe      130
Oceania     130
dtype: int64</code></pre>
</div>
</div>
<p>The above stratified random sample equally represents all the continent.</p>
</section>
<section id="corr-correlation-by-group" class="level2" data-number="12.6">
<h2 data-number="12.6" class="anchored" data-anchor-id="corr-correlation-by-group"><span class="header-section-number">12.6</span> <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.core.groupby.DataFrameGroupBy.corr.html"><code>corr()</code></a>: Correlation by group</h2>
<p>The <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.corr.html"><code>corr()</code></a> method of the <em>GroupBy</em> object returns the correlation between all pairs of columns within each group.</p>
<p><strong>Example:</strong> Find the correlation between <code>lifeExp</code> and <code>gdpPercap</code> for each continent-country level combination.</p>
<div id="cell-111" class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>gdp_lifeExp_data.groupby([<span class="st">'continent'</span>,<span class="st">'country'</span>]).<span class="bu">apply</span>(<span class="kw">lambda</span> x:x[<span class="st">'lifeExp'</span>].corr(x[<span class="st">'gdpPercap'</span>]), include_groups<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="80">
<pre><code>continent  country       
Africa     Algeria           0.904471
           Angola           -0.301079
           Benin             0.843949
           Botswana          0.005597
           Burkina Faso      0.881677
                               ...   
Europe     Switzerland       0.980715
           Turkey            0.954455
           United Kingdom    0.989893
Oceania    Australia         0.986446
           New Zealand       0.974493
Length: 142, dtype: float64</code></pre>
</div>
</div>
<p>Life expectancy is closely associated with GDP per capita across most continent-country combinations.</p>
</section>
<section id="pivot_table" class="level2" data-number="12.7">
<h2 data-number="12.7" class="anchored" data-anchor-id="pivot_table"><span class="header-section-number">12.7</span> <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.pivot_table.html"><code>pivot_table()</code></a></h2>
<p>The <code>pivot_table()</code> function in pandas is a powerful tool for performing groupwise aggregation in a structured format, similar to Excel’s pivot tables. It allows you to create a summary of data by grouping and aggregating it based on specified columns. Here’s an overview of how <code>pivot_table()</code> works for groupwise aggregation:</p>
<p>Note that <code>pivot_table()</code> is the same as <code>pivot()</code> except that <code>pivot_table()</code> aggregates the data as well in addition to re-arranging it.</p>
<p><strong>Example:</strong> Consider the life expectancy dataset, calculate the average life expectancy for each country and year combination</p>
<div id="cell-116" class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>pd.pivot_table(data <span class="op">=</span> gdp_lifeExp_data, values <span class="op">=</span> <span class="st">'lifeExp'</span>,index <span class="op">=</span> <span class="st">'country'</span>, columns <span class="op">=</span><span class="st">'year'</span>,aggfunc <span class="op">=</span> <span class="st">'mean'</span>,margins <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="81">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">1952</th>
<th data-quarto-table-cell-role="th">1957</th>
<th data-quarto-table-cell-role="th">1962</th>
<th data-quarto-table-cell-role="th">1967</th>
<th data-quarto-table-cell-role="th">1972</th>
<th data-quarto-table-cell-role="th">1977</th>
<th data-quarto-table-cell-role="th">1982</th>
<th data-quarto-table-cell-role="th">1987</th>
<th data-quarto-table-cell-role="th">1992</th>
<th data-quarto-table-cell-role="th">1997</th>
<th data-quarto-table-cell-role="th">2002</th>
<th data-quarto-table-cell-role="th">2007</th>
<th data-quarto-table-cell-role="th">All</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Afghanistan</td>
<td>28.80100</td>
<td>30.332000</td>
<td>31.997000</td>
<td>34.02000</td>
<td>36.088000</td>
<td>38.438000</td>
<td>39.854000</td>
<td>40.822000</td>
<td>41.674000</td>
<td>41.763000</td>
<td>42.129000</td>
<td>43.828000</td>
<td>37.478833</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Albania</td>
<td>55.23000</td>
<td>59.280000</td>
<td>64.820000</td>
<td>66.22000</td>
<td>67.690000</td>
<td>68.930000</td>
<td>70.420000</td>
<td>72.000000</td>
<td>71.581000</td>
<td>72.950000</td>
<td>75.651000</td>
<td>76.423000</td>
<td>68.432917</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Algeria</td>
<td>43.07700</td>
<td>45.685000</td>
<td>48.303000</td>
<td>51.40700</td>
<td>54.518000</td>
<td>58.014000</td>
<td>61.368000</td>
<td>65.799000</td>
<td>67.744000</td>
<td>69.152000</td>
<td>70.994000</td>
<td>72.301000</td>
<td>59.030167</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Angola</td>
<td>30.01500</td>
<td>31.999000</td>
<td>34.000000</td>
<td>35.98500</td>
<td>37.928000</td>
<td>39.483000</td>
<td>39.942000</td>
<td>39.906000</td>
<td>40.647000</td>
<td>40.963000</td>
<td>41.003000</td>
<td>42.731000</td>
<td>37.883500</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Argentina</td>
<td>62.48500</td>
<td>64.399000</td>
<td>65.142000</td>
<td>65.63400</td>
<td>67.065000</td>
<td>68.481000</td>
<td>69.942000</td>
<td>70.774000</td>
<td>71.868000</td>
<td>73.275000</td>
<td>74.340000</td>
<td>75.320000</td>
<td>69.060417</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">West Bank and Gaza</td>
<td>43.16000</td>
<td>45.671000</td>
<td>48.127000</td>
<td>51.63100</td>
<td>56.532000</td>
<td>60.765000</td>
<td>64.406000</td>
<td>67.046000</td>
<td>69.718000</td>
<td>71.096000</td>
<td>72.370000</td>
<td>73.422000</td>
<td>60.328667</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Yemen, Rep.</td>
<td>32.54800</td>
<td>33.970000</td>
<td>35.180000</td>
<td>36.98400</td>
<td>39.848000</td>
<td>44.175000</td>
<td>49.113000</td>
<td>52.922000</td>
<td>55.599000</td>
<td>58.020000</td>
<td>60.308000</td>
<td>62.698000</td>
<td>46.780417</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Zambia</td>
<td>42.03800</td>
<td>44.077000</td>
<td>46.023000</td>
<td>47.76800</td>
<td>50.107000</td>
<td>51.386000</td>
<td>51.821000</td>
<td>50.821000</td>
<td>46.100000</td>
<td>40.238000</td>
<td>39.193000</td>
<td>42.384000</td>
<td>45.996333</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Zimbabwe</td>
<td>48.45100</td>
<td>50.469000</td>
<td>52.358000</td>
<td>53.99500</td>
<td>55.635000</td>
<td>57.674000</td>
<td>60.363000</td>
<td>62.351000</td>
<td>60.377000</td>
<td>46.809000</td>
<td>39.989000</td>
<td>43.487000</td>
<td>52.663167</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">All</td>
<td>49.05762</td>
<td>51.507401</td>
<td>53.609249</td>
<td>55.67829</td>
<td>57.647386</td>
<td>59.570157</td>
<td>61.533197</td>
<td>63.212613</td>
<td>64.160338</td>
<td>65.014676</td>
<td>65.694923</td>
<td>67.007423</td>
<td>59.474439</td>
</tr>
</tbody>
</table>

<p>143 rows × 13 columns</p>
</div>
</div>
</div>
<p><strong>Explanation</strong></p>
<ul>
<li><strong>values</strong>: Specifies the column to aggregate (e.g., <code>lifeExp</code> in our example).</li>
<li><strong>index</strong>: Groups by the rows based on the <code>country</code> column.</li>
<li><strong>columns</strong>: Groups by the columns based on the <code>year</code> column.</li>
<li><strong>aggfunc</strong>: Uses <code>mean</code> to calculate the average life expectancy.</li>
</ul>
<p><strong>Common Aggregation Functions in <code>pivot_table()</code></strong></p>
<p>You can use various aggregation functions within <code>pivot_table()</code> to summarize data:</p>
<ul>
<li><strong><code>mean</code></strong> – Calculates the average of values within each group.</li>
<li><strong><code>sum</code></strong> – Computes the total of values within each group.</li>
<li><strong><code>count</code></strong> – Counts the number of non-null entries within each group.</li>
<li><strong><code>min</code></strong> and <strong><code>max</code></strong> – Finds the minimum and maximum values within each group.</li>
</ul>
<p>We can also use custom <em>GroupBy</em> aggregate functions with <code>pivot_table()</code>.</p>
<p><strong>Example</strong>: Find the <span class="math inline">\(90^{th}\)</span> percentile of life expectancy for each country and year combination</p>
<div id="cell-120" class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>pd.pivot_table(data <span class="op">=</span> gdp_lifeExp_data, values <span class="op">=</span> <span class="st">'lifeExp'</span>,index <span class="op">=</span> <span class="st">'country'</span>, columns <span class="op">=</span><span class="st">'year'</span>,aggfunc <span class="op">=</span> <span class="kw">lambda</span> x:np.percentile(x,<span class="dv">90</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="82">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">1952</th>
<th data-quarto-table-cell-role="th">1957</th>
<th data-quarto-table-cell-role="th">1962</th>
<th data-quarto-table-cell-role="th">1967</th>
<th data-quarto-table-cell-role="th">1972</th>
<th data-quarto-table-cell-role="th">1977</th>
<th data-quarto-table-cell-role="th">1982</th>
<th data-quarto-table-cell-role="th">1987</th>
<th data-quarto-table-cell-role="th">1992</th>
<th data-quarto-table-cell-role="th">1997</th>
<th data-quarto-table-cell-role="th">2002</th>
<th data-quarto-table-cell-role="th">2007</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Afghanistan</td>
<td>28.801</td>
<td>30.332</td>
<td>31.997</td>
<td>34.020</td>
<td>36.088</td>
<td>38.438</td>
<td>39.854</td>
<td>40.822</td>
<td>41.674</td>
<td>41.763</td>
<td>42.129</td>
<td>43.828</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Albania</td>
<td>55.230</td>
<td>59.280</td>
<td>64.820</td>
<td>66.220</td>
<td>67.690</td>
<td>68.930</td>
<td>70.420</td>
<td>72.000</td>
<td>71.581</td>
<td>72.950</td>
<td>75.651</td>
<td>76.423</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Algeria</td>
<td>43.077</td>
<td>45.685</td>
<td>48.303</td>
<td>51.407</td>
<td>54.518</td>
<td>58.014</td>
<td>61.368</td>
<td>65.799</td>
<td>67.744</td>
<td>69.152</td>
<td>70.994</td>
<td>72.301</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Angola</td>
<td>30.015</td>
<td>31.999</td>
<td>34.000</td>
<td>35.985</td>
<td>37.928</td>
<td>39.483</td>
<td>39.942</td>
<td>39.906</td>
<td>40.647</td>
<td>40.963</td>
<td>41.003</td>
<td>42.731</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Argentina</td>
<td>62.485</td>
<td>64.399</td>
<td>65.142</td>
<td>65.634</td>
<td>67.065</td>
<td>68.481</td>
<td>69.942</td>
<td>70.774</td>
<td>71.868</td>
<td>73.275</td>
<td>74.340</td>
<td>75.320</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Vietnam</td>
<td>40.412</td>
<td>42.887</td>
<td>45.363</td>
<td>47.838</td>
<td>50.254</td>
<td>55.764</td>
<td>58.816</td>
<td>62.820</td>
<td>67.662</td>
<td>70.672</td>
<td>73.017</td>
<td>74.249</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">West Bank and Gaza</td>
<td>43.160</td>
<td>45.671</td>
<td>48.127</td>
<td>51.631</td>
<td>56.532</td>
<td>60.765</td>
<td>64.406</td>
<td>67.046</td>
<td>69.718</td>
<td>71.096</td>
<td>72.370</td>
<td>73.422</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Yemen, Rep.</td>
<td>32.548</td>
<td>33.970</td>
<td>35.180</td>
<td>36.984</td>
<td>39.848</td>
<td>44.175</td>
<td>49.113</td>
<td>52.922</td>
<td>55.599</td>
<td>58.020</td>
<td>60.308</td>
<td>62.698</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Zambia</td>
<td>42.038</td>
<td>44.077</td>
<td>46.023</td>
<td>47.768</td>
<td>50.107</td>
<td>51.386</td>
<td>51.821</td>
<td>50.821</td>
<td>46.100</td>
<td>40.238</td>
<td>39.193</td>
<td>42.384</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Zimbabwe</td>
<td>48.451</td>
<td>50.469</td>
<td>52.358</td>
<td>53.995</td>
<td>55.635</td>
<td>57.674</td>
<td>60.363</td>
<td>62.351</td>
<td>60.377</td>
<td>46.809</td>
<td>39.989</td>
<td>43.487</td>
</tr>
</tbody>
</table>

<p>142 rows × 12 columns</p>
</div>
</div>
</div>
</section>
<section id="crosstab" class="level2" data-number="12.8">
<h2 data-number="12.8" class="anchored" data-anchor-id="crosstab"><span class="header-section-number">12.8</span> <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.crosstab.html"><code>crosstab()</code></a></h2>
<section id="basic-usage-of-crosstab" class="level3" data-number="12.8.1">
<h3 data-number="12.8.1" class="anchored" data-anchor-id="basic-usage-of-crosstab"><span class="header-section-number">12.8.1</span> Basic Usage of <code>crosstab()</code></h3>
<p>The <code>crosstab()</code> method is a special case of a pivot table for computing group frequncies (or size of each group).</p>
<div id="cell-123" class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a basic crosstab to see counts of countries in each continent</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>pd.crosstab(gdp_lifeExp_data[<span class="st">'continent'</span>], columns<span class="op">=</span><span class="st">'count'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="60">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">col_0</th>
<th data-quarto-table-cell-role="th">count</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Africa</td>
<td>624</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Americas</td>
<td>300</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Asia</td>
<td>396</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Europe</td>
<td>360</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Oceania</td>
<td>24</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Use the <code>margins=True</code> argument to add totals (row and column margins) to the table. The <code>All</code> row and column provide totals for each age group and gender category.</p>
<div id="cell-125" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a crosstab to see counts of countries in each continent and year</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>pd.crosstab(gdp_lifeExp_data[<span class="st">'continent'</span>], gdp_lifeExp_data[<span class="st">'year'</span>], margins<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="61">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">1952</th>
<th data-quarto-table-cell-role="th">1957</th>
<th data-quarto-table-cell-role="th">1962</th>
<th data-quarto-table-cell-role="th">1967</th>
<th data-quarto-table-cell-role="th">1972</th>
<th data-quarto-table-cell-role="th">1977</th>
<th data-quarto-table-cell-role="th">1982</th>
<th data-quarto-table-cell-role="th">1987</th>
<th data-quarto-table-cell-role="th">1992</th>
<th data-quarto-table-cell-role="th">1997</th>
<th data-quarto-table-cell-role="th">2002</th>
<th data-quarto-table-cell-role="th">2007</th>
<th data-quarto-table-cell-role="th">All</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Africa</td>
<td>52</td>
<td>52</td>
<td>52</td>
<td>52</td>
<td>52</td>
<td>52</td>
<td>52</td>
<td>52</td>
<td>52</td>
<td>52</td>
<td>52</td>
<td>52</td>
<td>624</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Americas</td>
<td>25</td>
<td>25</td>
<td>25</td>
<td>25</td>
<td>25</td>
<td>25</td>
<td>25</td>
<td>25</td>
<td>25</td>
<td>25</td>
<td>25</td>
<td>25</td>
<td>300</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Asia</td>
<td>33</td>
<td>33</td>
<td>33</td>
<td>33</td>
<td>33</td>
<td>33</td>
<td>33</td>
<td>33</td>
<td>33</td>
<td>33</td>
<td>33</td>
<td>33</td>
<td>396</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Europe</td>
<td>30</td>
<td>30</td>
<td>30</td>
<td>30</td>
<td>30</td>
<td>30</td>
<td>30</td>
<td>30</td>
<td>30</td>
<td>30</td>
<td>30</td>
<td>30</td>
<td>360</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Oceania</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>24</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">All</td>
<td>142</td>
<td>142</td>
<td>142</td>
<td>142</td>
<td>142</td>
<td>142</td>
<td>142</td>
<td>142</td>
<td>142</td>
<td>142</td>
<td>142</td>
<td>142</td>
<td>1704</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>This table shows the count of each year in each continent group, helping us understand the year distribution across different continent groups. We may often use it to check if the data is representative of all groups that are of interest to us.</p>
</section>
<section id="using-crosstab-with-aggregation-functions" class="level3" data-number="12.8.2">
<h3 data-number="12.8.2" class="anchored" data-anchor-id="using-crosstab-with-aggregation-functions"><span class="header-section-number">12.8.2</span> Using <code>crosstab()</code> with Aggregation Functions</h3>
<p>You can specify a <code>values</code> column and an aggregation function (<code>aggfunc</code>) to summarize numerical data for each combination of categorical variables.</p>
<p><strong>Example:</strong> find the mean life expectancy for each continent and year</p>
<div id="cell-129" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># find the mean life expectancy for each country in each continent and year</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>pd.crosstab(gdp_lifeExp_data[<span class="st">'continent'</span>], gdp_lifeExp_data[<span class="st">'year'</span>], values<span class="op">=</span>gdp_lifeExp_data[<span class="st">'lifeExp'</span>], aggfunc<span class="op">=</span><span class="st">'mean'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="62">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">1952</th>
<th data-quarto-table-cell-role="th">1957</th>
<th data-quarto-table-cell-role="th">1962</th>
<th data-quarto-table-cell-role="th">1967</th>
<th data-quarto-table-cell-role="th">1972</th>
<th data-quarto-table-cell-role="th">1977</th>
<th data-quarto-table-cell-role="th">1982</th>
<th data-quarto-table-cell-role="th">1987</th>
<th data-quarto-table-cell-role="th">1992</th>
<th data-quarto-table-cell-role="th">1997</th>
<th data-quarto-table-cell-role="th">2002</th>
<th data-quarto-table-cell-role="th">2007</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Africa</td>
<td>39.135500</td>
<td>41.266346</td>
<td>43.319442</td>
<td>45.334538</td>
<td>47.450942</td>
<td>49.580423</td>
<td>51.592865</td>
<td>53.344788</td>
<td>53.629577</td>
<td>53.598269</td>
<td>53.325231</td>
<td>54.806038</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Americas</td>
<td>53.279840</td>
<td>55.960280</td>
<td>58.398760</td>
<td>60.410920</td>
<td>62.394920</td>
<td>64.391560</td>
<td>66.228840</td>
<td>68.090720</td>
<td>69.568360</td>
<td>71.150480</td>
<td>72.422040</td>
<td>73.608120</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Asia</td>
<td>46.314394</td>
<td>49.318544</td>
<td>51.563223</td>
<td>54.663640</td>
<td>57.319269</td>
<td>59.610556</td>
<td>62.617939</td>
<td>64.851182</td>
<td>66.537212</td>
<td>68.020515</td>
<td>69.233879</td>
<td>70.728485</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Europe</td>
<td>64.408500</td>
<td>66.703067</td>
<td>68.539233</td>
<td>69.737600</td>
<td>70.775033</td>
<td>71.937767</td>
<td>72.806400</td>
<td>73.642167</td>
<td>74.440100</td>
<td>75.505167</td>
<td>76.700600</td>
<td>77.648600</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Oceania</td>
<td>69.255000</td>
<td>70.295000</td>
<td>71.085000</td>
<td>71.310000</td>
<td>71.910000</td>
<td>72.855000</td>
<td>74.290000</td>
<td>75.320000</td>
<td>76.945000</td>
<td>78.190000</td>
<td>79.740000</td>
<td>80.719500</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="independent-study" class="level2" data-number="12.9">
<h2 data-number="12.9" class="anchored" data-anchor-id="independent-study"><span class="header-section-number">12.9</span> Independent Study</h2>
<section id="practice-exercise-1" class="level3" data-number="12.9.1">
<h3 data-number="12.9.1" class="anchored" data-anchor-id="practice-exercise-1"><span class="header-section-number">12.9.1</span> Practice exercise 1</h3>
<p>Read the table consisting of GDP per capita of countries from the webpage: https://en.wikipedia.org/wiki/List_of_countries_by_GDP_(nominal)_per_capita .</p>
<p>To only read the relevant table, read the tables that contain the word <em>‘Country’</em>.</p>
<p>Estimate the GDP per capita of each country as the average of the estimates of the three agencies - IMF, United Nations and World Bank.</p>
<p>We need to do a bit of data cleaning before we could directly use the <code>groupby()</code> function. Follow the steps below:</p>
<ol type="1">
<li>Drop the “Year” column</li>
<li>Drop the level 1 column name (innermost level column)</li>
<li>Apply the following function on all the columns of the “Estimate” to convert them to numeric: <code>f = lambda x:pd.to_numeric(x,errors = 'coerce')</code></li>
<li>Set the Country/Territory column as the index</li>
<li>Convert all other columns into numeric and coerce errors using ‘errors=’coerce’`</li>
<li>Drop rows with NaN values</li>
<li>Find the average GDP per capital across the three agencies</li>
</ol>
<div id="cell-134" class="cell" data-execution_count="94">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>dfs <span class="op">=</span> pd.read_html(<span class="st">'https://en.wikipedia.org/wiki/List_of_countries_by_GDP_(nominal)_per_capita'</span>, match <span class="op">=</span> <span class="st">'Country'</span>)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>gdp_data  <span class="op">=</span> dfs[<span class="dv">0</span>]</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>gdp_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="94">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Country/Territory</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">IMF[4][5]</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">World Bank[6]</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">United Nations[7]</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Country/Territory</th>
<th data-quarto-table-cell-role="th">Estimate</th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Estimate</th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Estimate</th>
<th data-quarto-table-cell-role="th">Year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Monaco</td>
<td>—</td>
<td>—</td>
<td>240862</td>
<td>2022</td>
<td>240535</td>
<td>2022</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Liechtenstein</td>
<td>—</td>
<td>—</td>
<td>187267</td>
<td>2022</td>
<td>197268</td>
<td>2022</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Luxembourg</td>
<td>135321</td>
<td>2024</td>
<td>128259</td>
<td>2023</td>
<td>125897</td>
<td>2022</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Bermuda</td>
<td>—</td>
<td>—</td>
<td>123091</td>
<td>2022</td>
<td>117568</td>
<td>2022</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Switzerland</td>
<td>106098</td>
<td>2024</td>
<td>99995</td>
<td>2023</td>
<td>93636</td>
<td>2022</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-135" class="cell" data-execution_count="106">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Flatten the MultiIndex to access column names</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>gdp_data.columns <span class="op">=</span> [<span class="st">' '</span>.join(col).strip() <span class="cf">if</span> <span class="bu">isinstance</span>(col, <span class="bu">tuple</span>) <span class="cf">else</span> col <span class="cf">for</span> col <span class="kw">in</span> gdp_data.columns]</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop all columns containing "Year"</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>gdp_data <span class="op">=</span> gdp_data.loc[:, <span class="op">~</span>gdp_data.columns.<span class="bu">str</span>.contains(<span class="st">'Year'</span>, case<span class="op">=</span><span class="va">False</span>)]</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>gdp_data <span class="op">=</span> gdp_data.rename(columns<span class="op">=</span>{<span class="st">"Country/Territory Country/Territory"</span>: <span class="st">"Country/Territory"</span>})</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>gdp_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="106">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Country/Territory</th>
<th data-quarto-table-cell-role="th">IMF</th>
<th data-quarto-table-cell-role="th">World Bank</th>
<th data-quarto-table-cell-role="th">United Nations</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Monaco</td>
<td>—</td>
<td>240862</td>
<td>240535</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Liechtenstein</td>
<td>—</td>
<td>187267</td>
<td>197268</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Luxembourg</td>
<td>135321</td>
<td>128259</td>
<td>125897</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Bermuda</td>
<td>—</td>
<td>123091</td>
<td>117568</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Switzerland</td>
<td>106098</td>
<td>99995</td>
<td>93636</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-136" class="cell" data-execution_count="107">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>column_name_cleaner <span class="op">=</span> <span class="kw">lambda</span> x:re.split(<span class="vs">r'\['</span>, x)[<span class="dv">0</span>]</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>gdp_data.columns <span class="op">=</span> gdp_data.columns.<span class="bu">map</span>(column_name_cleaner)</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>gdp_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="107">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Country/Territory</th>
<th data-quarto-table-cell-role="th">IMF</th>
<th data-quarto-table-cell-role="th">World Bank</th>
<th data-quarto-table-cell-role="th">United Nations</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Monaco</td>
<td>—</td>
<td>240862</td>
<td>240535</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Liechtenstein</td>
<td>—</td>
<td>187267</td>
<td>197268</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Luxembourg</td>
<td>135321</td>
<td>128259</td>
<td>125897</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Bermuda</td>
<td>—</td>
<td>123091</td>
<td>117568</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Switzerland</td>
<td>106098</td>
<td>99995</td>
<td>93636</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-137" class="cell" data-execution_count="108">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set the country column as the index</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>gdp_data.set_index(<span class="st">'Country/Territory'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="co"># convert all other columns into numeric and coerce errors</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>gdp_data <span class="op">=</span> gdp_data.<span class="bu">apply</span>(pd.to_numeric, errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="co"># drop rows with NaN values</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>gdp_data.dropna(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a><span class="co">#find the average GDP per capita</span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>gdp_data[<span class="st">'Average GDP per capita'</span>] <span class="op">=</span> gdp_data.mean(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>gdp_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="108">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">IMF</th>
<th data-quarto-table-cell-role="th">World Bank</th>
<th data-quarto-table-cell-role="th">United Nations</th>
<th data-quarto-table-cell-role="th">Average GDP per capita</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Country/Territory</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Luxembourg</td>
<td>135321.0</td>
<td>128259.0</td>
<td>125897.0</td>
<td>129825.666667</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Switzerland</td>
<td>106098.0</td>
<td>99995.0</td>
<td>93636.0</td>
<td>99909.666667</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Ireland</td>
<td>103500.0</td>
<td>103685.0</td>
<td>105993.0</td>
<td>104392.666667</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Norway</td>
<td>90434.0</td>
<td>87962.0</td>
<td>106623.0</td>
<td>95006.333333</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Singapore</td>
<td>89370.0</td>
<td>84734.0</td>
<td>78115.0</td>
<td>84073.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="practice-exercise-2" class="level3" data-number="12.9.2">
<h3 data-number="12.9.2" class="anchored" data-anchor-id="practice-exercise-2"><span class="header-section-number">12.9.2</span> Practice exercise 2</h3>
<p>Read the spotify dataset from <code>spotify_data.csv</code> that contains information about tracks and artists</p>
<section id="section" class="level4" data-number="12.9.2.1">
<h4 data-number="12.9.2.1" class="anchored" data-anchor-id="section"><span class="header-section-number">12.9.2.1</span> </h4>
<p>Find the mean and standard deviation of the track popularity for each genre.</p>
</section>
<section id="section-1" class="level4" data-number="12.9.2.2">
<h4 data-number="12.9.2.2" class="anchored" data-anchor-id="section-1"><span class="header-section-number">12.9.2.2</span> </h4>
<p>Create a new categorical column, <code>energy_lvl</code>, with two levels – ‘Low energy’ and ‘High energy’ – using equal-sized bins based on the track’s energy level. Then, calculate the mean, standard deviation, and 90th percentile of track popularity for each genre and energy level combination</p>
</section>
<section id="section-2" class="level4" data-number="12.9.2.3">
<h4 data-number="12.9.2.3" class="anchored" data-anchor-id="section-2"><span class="header-section-number">12.9.2.3</span> </h4>
<p>Find the mean and standard deviation of track popularity and danceability for each genre and energy level. What insights you can gain from the generated table</p>
</section>
<section id="section-3" class="level4" data-number="12.9.2.4">
<h4 data-number="12.9.2.4" class="anchored" data-anchor-id="section-3"><span class="header-section-number">12.9.2.4</span> </h4>
<p>For each genre and energy level, find the mean and standard deviation of the track popularity, and the minimum and maximum values of loudness.</p>
</section>
<section id="section-4" class="level4" data-number="12.9.2.5">
<h4 data-number="12.9.2.5" class="anchored" data-anchor-id="section-4"><span class="header-section-number">12.9.2.5</span> </h4>
<p>Find the most popular artist from each genre.</p>
</section>
<section id="section-5" class="level4" data-number="12.9.2.6">
<h4 data-number="12.9.2.6" class="anchored" data-anchor-id="section-5"><span class="header-section-number">12.9.2.6</span> </h4>
<p>Filter the first 4 columns of the spotify dataset. Drop duplicate observartions in the resulting dataset using the Pandas DataFrame method <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.drop_duplicates.html"><code>drop_duplicates()</code></a>. Find the top 3 most popular artists for each genre.</p>
</section>
<section id="section-6" class="level4" data-number="12.9.2.7">
<h4 data-number="12.9.2.7" class="anchored" data-anchor-id="section-6"><span class="header-section-number">12.9.2.7</span> </h4>
<p>The spotify dataset has more than 200k observations. It may be expensive to operate with so many observations. Take a random sample of 650 observations to analyze spotify data, such that all genres are equally represented.</p>
</section>
<section id="section-7" class="level4" data-number="12.9.2.8">
<h4 data-number="12.9.2.8" class="anchored" data-anchor-id="section-7"><span class="header-section-number">12.9.2.8</span> </h4>
<p>Find the correlation between <code>danceability</code> and <code>track popularity</code> for each genre-energy level combination.</p>
</section>
<section id="section-8" class="level4" data-number="12.9.2.9">
<h4 data-number="12.9.2.9" class="anchored" data-anchor-id="section-8"><span class="header-section-number">12.9.2.9</span> </h4>
<p>Find the mean of track popularity for each genre-energy lvl combination such that each row corresponds to a genre, and the energy levels correspond to columns.</p>
<p>Hints: using <code>pivot_table()</code></p>
</section>
<section id="section-9" class="level4" data-number="12.9.2.10">
<h4 data-number="12.9.2.10" class="anchored" data-anchor-id="section-9"><span class="header-section-number">12.9.2.10</span> </h4>
<p>Find the <span class="math inline">\(90^{th}\)</span> percentile of track popularity for each genre-energy lvl combination such that each row corresponds to a genre, and the energy levels correspond to columns.</p>
<p>Hints: using <code>pivot_table()</code></p>
</section>
<section id="section-10" class="level4" data-number="12.9.2.11">
<h4 data-number="12.9.2.11" class="anchored" data-anchor-id="section-10"><span class="header-section-number">12.9.2.11</span> </h4>
<p>Find the number of observations in each group, where each groups corresponds to a distinct genre-energy lvl combination</p>
</section>
<section id="section-11" class="level4" data-number="12.9.2.12">
<h4 data-number="12.9.2.12" class="anchored" data-anchor-id="section-11"><span class="header-section-number">12.9.2.12</span> </h4>
<p>Find the percentage of observations in each group of the above table.</p>
</section>
<section id="section-12" class="level4" data-number="12.9.2.13">
<h4 data-number="12.9.2.13" class="anchored" data-anchor-id="section-12"><span class="header-section-number">12.9.2.13</span> </h4>
<p>What percentage of unique tracks are contributed by the top 5 artists of each genre?</p>
<p><strong>Hint:</strong> Find the top 5 artists based on <code>artist_popularity</code> for each genre. Count the total number of unique tracks (<code>track_name</code>) contributed by these artists. Divide this number by the total number of unique tracks in the data. The <code>nunique()</code> function will be useful.</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Data cleaning and preparation.html" class="pagination-link" aria-label="Data Cleaning and Preparation">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Data Cleaning and Preparation</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Data wrangling.html" class="pagination-link" aria-label="Data Reshaping and Enrichment">
        <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Data Reshaping and Enrichment</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>